<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-11-21T22:01:24Z</date><groups><group><name>Halley template</name></group></groups><templates><template><template>HW UPS Legrand CS121</template><name>HW UPS Legrand CS121</name><description>## Overview


Template for monitoring UPS Legrand CS 121 (all models) with explanations and advices. The mibs are there: &lt;http://ups.legrand.com/software/&gt;


The content of template:


**5 Applications**: General, Health, Input, Output, Battery


**18 Items:**


Input voltage, Battery Status ,Estimated minutes remaining if no power , Bypass Voltage


Alarms present on {HOST.NAME}, Bypass Current, Bypass Power


Input line bads, Output Power, Output load in percent


Seconds on battery, Output Voltage


Estimated charge remaining, Battery voltage


Battery temperature, Device Version


Device Name, Device Model


13 Triggers and 4 Graphs


The template use SNMP agent v2. Assure that you set the community in template macros.


Assure also that in Administration -&gt; General -&gt; Value mapping you have under APC Battery Status next values


1 ⇒ unknown  
2 ⇒ batteryNormal  
3 ⇒ batteryLow  
4 ⇒ batteryDepleted


[Send me](mailto:priechodsky.dusan@gmail.com) what template you need, or if this template helped you, [you can buy me one coffee](https://ko-fi.com/priechodskydusan) :)


Upgraded template from Tudor Ticau




## Author

Dusan Priechodsky

</description><groups><group><name>Halley template</name></group></groups><applications><application><name>Battery</name></application><application><name>Bypass</name></application><application><name>General</name></application><application><name>Health</name></application><application><name>Input</name></application><application><name>Output</name></application></applications><items><item><name>Alarms present on {HOST.NAME}</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.6.1</snmp_oid><key>upsAlarmsPresent</key><delay>30</delay><description>The present number of active alarm conditions.</description><applications><application><name>Health</name></application></applications><triggers><trigger><expression>{last()}&lt;&gt;0</expression><name>UPS Alarm Present</name><priority>WARNING</priority><description>On your {HOST.NAME} are activated {ITEM.VALUE} alarms. Please check UPS - usually UPS must produce some sounds now</description><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item><item><name>Battery Status</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.2.1</snmp_oid><key>upsBatteryStatus</key><delay>30</delay><description>The indication of the capacity remaining in the UPS system's batteries.   A value of batteryNormal indicates that the remaining run-time is greater than upsConfigLowBattTime.  A value of batteryLow indicates that the remaining battery run-time is less than or equal to upsConfigLowBattTime.  A value of batteryDepleted indicates that the UPS will be unable to sustain the present load when and if the utility power is lost (including the possibility that the utility power is currently absent and the UPS is unable to sustain the output).</description><applications><application><name>Battery</name></application></applications><valuemap><name>APC Battery Status</name></valuemap><triggers><trigger><expression>{last()}&lt;&gt;2</expression><name>Battery Status on {HOST.NAME} is {ITEM.VALUE}</name><priority>HIGH</priority><description>Battery Status on {HOST.NAME} is {ITEM.VALUE}</description><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item><item><name>Battery temperature</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.2.7</snmp_oid><key>upsBatteryTemperature</key><delay>60</delay><units>°C</units><description>The ambient temperature at or near the UPS Battery casing.</description><applications><application><name>Battery</name></application></applications><triggers><trigger><expression>{last()}&gt;45</expression><name>Battery temperature High</name><priority>HIGH</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger><trigger><expression>{last()}&gt;35 and {last()}&lt;45</expression><name>Battery temperature Warning</name><priority>WARNING</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item><item><name>Battery voltage</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.2.5</snmp_oid><key>upsBatteryVoltage</key><delay>60</delay><units>V</units><description>The magnitude of the present battery voltage.</description><applications><application><name>Battery</name></application></applications><preprocessing><step><type>MULTIPLIER</type><params>0.1</params></step></preprocessing></item><item><name>Estimated charge remaining</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.2.4</snmp_oid><key>upsEstimatedChargeRemaining</key><delay>60</delay><units>%</units><description>An estimate of the battery charge remaining expressed as a percent of full charge.</description><applications><application><name>Battery</name></application></applications><triggers><trigger><expression>{last()}&lt;20</expression><name>Battery Charge Depleated</name><priority>HIGH</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger><trigger><expression>{last()}&lt;80</expression><name>Battery Charge Less Than 80%</name><priority>WARNING</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item><item><name>Estimated minutes remaining if no power</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.2.3</snmp_oid><key>upsEstimatedMinutesRemaining</key><delay>30</delay><units>m</units><description>An estimate of the time to battery charge depletion under the present load conditions if the utility power is off and remains off, or if it were to be lost and remain off.</description><applications><application><name>Battery</name></application></applications><triggers><trigger><expression>{last()}&lt;10</expression><name>Battery Time Remaining Below 10 Minutes</name><priority>WARNING</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item><item><name>Device Version</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.1.4</snmp_oid><key>upsIdentAgentSoftwareVersion</key><delay>600</delay><trends>0</trends><value_type>CHAR</value_type><description>The UPS agent software version.</description><inventory_link>MODEL</inventory_link><applications><application><name>General</name></application></applications></item><item><name>Device Location</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.1.6.0</snmp_oid><key>upsIdentLocation</key><delay>600</delay><trends>0</trends><value_type>CHAR</value_type><description>The name of the UPS manufacturer.</description><inventory_link>LOCATION</inventory_link><applications><application><name>General</name></application></applications></item><item><name>Device Vendor</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.1.1</snmp_oid><key>upsIdentManufacturer</key><delay>600</delay><trends>0</trends><value_type>CHAR</value_type><description>The name of the UPS manufacturer.</description><inventory_link>VENDOR</inventory_link><applications><application><name>General</name></application></applications></item><item><name>Device Model</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.1.2</snmp_oid><key>upsIdentModel</key><delay>86400</delay><trends>0</trends><value_type>CHAR</value_type><description>The UPS Model designation.</description><inventory_link>TYPE</inventory_link><applications><application><name>General</name></application></applications></item><item><name>Device Name</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.1.5.0</snmp_oid><key>upsIdentName</key><delay>600</delay><trends>0</trends><value_type>CHAR</value_type><description>The name of the UPS manufacturer.</description><applications><application><name>General</name></application></applications></item><item><name>Device Uptime</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.1.3.0</snmp_oid><key>upsIdentUptime</key><units>uptime</units><description>The name of the UPS manufacturer.</description><inventory_link>DEPLOYMENT_STATUS</inventory_link><applications><application><name>General</name></application></applications><preprocessing><step><type>MULTIPLIER</type><params>0.01</params></step></preprocessing><triggers><trigger><expression>{last()}&lt;300</expression><name>Device rebooted</name><priority>INFO</priority><manual_close>YES</manual_close></trigger></triggers></item><item><name>Input line bads</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.3.1</snmp_oid><key>upsInputLineBads</key><delay>30</delay><description>A count of the number of times the input entered an out-of-tolerance condition as defined by the manufacturer.  This count is incremented by one each time the input transitions from zero out-of-tolerance lines to one or more input lines out-of-tolerance. A big number show problems with the electricity power where your UPS is connected</description><applications><application><name>Input</name></application></applications><triggers><trigger><expression>{change()}&lt;&gt;0</expression><name>UPS Input Power Line Bad</name><priority>HIGH</priority><description>Your UPS in 1 minute switch the input transitions from zero out-of-tolerance&#13;
lines to one or more input lines out-of-tolerance. In other words: you have line power problems (bad frequency, bad voltage - someone near you use a lot of electricity power)</description><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item><item><name>Seconds on battery</name><type>SNMP_AGENT</type><snmp_oid>.1.3.6.1.2.1.33.1.2.2</snmp_oid><key>upsSecondsOnBattery</key><delay>30</delay><units>s</units><description>If the unit is on battery power, the elapsed time since the UPS last switched to battery power, or the time since the network management subsystem was last restarted, whichever is less.  Zero shall be returned if the unit is not on battery power.</description><applications><application><name>Battery</name></application></applications><triggers><trigger><expression>{last()}&gt;30</expression><name>UPS Running On Battery</name><priority>HIGH</priority><description>The UPS {HOST.NAME} is running on battery. Please check the battery power</description><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger></triggers></item></items><discovery_rules><discovery_rule><name>UPS Bypass Phases</name><type>SNMP_AGENT</type><snmp_oid>discovery[{#SNMPVALUE},1.3.6.1.2.1.33.1.5.3.1.1]</snmp_oid><key>upsBypassCurrent</key><delay>1h</delay><item_prototypes><item_prototype><name>Bypass Current Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.5.3.1.3.{#SNMPINDEX}</snmp_oid><key>upsBypassCurrent.[{#SNMPINDEX}]</key><units>A</units><applications><application><name>Bypass</name></application></applications></item_prototype><item_prototype><name>Bypass Power Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.5.3.1.4.{#SNMPINDEX}</snmp_oid><key>upsBypassPower.[{#SNMPINDEX}]</key><units>W</units><applications><application><name>Bypass</name></application></applications></item_prototype><item_prototype><name>Bypass Voltage Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.5.3.1.2.{#SNMPINDEX}</snmp_oid><key>upsBypassVoltage.[{#SNMPINDEX}]</key><units>V</units><applications><application><name>Bypass</name></application></applications></item_prototype></item_prototypes><trigger_prototypes><trigger_prototype><expression>{HW UPS Legrand CS121:upsBypassCurrent.[{#SNMPINDEX}].last()}&lt;&gt;0 or {HW UPS Legrand CS121:upsBypassPower.[{#SNMPINDEX}].last()}&lt;&gt;0</expression><name>UPS Bypassed phase {#SNMPINDEX}</name><priority>WARNING</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger_prototype></trigger_prototypes><graph_prototypes><graph_prototype><name>UPS Bypass Phase {#SNMPINDEX}</name><graph_items><graph_item><color>F63100</color><item><host>HW UPS Legrand CS121</host><key>upsBypassCurrent.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>HW UPS Legrand CS121</host><key>upsBypassPower.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F7941D</color><item><host>HW UPS Legrand CS121</host><key>upsBypassVoltage.[{#SNMPINDEX}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes></discovery_rule><discovery_rule><name>UPS Input Phases</name><type>SNMP_AGENT</type><snmp_oid>discovery[{#SNMPVALUE},1.3.6.1.2.1.33.1.3.3.1.1]</snmp_oid><key>upsInputFrequency</key><delay>1h</delay><item_prototypes><item_prototype><name>Input current Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.3.3.1.4.{#SNMPINDEX}</snmp_oid><key>upsInputCurrent.[{#SNMPINDEX}]</key><value_type>FLOAT</value_type><units>Arms</units><applications><application><name>Input</name></application></applications><preprocessing><step><type>MULTIPLIER</type><params>0.1</params></step></preprocessing></item_prototype><item_prototype><name>Input Frequency phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.3.3.1.2.{#SNMPINDEX}</snmp_oid><key>upsInputFrequency.[{#SNMPINDEX}]</key><value_type>FLOAT</value_type><units>Hz</units><applications><application><name>Input</name></application></applications><preprocessing><step><type>JAVASCRIPT</type><params>return value / 10</params></step></preprocessing><trigger_prototypes><trigger_prototype><expression>{last()}&gt;53 or {last()}&lt;47</expression><name>UPS Input frequency outside nominal {#SNMPINDEX}</name><priority>WARNING</priority><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Input power Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.3.3.1.5.{#SNMPINDEX}</snmp_oid><key>upsInputPower.[{#SNMPINDEX}]</key><units>W</units><applications><application><name>Input</name></application></applications></item_prototype><item_prototype><name>Input voltage Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.3.3.1.3.{#SNMPINDEX}</snmp_oid><key>upsInputVoltage.[{#SNMPINDEX}]</key><units>V</units><applications><application><name>Input</name></application></applications></item_prototype></item_prototypes><graph_prototypes><graph_prototype><name>UPS Input Phase {#SNMPINDEX}</name><graph_items><graph_item><color>199C0D</color><item><host>HW UPS Legrand CS121</host><key>upsInputFrequency.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>F63100</color><item><host>HW UPS Legrand CS121</host><key>upsInputCurrent.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F7941D</color><item><host>HW UPS Legrand CS121</host><key>upsInputPower.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>3</sortorder><color>FC6EA3</color><item><host>HW UPS Legrand CS121</host><key>upsInputVoltage.[{#SNMPINDEX}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes></discovery_rule><discovery_rule><name>UPS Output Phses</name><type>SNMP_AGENT</type><snmp_oid>discovery[{#SNMPVALUE},1.3.6.1.2.1.33.1.4.4.1.1]</snmp_oid><key>upsOutputPower</key><delay>1h</delay><item_prototypes><item_prototype><name>Output load in percent Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.4.4.1.5.{#SNMPINDEX}</snmp_oid><key>upsOutputPercentLoad.[{#SNMPINDEX}]</key><units>%</units><applications><application><name>Output</name></application></applications><trigger_prototypes><trigger_prototype><expression>{last(#2)}&gt;60</expression><name>UPS Overloaded phase {#SNMPINDEX} (&gt;60%)</name><priority>HIGH</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Output Power Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.4.4.1.4.{#SNMPINDEX}</snmp_oid><key>upsOutputPower.[{#SNMPINDEX}]</key><units>W</units><applications><application><name>Output</name></application></applications><trigger_prototypes><trigger_prototype><expression>{change()}&gt;300</expression><name>UPS Load Changed phase {#SNMPINDEX} (+/-300W)</name><priority>INFO</priority><description>On {HOST.NAME} we detect a big load change - the power output differential is over 300W</description><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>{last()}&lt;10</expression><name>UPS Low output power phase {#SNMPINDEX} (&lt;10 W)</name><priority>WARNING</priority><description>The output power for {HOST.NAME} is under {ITEM.VALUE}. Take actions to prevent this in future</description><manual_close>YES</manual_close><tags><tag><tag>Value</tag><value>{ITEM.VALUE}</value></tag></tags></trigger_prototype></trigger_prototypes></item_prototype><item_prototype><name>Output Voltage Phase {#SNMPINDEX}</name><type>SNMP_AGENT</type><snmp_oid>1.3.6.1.2.1.33.1.4.4.1.2.{#SNMPINDEX}</snmp_oid><key>upsOutputVoltage.[{#SNMPINDEX}]</key><units>V</units><applications><application><name>Output</name></application></applications><trigger_prototypes><trigger_prototype><expression>{last(#3)}&lt;200 or {last(#3)}&gt;250</expression><name>UPS Power Voltage outside nominal phase {#SNMPINDEX}</name><priority>HIGH</priority><manual_close>YES</manual_close></trigger_prototype></trigger_prototypes></item_prototype></item_prototypes><graph_prototypes><graph_prototype><name>UPS Output Phase {#SNMPINDEX}</name><graph_items><graph_item><color>F63100</color><item><host>HW UPS Legrand CS121</host><key>upsOutputPercentLoad.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>1</sortorder><color>2774A4</color><item><host>HW UPS Legrand CS121</host><key>upsOutputPower.[{#SNMPINDEX}]</key></item></graph_item><graph_item><sortorder>2</sortorder><color>F7941D</color><item><host>HW UPS Legrand CS121</host><key>upsOutputVoltage.[{#SNMPINDEX}]</key></item></graph_item></graph_items></graph_prototype></graph_prototypes></discovery_rule></discovery_rules></template></templates><graphs><graph><name>Battery</name><show_work_period>NO</show_work_period><show_triggers>NO</show_triggers><type>STACKED</type><graph_items><graph_item><color>DD0000</color><item><host>HW UPS Legrand CS121</host><key>upsBatteryTemperature</key></item></graph_item><graph_item><sortorder>1</sortorder><color>008800</color><item><host>HW UPS Legrand CS121</host><key>upsEstimatedChargeRemaining</key></item></graph_item><graph_item><sortorder>2</sortorder><color>2774A4</color><item><host>HW UPS Legrand CS121</host><key>upsEstimatedMinutesRemaining</key></item></graph_item></graph_items></graph></graphs><value_maps><value_map><name>APC Battery Status</name><mappings><mapping><value>1</value><newvalue>unknown</newvalue></mapping><mapping><value>2</value><newvalue>batteryNormal</newvalue></mapping><mapping><value>3</value><newvalue>batteryLow</newvalue></mapping></mappings></value_map></value_maps></zabbix_export>
