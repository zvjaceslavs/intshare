{"link_name": "Notification via asterisk", "type": "Alert Script", "OS": "CentOS", "vendor": "Linux", "minZabbVer": "4.2.x", "link_desc": "<h1>This script for notification via Asterisk</h1>\n<p>This script create call to phone play notification audio message and who has accepted the call connects to the conference for discussion the problem.</p>\n<p>You can connect the sip-provider and make notification to mobile phone.</p>\n<h2><strong>How it works</strong></h2>\n<p>When the problem is triggered, a word describing the problem is passed to the script, script create the call-file and send it to asterisk server, asterisk calling the user and play notification message, then connect user to conference room.</p>\n<h2><strong>Install</strong></h2>\n<p>Script requirements:</p>\n<ul>\n<li>Python 3</li>\n<li>argparse</li>\n<li>sys</li>\n<li>logging</li>\n<li>paramiko</li>\n<li>os</li>\n</ul>\n<p>1) Record sound file with message, for example i use <a href=\"https://cloud.yandex.ru/services/speechkit\">Yandex SpeechKit</a>.</p>\n<p>2) Convert the audio file to ulaw, alaw and gsm format. I use sox tool:</p>\n<p>sox -V vm-intro.wav -r 8000 -c 1 -t ul temperature-error<span style=\"font-size: 12.16px;\">.ulaw</span></p>\n<p>sox -V vm-intro.wav -r 8000 -c 1 -t al temperature-error.alaw</p>\n<p>sox -V vm-intro.wav -r 8000 -c 1 -t gsm temperature-error.gsm</p>\n<p>3) Copy audio files to asterisk folder <em><span style=\"color: #000000; font-family: monospace; font-size: 12.16px;\">/var/lib/asterisk/sounds/</span></em></p>\n<p>4) Add dialplan to <em>extensions.conf</em>:</p>\n<p>5) <span style=\"font-size: 12.16px;\">Add </span><span style=\"font-size: 12.16px;\">conference room <em>alert</em></span><span style=\"font-size: 12.16px;\"> to confbridge</span><em style=\"font-size: 12.16px;\">.conf</em>:</p>\n<p><i>6) </i>Create user <em>notify</em> on asterisk server and create ssh-key.</p>\n<p><i>7) Copy the script to </i><em>AlertScriptsPath /usr/local/share/zabbix/alertscripts </em>on zabbix server and edit login, password or ssh key to connect to asterisk server.</p>\n<p>8) Add <em>media type </em>on zabbix:</p>\n<p><img src=\"https://i.ibb.co/GVJ1yS6/Screenshot-20200517-154057.png\" alt=\"\" width=\"626\" height=\"265\" /></p>\n<p>9) Add action, select triggers for notification, in operations tab select SIP media type:</p>\n<p><img src=\"https://i.ibb.co/cw1VxR4/Screenshot-20200517-155419.png\" alt=\"\" width=\"639\" height=\"185\" /></p>\n<p>10) Add the phone number for user in media tab:</p>\n<p><img src=\"https://i.ibb.co/zXPHN7t/Screenshot-20200517-160027.png\" alt=\"\" width=\"640\" height=\"353\" /> </p>\n<p><span style=\"font-size: 12.16px;\">Script on my <a href=\"https://github.com/pgalonza/Notes/tree/master/administration/zabbix/notifications/asterisk\">GitHub</a></span><span style=\"font-size: 12.16px;\"> repository</span></p>", "features": "Custom Script", "address": "", "city": "", "state": "", "country": "", "postcode": "", "telephone": "", "fax": "", "email": "", "website": "", "price": 0, "link_hits": 2219, "link_votes": null, "link_rating": 0, "link_featured": null, "link_created": "2020-05-17 13:33:50", "link_modified": "2020-05-17 13:55:06", "link_visited": null, "publish_up": "2020-05-17 13:33:50", "publish_down": "0000-00-00 00:00:00", "metakey": "", "metadesc": "", "1.8": "", "2.0": "", "2.2": "", "2.4": "", "3.0": "", "3.2": "", "3.4": "", "4.0": "", "4.2": "asterisk.tar.gz", "4.4": "", "5.0": "", "5.2": "", "tags": "asterisk, asterisk notification", "author": "P.V. Galonza", "user_id": 11798, "link_id": 2089, "cat_id": "244", "internal_notes": "", "lat": 0, "lng": 0, "zoom": ""}