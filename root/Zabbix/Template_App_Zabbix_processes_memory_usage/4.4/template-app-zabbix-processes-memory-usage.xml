<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>5.2</version>
    <date>2020-09-28T16:40:46Z</date>
    <groups>
        <group>
            <name>Templates/Applications</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template App Zabbix processes memory usage</template>
            <name>Template App Zabbix processes memory usage</name>
            <description>Template requires the following utilities to be available on the Agent host:

- pgrep
- egrep
- sed
- jq</description>
            <groups>
                <group>
                    <name>Templates/Applications</name>
                </group>
            </groups>
            <discovery_rules>
                <discovery_rule>
                    <name>Zabbix processes</name>
                    <key>system.run[&quot;pgrep -a '{$PGREP.REGEX}' | egrep -o --color=none '{$PGREP.REGEX}: .*' | sed 's/ [#\[].*//' | sort -u | jq -Rs '{\&quot;data\&quot;: split(\&quot;\n\&quot;) | map(select(length &gt; 0)) | map(split(\&quot;: \&quot;) | {\&quot;{#COMPONENT}\&quot;: .[0], \&quot;{#PROCESS}\&quot;: .[1]})}'&quot;]</key>
                    <item_prototypes>
                        <item_prototype>
                            <name>Memory used by {#COMPONENT} {#PROCESS}</name>
                            <type>CALCULATED</type>
                            <key>proc.mem.total[{#COMPONENT},{#PROCESS}]</key>
                            <delay>1m;m0-59</delay>
                            <units>B</units>
                            <params>last(&quot;proc.mem[{#COMPONENT},,,{#COMPONENT}: {#PROCESS},swap]&quot;) + last(&quot;proc.mem[{#COMPONENT},,,{#COMPONENT}: {#PROCESS},rss]&quot;)</params>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Memory used by {#COMPONENT}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>VmRSS used by {#COMPONENT} {#PROCESS}</name>
                            <key>proc.mem[{#COMPONENT},,,{#COMPONENT}: {#PROCESS},rss]</key>
                            <delay>1m;m0-59</delay>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Memory used by {#COMPONENT}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                        <item_prototype>
                            <name>VmSwap used by {#COMPONENT} {#PROCESS}</name>
                            <key>proc.mem[{#COMPONENT},,,{#COMPONENT}: {#PROCESS},swap]</key>
                            <delay>1m;m0-59</delay>
                            <units>B</units>
                            <application_prototypes>
                                <application_prototype>
                                    <name>Memory used by {#COMPONENT}</name>
                                </application_prototype>
                            </application_prototypes>
                        </item_prototype>
                    </item_prototypes>
                    <graph_prototypes>
                        <graph_prototype>
                            <name>Memory used by {#COMPONENT} {#PROCESS}</name>
                            <graph_items>
                                <graph_item>
                                    <color>1A7C11</color>
                                    <calc_fnc>ALL</calc_fnc>
                                    <item>
                                        <host>Template App Zabbix processes memory usage</host>
                                        <key>proc.mem.total[{#COMPONENT},{#PROCESS}]</key>
                                    </item>
                                </graph_item>
                            </graph_items>
                        </graph_prototype>
                    </graph_prototypes>
                </discovery_rule>
            </discovery_rules>
            <macros>
                <macro>
                    <macro>{$PGREP.REGEX}</macro>
                    <value>zabbix_(server|agentd|agent2|proxy)</value>
                    <description>Pattern that will be used by pgrep utility to locate Zabbix processes.</description>
                </macro>
            </macros>
        </template>
    </templates>
</zabbix_export>
