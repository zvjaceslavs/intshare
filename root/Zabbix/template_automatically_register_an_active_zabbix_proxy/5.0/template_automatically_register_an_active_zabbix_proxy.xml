<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-10-19T06:16:06Z</date><groups><group><name>Templates/Modules</name></group></groups><templates><template><template>Auto register an active Zabbix proxy</template><name>Auto register an active Zabbix proxy</name><description>prxid=$(/usr/bin/curl -sk {$Z_API_PHP} -X POST -H &quot;Content-Type: application/json&quot; -d '&#13;
{&#13;
	&quot;jsonrpc&quot;: &quot;2.0&quot;,&#13;
	&quot;method&quot;: &quot;proxy.create&quot;,&#13;
	&quot;params&quot;: {&#13;
		&quot;host&quot;: &quot;{EVENT.TAGS}&quot;,&#13;
		&quot;status&quot;: &quot;5&quot;&#13;
	},&#13;
	&quot;auth&quot;: &quot;{$Z_API_SESSIONID}&quot;,&#13;
	&quot;id&quot;: 1&#13;
}&#13;
' | grep -o -E &quot;[0-9]+{3,}&quot;) &amp;&amp; \&#13;
&#13;
/usr/bin/curl -sk {$Z_API_PHP} -X POST -H &quot;Content-Type: application/json&quot; -d &quot;&#13;
{&#13;
    \&quot;jsonrpc\&quot;: \&quot;2.0\&quot;,&#13;
    \&quot;method\&quot;: \&quot;host.create\&quot;,&#13;
    \&quot;params\&quot;: {&#13;
        \&quot;host\&quot;: \&quot;{EVENT.TAGS}\&quot;,&#13;
        \&quot;interfaces\&quot;: [&#13;
            {&#13;
                \&quot;type\&quot;: 1,&#13;
                \&quot;main\&quot;: 1,&#13;
                \&quot;useip\&quot;: 1,&#13;
                \&quot;ip\&quot;: \&quot;127.0.0.1\&quot;,&#13;
                \&quot;dns\&quot;: \&quot;\&quot;,&#13;
                \&quot;port\&quot;: \&quot;10050\&quot;&#13;
            }&#13;
        ],&#13;
        \&quot;groups\&quot;: [&#13;
            {&#13;
                \&quot;groupid\&quot;: \&quot;4\&quot;&#13;
            }&#13;
        ],&#13;
        \&quot;templates\&quot;: [&#13;
            {&#13;
                \&quot;templateid\&quot;: \&quot;10048\&quot;&#13;
            }&#13;
        ],&#13;
        \&quot;proxy_hostid\&quot;:\&quot;$prxid\&quot;&#13;
    },&#13;
    \&quot;auth\&quot;: \&quot;{$Z_API_SESSIONID}\&quot;,&#13;
    \&quot;id\&quot;: 1&#13;
}&#13;
&quot; &amp;&amp; \&#13;
&#13;
/usr/sbin/zabbix_server -R config_cache_reload &amp;&amp; \&#13;
&#13;
/usr/bin/sleep 20 &amp;&amp; \&#13;
&#13;
/usr/bin/curl -sk {$Z_API_PHP} -X POST -H &quot;Content-Type: application/json&quot; -d '&#13;
{&#13;
	&quot;jsonrpc&quot;: &quot;2.0&quot;,&#13;
	&quot;method&quot;: &quot;event.acknowledge&quot;,&#13;
	&quot;params&quot;: {&#13;
		&quot;eventids&quot;: &quot;{EVENT.ID}&quot;,&#13;
		&quot;action&quot;: 1,&#13;
		&quot;message&quot;: &quot;Problem resolved.&quot;&#13;
	},&#13;
	&quot;auth&quot;: &quot;{$Z_API_SESSIONID}&quot;,&#13;
	&quot;id&quot;: 1&#13;
}&#13;
'</description><groups><group><name>Templates/Modules</name></group></groups><applications><application><name>Log</name></application></applications><items><item><name>zabbix_server.log proxy not found</name><type>ZABBIX_ACTIVE</type><key>log[/var/log/zabbix/zabbix_server.log,&quot;cannot parse proxy data from active proxy at.*proxy.*not found&quot;,,,skip,,]</key><delay>1s</delay><trends>0</trends><value_type>LOG</value_type><applications><application><name>Log</name></application></applications><triggers><trigger><expression>{regexp(proxy.*not found)}=1</expression><name>{{ITEM.VALUE}.regsub(&quot;(proxy \&quot;.*\&quot; not found)&quot;,\1)}</name><priority>AVERAGE</priority><manual_close>YES</manual_close><tags><tag><tag>{{ITEM.VALUE}.regsub(&quot;proxy \&quot;(.*)\&quot; not found&quot;,\1)}</tag></tag></tags></trigger></triggers></item></items></template></templates></zabbix_export>
