{"link_name": "Template Module Linux XFS by Zabbix agent", "type": "Template", "OS": "General", "vendor": "", "minZabbVer": "4.4.x", "link_desc": "<p>I needed a template for monitoring XFS project quotas. This is only used with Zabbix 5 but it may work on older/newer versions with little tweaks.</p>\n<p>Requires `jq`, `grep`, `awk` and `sudo` configuration.</p>\n<p>I needed to use `grep` because of the slashes in XFS project paths. Please comment if you know a way to resolve the issue with only `awk` let me know.</p>\n<p>Create file /etc/zabbix/zabbix_agentd.d/template_linux_xfs.conf with contents:</p>\n<pre>UserParameter=xfs.quota.projects, awk -F':' '{ printf \"{\\\"{#XFSNAME}\\\":\\\"%s\\\"}\\n\",$2 }' /etc/projects | jq --slurp 'map(select(. != \"\"))'\nUserParameter=xfs.quota.project.used[*], sudo xfs_quota -c 'df -N' | grep ' $1$$' | awk '{print $$3*1024}'\nUserParameter=xfs.quota.project.total[*], sudo xfs_quota -c 'df -N' | grep ' $1$$' | awk '{print $$2*1024}'\nUserParameter=xfs.quota.project.pused[*], sudo xfs_quota -c 'df -N' | grep ' $1$$' | awk '{print +$$5}'\nUserParameter=xfs.quota.project.pfree[*], sudo xfs_quota -c 'df -Ni' |grep ' $1$$' | awk '{print 100-$5}'\n</pre>\n<p><br />Create sudoers file /etc/sudoers.d/zabbix_extra with contents:</p>\n<pre>Cmnd_Alias XFS_QUOTA = /usr/sbin/xfs_quota -c df -N, /usr/sbin/xfs_quota -c df -Ni\nzabbix ALL = (ALL) NOPASSWD: XFS_QUOTA\n</pre>\n<p><br />You can test if sudo is working by trying it:</p>\n<pre># su - zabbix -s /bin/bash -c \"sudo /usr/sbin/xfs_quota -c 'df -N'\"\n</pre>\n<p><br />and</p>\n<pre># su - zabbix -s /bin/bash -c \"sudo /usr/sbin/xfs_quota -c 'df -N'\"\n</pre>\n<p><br />Good luck!<br />Evren Yurtesen</p>", "features": "Zabbix Agent", "address": "", "city": "", "state": "", "country": "", "postcode": "", "telephone": "", "fax": "", "email": "", "website": "", "price": 0, "link_hits": 833, "link_votes": null, "link_rating": 0, "link_featured": null, "link_created": "2020-05-23 19:31:51", "link_modified": "2020-06-09 08:44:06", "link_visited": null, "publish_up": "2020-05-23 19:31:51", "publish_down": "0000-00-00 00:00:00", "metakey": "", "metadesc": "", "1.8": "", "2.0": "", "2.2": "", "2.4": "", "3.0": "", "3.2": "", "3.4": "", "4.0": "", "4.2": "", "4.4": "", "5.0": "Template Module Linux XFS by Zabbix agent.xml", "5.2": "", "tags": "xfs, project, df, quota", "author": "Evren Yurtesen", "user_id": 11811, "link_id": 2096, "cat_id": "215", "internal_notes": "", "lat": 0, "lng": 0, "zoom": ""}