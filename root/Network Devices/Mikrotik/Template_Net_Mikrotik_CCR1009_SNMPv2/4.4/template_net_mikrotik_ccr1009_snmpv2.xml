<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
    <version>4.4</version>
    <date>2020-03-30T06:30:48Z</date>
    <groups>
        <group>
            <name>Templates/Network devices</name>
        </group>
    </groups>
    <templates>
        <template>
            <template>Template Net Mikrotik CCR1009 SNMPv2</template>
            <name>Template Net Mikrotik CCR1009 SNMPv2</name>
            <description>Template for Mikrotik CCR1009&#13;
&#13;
Should work on any Mikrotik device on which the output of &quot;system health print oid&quot; includes:&#13;
         active-fan: .1.3.6.1.4.1.14988.1.1.3.9.0&#13;
            voltage: .1.3.6.1.4.1.14988.1.1.3.8.0&#13;
        temperature: .1.3.6.1.4.1.14988.1.1.3.10.0&#13;
    cpu-temperature: .1.3.6.1.4.1.14988.1.1.3.11.0&#13;
  power-consumption: .1.3.6.1.4.1.14988.1.1.3.12.0&#13;
         psu1-state: .1.3.6.1.4.1.14988.1.1.3.15.0&#13;
         psu2-state: .1.3.6.1.4.1.14988.1.1.3.16.0&#13;
&#13;
Tested on CCR1009-7G-1C-1S+ running RouterOS 6.44.5&#13;
&#13;
Does not work on hAP lite routers.&#13;
&#13;
Created by full clone of Zabbix's Template Net Mikrotik SNMPv2 then:&#13;
. Added application Health&#13;
. Added items:&#13;
.. Active fan&#13;
.. CPU temperature&#13;
.. PSU 1 state&#13;
.. PSU 2 state&#13;
.. Power consumption&#13;
.. Temperature&#13;
.. Voltage&#13;
. Added triggers:&#13;
.. Active fan change&#13;
.. PSU 1 fail&#13;
.. PSU 2 fail&#13;
.. CPU temperature high&#13;
&#13;
Known Issues:&#13;
. Voltage is shown in deci-Volts because converting to Volts removes the fractional part (https://support.zabbix.com/browse/ZBX-15848)&#13;
&#13;
Template tooling version used: 0.34</description>
            <templates>
                <template>
                    <name>Template Module Generic SNMPv2</name>
                </template>
                <template>
                    <name>Template Module Interfaces SNMPv2</name>
                </template>
            </templates>
            <groups>
                <group>
                    <name>Templates/Network devices</name>
                </group>
            </groups>
            <applications>
                <application>
                    <name>Health</name>
                </application>
            </applications>
            <items>
                <item>
                    <name>Active fan</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.9.0</snmp_oid>
                    <key>system.heath.active-fan</key>
                    <delay>15m</delay>
                    <trends>0</trends>
                    <value_type>TEXT</value_type>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                    <triggers>
                        <trigger>
                            <expression>{change()}=1</expression>
                            <name>Active fan changed</name>
                            <priority>WARNING</priority>
                            <dependencies>
                                <dependency>
                                    <name>No SNMP data collection</name>
                                    <expression>{Template Net Mikrotik CCR1009 SNMPv2:zabbix[host,snmp,available].max({$SNMP.TIMEOUT})}=0</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>CPU temperature</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.11.0</snmp_oid>
                    <key>system.heath.cpu-temperature</key>
                    <delay>5m</delay>
                    <units>degrees C</units>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>0.1</params>
                        </step>
                    </preprocessing>
                    <triggers>
                        <trigger>
                            <expression>{avg(3)}&gt;900</expression>
                            <name>CPU temperature high</name>
                            <priority>AVERAGE</priority>
                            <description>CPU temperature is over 90 C.  Mikrotik's default cpu-overtemp-threshold is 100 C</description>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Power consumption</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.12.0</snmp_oid>
                    <key>system.heath.power-consumption</key>
                    <delay>15m</delay>
                    <units>Watts</units>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>0.1</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>PSU 1 state</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.15.0</snmp_oid>
                    <key>system.heath.psu1-state</key>
                    <delay>15m</delay>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>Mikrotik PSU state</name>
                    </valuemap>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;&gt;1</expression>
                            <name>PSU 1 fail</name>
                            <priority>HIGH</priority>
                            <dependencies>
                                <dependency>
                                    <name>No SNMP data collection</name>
                                    <expression>{Template Net Mikrotik CCR1009 SNMPv2:zabbix[host,snmp,available].max({$SNMP.TIMEOUT})}=0</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>PSU 2 state</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.16.0</snmp_oid>
                    <key>system.heath.psu2-state</key>
                    <delay>15m</delay>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                    <valuemap>
                        <name>Mikrotik PSU state</name>
                    </valuemap>
                    <triggers>
                        <trigger>
                            <expression>{last()}&lt;&gt;1</expression>
                            <name>PSU 2 fail</name>
                            <priority>HIGH</priority>
                            <dependencies>
                                <dependency>
                                    <name>No SNMP data collection</name>
                                    <expression>{Template Net Mikrotik CCR1009 SNMPv2:zabbix[host,snmp,available].max({$SNMP.TIMEOUT})}=0</expression>
                                </dependency>
                            </dependencies>
                        </trigger>
                    </triggers>
                </item>
                <item>
                    <name>Temperature</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.10.0</snmp_oid>
                    <key>system.heath.temperature</key>
                    <delay>15m</delay>
                    <value_type>FLOAT</value_type>
                    <units>!degrees C</units>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                    <preprocessing>
                        <step>
                            <type>MULTIPLIER</type>
                            <params>0.1</params>
                        </step>
                    </preprocessing>
                </item>
                <item>
                    <name>Voltage</name>
                    <type>SNMPV2</type>
                    <snmp_community>{$SNMP_COMMUNITY}</snmp_community>
                    <snmp_oid>1.3.6.1.4.1.14988.1.1.3.8.0</snmp_oid>
                    <key>system.heath.voltage</key>
                    <delay>15m</delay>
                    <units>Volts x 10</units>
                    <applications>
                        <application>
                            <name>Health</name>
                        </application>
                    </applications>
                </item>
            </items>
            <macros>
                <macro>
                    <macro>{$CPU.UTIL.CRIT}</macro>
                    <value>90</value>
                </macro>
                <macro>
                    <macro>{$MEMORY.UTIL.MAX}</macro>
                    <value>90</value>
                </macro>
                <macro>
                    <macro>{$TEMP_CRIT}</macro>
                    <value>60</value>
                </macro>
                <macro>
                    <macro>{$TEMP_CRIT:&quot;CPU&quot;}</macro>
                    <value>75</value>
                </macro>
                <macro>
                    <macro>{$TEMP_CRIT_LOW}</macro>
                    <value>5</value>
                </macro>
                <macro>
                    <macro>{$TEMP_WARN}</macro>
                    <value>50</value>
                </macro>
                <macro>
                    <macro>{$TEMP_WARN:&quot;CPU&quot;}</macro>
                    <value>70</value>
                </macro>
                <macro>
                    <macro>{$VFS.FS.PUSED.MAX.CRIT}</macro>
                    <value>90</value>
                </macro>
                <macro>
                    <macro>{$VFS.FS.PUSED.MAX.WARN}</macro>
                    <value>80</value>
                </macro>
            </macros>
            <screens>
                <screen>
                    <name>Network interfaces</name>
                    <hsize>1</hsize>
                    <vsize>1</vsize>
                    <screen_items>
                        <screen_item>
                            <resourcetype>20</resourcetype>
                            <style>0</style>
                            <resource>
                                <name>Interface {#IFNAME}({#IFALIAS}): Network traffic</name>
                                <host>Template Net Mikrotik CCR1009 SNMPv2</host>
                            </resource>
                            <width>750</width>
                            <height>100</height>
                            <x>0</x>
                            <y>0</y>
                            <colspan>1</colspan>
                            <rowspan>1</rowspan>
                            <elements>25</elements>
                            <valign>0</valign>
                            <halign>0</halign>
                            <dynamic>0</dynamic>
                            <sort_triggers>0</sort_triggers>
                            <url/>
                            <application/>
                            <max_columns>3</max_columns>
                        </screen_item>
                    </screen_items>
                </screen>
            </screens>
        </template>
    </templates>
    <value_maps>
        <value_map>
            <name>Mikrotik PSU state</name>
            <mappings>
                <mapping>
                    <value>0</value>
                    <newvalue>Not OK</newvalue>
                </mapping>
                <mapping>
                    <value>1</value>
                    <newvalue>OK</newvalue>
                </mapping>
                <mapping>
                    <value>2</value>
                    <newvalue>Not OK</newvalue>
                </mapping>
                <mapping>
                    <value>3</value>
                    <newvalue>Not OK</newvalue>
                </mapping>
                <mapping>
                    <value>4</value>
                    <newvalue>Not OK</newvalue>
                </mapping>
            </mappings>
        </value_map>
    </value_maps>
</zabbix_export>
