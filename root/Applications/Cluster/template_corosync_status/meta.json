{"link_name": "Corosync Status", "type": "Template", "OS": "", "vendor": "Others", "minZabbVer": "2.2.x", "link_desc": "<p>Template and script below checks the status of the corosync Ring(s)</p>\n<p> </p>\n<p>1: Create a Script File under the zabbix scripts directory, called corosync.pl and paste the script content into it</p>\n<p>2: Make it executable and ownd by the zabbix user</p>\n<p>3: Add the user Parameter below to the zabbix agent on the cluster nodes</p>\n<p> </p>\n<p><strong>Zabbix Agent Config:</strong></p>\n<pre style=\"font-family: monospace, Courier; padding: 1em; border: 1px solid #dddddd; color: #000000; background-color: #f9f9f9; line-height: 1.1em; font-size: 12.7px;\"><strong>#</strong>\n# Corosync Status\n#\nUserParameter=check_corosync[*], /etc/zabbix/scripts/corosync.pl $1</pre>\n<p> </p>\n<p><strong>Corosync Script:</strong></p>\n<p> </p>\n<p>#!/usr/bin/perl</p>\n<p> </p>\n<p>my $sudo    = '/usr/bin/sudo';</p>\n<p>my $cfgtool = '/usr/sbin/corosync-cfgtool -s';</p>\n<p> </p>\n<p>$num_args = $#ARGV + 1;</p>\n<p>if ($num_args != 1) {</p>\n<p>    print \"\\nUsage: corosync.pl ring number\\n\";</p>\n<p>    exit;</p>\n<p>}</p>\n<p>my $ringNumber = $ARGV[0];</p>\n<p>open( $fh, \"$cfgtool |\" ) or die ( \"Running corosync-cfgtool failed\" );</p>\n<p>foreach my $line (<$fh>) {</p>\n<p>    if ( $line =~ m/status\\s*=\\s*(\\S.+)/ ) {</p>\n<p>        my $status = $1;</p>\n<p>        if ( $status =~ m/^ring $ringNumber/ ) {</p>\n<p>            # print \"RING NUMBER $ringNumber STATUS: $status\\n\";</p>\n<p>            if ( $status =~ m/^ring $ringNumber active with no faults/ ) {</p>\n<p>                print \"0\";</p>\n<p>            } else {</p>\n<p>                print \"1\";</p>\n<p>            }</p>\n<p>            exit;</p>\n<p>        }</p>\n<p>    }</p>\n<p>}</p>\n<p>close($fh) or die ( \"Running corosync-cfgtool failed\" );</p>\n<p> </p>", "features": "Zabbix Agent", "address": "", "city": "", "state": "", "country": "", "postcode": "", "telephone": "", "fax": "", "email": "", "website": "", "price": 0, "link_hits": 2765, "link_votes": null, "link_rating": 0, "link_featured": null, "link_created": "2019-03-05 14:16:49", "link_modified": "0000-00-00 00:00:00", "link_visited": null, "publish_up": "2019-03-05 14:16:49", "publish_down": "0000-00-00 00:00:00", "metakey": "", "metadesc": "", "1.8": "", "2.0": "", "2.2": "Template-Corosync-Ring0.xml", "2.4": "", "3.0": "", "3.2": "", "3.4": "", "4.0": "Template-Corosync-Ring0.xml", "4.2": "", "4.4": "", "5.0": "", "5.2": "", "tags": "Corosync, CRM, Pacemaker", "author": "Roland K\u00e4ser", "user_id": 9333, "link_id": 1567, "cat_id": "218", "internal_notes": "", "lat": 0, "lng": 0, "zoom": ""}