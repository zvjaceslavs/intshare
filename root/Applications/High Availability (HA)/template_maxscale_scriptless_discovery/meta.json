{"link_name": "Maxscale scriptless discovery", "type": "Template", "OS": "", "vendor": "Others", "minZabbVer": "3.0.x", "link_desc": "<p>The script discovery for Maxscale was not really wanted in my case and I decided to write a scriptless variant. This discovery only uses user parameters (on the Maxscale server) and a Zabbix template. Besides that the only other thing that needs doing is to give the Zabbix linux user permission to use maxadmin. </p>\n<p><span style=\"font-size: 12.16px;\">It was created and tested on Zabbix 3.4.5, but should work on other versions as well. I am pretty sure this can be optimized as I slapped this together quite quickly, and I might do so and update here, but for now this works well enough for me to use it. </span></p>\n<p><span style=\"font-size: 12.16px;\">Right now the items and triggers in this template are limited as well, suggestions are welcome of course.</span></p>\n<p><strong>Installation:</strong></p>\n<p><strong>1.</strong> Add the following to /etc/zabbix/zabbix_agent.d/userparameter_mysql.conf (or any other file that is picked up by the agent for userparameters) on the server running Maxscale:</p>\n<p><span style=\"font-family: monospace; font-size: xx-small;\"># Maxscale discovery and items</span></p>\n<p><span style=\"font-family: monospace; font-size: xx-small;\">UserParameter=maxscale.discovery,maxadmin show servers | grep \"(\" | awk '{$3=substr($3,2,length($3)-2); printf \"{\\\"{#SERVER_NODE}\\\": \\\"\"$3\"\\\"},\"}' | sed 's/,$/]}/' | sed 's/^/{\"data\":[/'</span></p>\n<p><span style=\"font-family: monospace; font-size: xx-small;\">UserParameter=maxscale.currconns[*],maxadmin show server $1 | grep \"Current no. of conns:\" | sed 's/Current no. of conns://g' | tr -d '[:space:]'</span></p>\n<p><span style=\"font-family: monospace; font-size: xx-small;\">UserParameter=maxscale.syncstate[*],maxadmin show server $1 | grep \"Status:\" | sed 's/Status://g' | tr -d '[:space:]' | sed 's/,.*//'</span></p>\n<p><span style=\"font-family: monospace; font-size: xx-small;\">UserParameter=maxscale.qmaster,maxadmin show service \"Read-Write Service\" | grep \"Number of queries forwarded to master\" | awk '{print $7}'</span></p>\n<p><span style=\"font-family: monospace; font-size: xx-small;\">UserParameter=maxscale.qslave,maxadmin show service \"Read-Write Service\" | grep \"Number of queries forwarded to slave\" | awk '{print $7}'</span></p>\n<p>After adding this, restart the Zabbix agent.</p>\n<p><strong>2.</strong> Execute the following command (where \"zabbix\" is the user running the agent) on the Maxscale server:</p>\n<p><i>sudo maxadmin enable account zabbix</i></p>\n<p><strong>3.</strong> Import the template and attach it to the host running Maxscale. </p>", "features": "Zabbix Agent", "address": "", "city": "", "state": "", "country": "", "postcode": "", "telephone": "", "fax": "", "email": "", "website": "", "price": 0, "link_hits": 2558, "link_votes": null, "link_rating": 0, "link_featured": null, "link_created": "2018-01-18 15:09:01", "link_modified": "2018-01-18 15:10:25", "link_visited": null, "publish_up": "2018-01-18 15:09:01", "publish_down": "0000-00-00 00:00:00", "metakey": "", "metadesc": "", "1.8": "", "2.0": "", "2.2": "", "2.4": "", "3.0": "", "3.2": "", "3.4": "zbx_Template_MaxScale.zip", "4.0": "", "4.2": "", "4.4": "", "5.0": "", "5.2": "", "tags": "maxscale, linux, discovery", "author": "Bert ter Beest", "user_id": 4691, "link_id": 1053, "cat_id": "193", "internal_notes": "", "lat": 0, "lng": 0, "zoom": ""}