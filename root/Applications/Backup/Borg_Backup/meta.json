{"link_name": "Borg Backup", "type": "Template", "OS": "", "vendor": "Others", "minZabbVer": "4.4.x", "link_desc": "<h1>zabbix-borg</h1>\n<p>Zabbix Plugin for monitoring Borg Backup</p>\n<h2> </h2>\n<h2>Items</h2>\n<p>There are 10 Items:</p>\n<p><a href=\"https://github.com/birdie1/zabbix-borg/blob/master/pics/items.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img style=\"max-width: 100%;\" src=\"https://github.com/birdie1/zabbix-borg/raw/master/pics/items.png\" alt=\"Zabbix Borg Items\" /></a></p>\n<h2> </h2>\n<h2>Triggers</h2>\n<p>There are 3 Triggers:</p>\n<p><a href=\"https://github.com/birdie1/zabbix-borg/blob/master/pics/triggers.png\" target=\"_blank\" rel=\"noopener noreferrer\"><img style=\"max-width: 100%;\" src=\"https://github.com/birdie1/zabbix-borg/raw/master/pics/triggers.png\" alt=\"Zabbix Borg Triggers\" /></a></p>\n<h2> </h2>\n<h2>Install</h2>\n<h3> </h3>\n<h3>Zabbix</h3>\n<ul>\n<li>Import template into zabbix server and configure hosts to use it.</li>\n<li>Deploy zabbix_agentd.conf.d/borg.conf to every machine, you want to use the template.</li>\n</ul>\n<p>If you want to test it, use <code>zabbix_get -s IP -p 10050 -k borg.status</code>.</p>\n<h3> </h3>\n<h3>Borg Backup</h3>\n<p>To let the template work, you must redirect borg output to <code>/var/log/borg.log</code>. Second build <code>/var/log/borg.status</code> like this:</p>\n<pre><code>borg create ... > /var/log/borg.log 2>&1\n\ngrep 'Archive name:' /var/log/borg.log > /dev/null 2>&1\nif [ $? -ne 0 ]; then\n  echo \"$borg backup failed! Exiting\"\n  echo \"$(date +%Y-%m-%d-%H:%M:%S): FAILED\" > /var/log/borg.status\n  exit 1\nfi\n\nARCHIVESIZE=$(grep 'This archive' /var/log/borg.log |awk '{print $7}')\nBC=$(echo $ARCHIVESIZE'>'0| bc -l)\nif [ \"$BC\" -eq 1 ]; then\n  echo \"OK\" > /var/log/borg.status\nelse\n  echo \"$(date +%Y-%m-%d-%H:%M:%S): FAILED\" > /var/log/borg.status\n  exit 1\nfi\n</code></pre>\n<p>Output must be like this:</p>\n<pre><code>root@mail:~# cat /var/log/borg.status \nOK\n</code></pre>\n<pre><code>root@mail:~# cat /var/log/borg.log \nCreating archive at \"ssh://test@test.de/mnt/borg::mail-2020-03-03-20:02:54\"\n------------------------------------------------------------------------------\nArchive name: mail-2020-03-03-20:02:54\nArchive fingerprint: 2067bd6dd2e7bc2a27d373ef293eda59022d84d4f0f8ce860221a5123f77ba7a\nTime (start): Tue, 2020-03-03 20:02:58\nTime (end):   Tue, 2020-03-03 20:03:36\nDuration: 37.84 seconds\nNumber of files: 277055\nUtilization of max. archive size: 0%\n------------------------------------------------------------------------------\n                       Original size      Compressed size    Deduplicated size\nThis archive:               40.32 GB             31.61 GB             11.25 MB\nAll archives:                5.68 TB              4.48 TB             30.36 GB\n\n                       Unique chunks         Total chunks\nChunk index:                  338444             39507784\n------------------------------------------------------------------------------\n</code></pre>", "features": "Zabbix Agent", "address": "", "city": "", "state": "", "country": "", "postcode": "", "telephone": "", "fax": "", "email": "", "website": "https://github.com/birdie1/zabbix-borg", "price": 0, "link_hits": 1061, "link_votes": null, "link_rating": 0, "link_featured": null, "link_created": "2020-03-04 19:40:51", "link_modified": "2020-03-04 19:41:43", "link_visited": 263, "publish_up": "2020-03-04 19:40:51", "publish_down": "0000-00-00 00:00:00", "metakey": "", "metadesc": "", "1.8": "", "2.0": "", "2.2": "", "2.4": "", "3.0": "", "3.2": "", "3.4": "", "4.0": "", "4.2": "", "4.4": "", "5.0": "", "5.2": "", "tags": "Borg, Borgbackup", "author": "birdie1", "user_id": 11466, "link_id": 1986, "cat_id": "135", "internal_notes": "", "lat": 0, "lng": 0, "zoom": ""}