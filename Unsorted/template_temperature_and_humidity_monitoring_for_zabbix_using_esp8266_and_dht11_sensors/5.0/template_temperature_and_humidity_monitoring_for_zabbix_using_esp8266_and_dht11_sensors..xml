<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-22T10:57:46Z</date>
  <groups>
    <group>
      <name>Environment</name>
    </group>
    <group>
      <name>Templates/Modules</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Template Module ICMP Ping</template>
      <name>Template Module ICMP Ping</name>
      <description>Template Module ICMP Ping version: 0.12</description>
      <groups>
        <group>
          <name>Templates/Modules</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>Status</name>
        </application>
      </applications>
      <items>
        <item>
          <name>ICMP ping</name>
          <type>SIMPLE</type>
          <key>icmpping</key>
          <delay>60</delay>
          <history>1w</history>
          <applications>
            <application>
              <name>Status</name>
            </application>
          </applications>
          <valuemap>
            <name>Service state</name>
          </valuemap>
          <triggers>
            <trigger>
              <expression>{max(#3)}=0</expression>
              <name>Unavailable by ICMP ping</name>
              <priority>HIGH</priority>
              <description>Last value: {ITEM.LASTVALUE1}. Last three attempts returned timeout. Please check device connectivity.</description>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>ICMP loss</name>
          <type>SIMPLE</type>
          <key>icmppingloss</key>
          <delay>60</delay>
          <history>1w</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <applications>
            <application>
              <name>Status</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{min(5m)}>{$ICMP_LOSS_WARN} and {min(5m)}&lt;100</expression>
              <name>High ICMP ping loss</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>Unavailable by ICMP ping</name>
                  <expression>{Template Module ICMP Ping:icmpping.max(#3)}=0</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>ICMP response time</name>
          <type>SIMPLE</type>
          <key>icmppingsec</key>
          <delay>60</delay>
          <history>1w</history>
          <value_type>FLOAT</value_type>
          <units>s</units>
          <applications>
            <application>
              <name>Status</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{avg(5m)}>{$ICMP_RESPONSE_TIME_WARN}</expression>
              <name>High ICMP ping response time</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>High ICMP ping loss</name>
                  <expression>{Template Module ICMP Ping:icmppingloss.min(5m)}>{$ICMP_LOSS_WARN} and {Template Module ICMP Ping:icmppingloss.min(5m)}&lt;100</expression>
                </dependency>
                <dependency>
                  <name>Unavailable by ICMP ping</name>
                  <expression>{Template Module ICMP Ping:icmpping.max(#3)}=0</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
      </items>
      <macros>
        <macro>
          <macro>{$ICMP_LOSS_WARN}</macro>
          <value>20</value>
        </macro>
        <macro>
          <macro>{$ICMP_RESPONSE_TIME_WARN}</macro>
          <value>0.15</value>
        </macro>
      </macros>
    </template>
    <template>
      <template>Template_ZBX-ESP-ENV</template>
      <name>Template_ZBX-ESP-ENV</name>
      <description>Temperature and humidity monitoring for Zabbix using ESP8266 and DHT11 sensors.</description>
      <templates>
        <template>
          <name>Template Module ICMP Ping</name>
        </template>
      </templates>
      <groups>
        <group>
          <name>Environment</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>Environmental data</name>
        </application>
      </applications>
      <discovery_rules>
        <discovery_rule>
          <name>Discovery Sensors</name>
          <type>HTTP_AGENT</type>
          <key>discovery.sensors</key>
          <delay>{$INTERVALLLDHTTP}</delay>
          <lifetime>{$LOSTPERIOD}</lifetime>
          <description>Discovery Data Raw All</description>
          <item_prototypes>
            <item_prototype>
              <name>{#NAME} Humidity</name>
              <type>HTTP_AGENT</type>
              <key>sensor.humidity[{#INDEX}]</key>
              <delay>{$UPINTERVALLLD}</delay>
              <history>{$HISTORYSP}</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <applications>
                <application>
                  <name>Environmental data</name>
                </application>
              </applications>
              <url>http://{HOST.CONN}/h/{#INDEX}</url>
            </item_prototype>
            <item_prototype>
              <name>{#NAME} Temperature</name>
              <type>HTTP_AGENT</type>
              <key>sensor.temperature[{#INDEX}]</key>
              <delay>{$UPINTERVALLLD}</delay>
              <history>{$HISTORYSP}</history>
              <value_type>FLOAT</value_type>
              <units>C</units>
              <applications>
                <application>
                  <name>Environmental data</name>
                </application>
              </applications>
              <url>http://{HOST.CONN}/t/{#INDEX}</url>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last(0)} > {#AVERAGE_H}</expression>
                  <name>{#NAME} - The temperature is above the average limit ({#AVERAGE_H})</name>
                  <priority>AVERAGE</priority>
                  <description>The temperature readings from sensor {#NAME} is over threshold.</description>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last(0)} > {#DISASTER_H}</expression>
                  <name>{#NAME} - The temperature is above the disaster limit ({#DISASTER_H})</name>
                  <priority>DISASTER</priority>
                  <description>The temperature readings from sensor {#NAME} is over threshold.</description>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last(0)} > {#HIGH_H}</expression>
                  <name>{#NAME} - The temperature is above the high limit ({#HIGH_H})</name>
                  <priority>HIGH</priority>
                  <description>The temperature readings from sensor {#NAME} is over threshold.</description>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last(0)} &lt; {#AVERAGE_L}</expression>
                  <name>{#NAME} - The temperature is below the average limit ({#AVERAGE_L})</name>
                  <priority>AVERAGE</priority>
                  <description>The temperature readings from sensor {#NAME} is below threshold.</description>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last(0)} &lt; {#DISASTER_L}</expression>
                  <name>{#NAME} - The temperature is below the disaster limit ({#DISASTER_L})</name>
                  <priority>DISASTER</priority>
                  <description>The temperature readings from sensor {#NAME} is below threshold.</description>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last(0)} &lt; {#HIGH_L}</expression>
                  <name>{#NAME} - The temperature is below the high limit ({#HIGH_L})</name>
                  <priority>HIGH</priority>
                  <description>The temperature readings from sensor {#NAME} is below threshold.</description>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
          <graph_prototypes>
            <graph_prototype>
              <name>{#NAME} Humidity</name>
              <graph_items>
                <graph_item>
                  <color>1A7C11</color>
                  <item>
                    <host>Template_ZBX-ESP-ENV</host>
                    <key>sensor.humidity[{#INDEX}]</key>
                  </item>
                </graph_item>
              </graph_items>
            </graph_prototype>
            <graph_prototype>
              <name>{#NAME} Temperature</name>
              <graph_items>
                <graph_item>
                  <color>1A7C11</color>
                  <item>
                    <host>Template_ZBX-ESP-ENV</host>
                    <key>sensor.temperature[{#INDEX}]</key>
                  </item>
                </graph_item>
              </graph_items>
            </graph_prototype>
          </graph_prototypes>
          <timeout>7s</timeout>
          <url>http://{HOST.CONN}/discovery</url>
          <preprocessing>
            <step>
              <type>JSONPATH</type>
              <params>$.data</params>
            </step>
          </preprocessing>
        </discovery_rule>
      </discovery_rules>
      <macros>
        <macro>
          <macro>{$HISTORYSP}</macro>
          <value>90d</value>
        </macro>
        <macro>
          <macro>{$INTERVALHTTP}</macro>
          <value>1m</value>
        </macro>
        <macro>
          <macro>{$INTERVALLLDHTTP}</macro>
          <value>1h</value>
        </macro>
        <macro>
          <macro>{$LOSTPERIOD}</macro>
          <value>10m</value>
        </macro>
        <macro>
          <macro>{$TRENDSP}</macro>
          <value>365d</value>
        </macro>
        <macro>
          <macro>{$UPINTERVALLLD}</macro>
          <value>5m</value>
        </macro>
      </macros>
    </template>
  </templates>
  <value_maps>
    <value_map>
      <name>Service state</name>
      <mappings>
        <mapping>
          <value>0</value>
          <newvalue>Down</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>Up</newvalue>
        </mapping>
      </mappings>
    </value_map>
  </value_maps>
</zabbix_export>