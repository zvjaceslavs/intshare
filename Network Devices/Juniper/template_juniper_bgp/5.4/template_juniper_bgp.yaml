zabbix_export:
  version: '5.4'
  date: '2021-10-19T20:41:21Z'
  groups:
    -
      uuid: 36bff6c29af64692839d077febfc7079
      name: 'Templates/Network devices'
  templates:
    -
      uuid: ce5be3cdd7ba4182b50707a91f93722c
      template: 'Juniper BGP'
      name: 'Juniper BGP'
      groups:
        -
          name: 'Templates/Network devices'
      discovery_rules:
        -
          uuid: 936ecc9d7f01483f9f7c089944837cce
          name: 'BGP peer discovery'
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#BGPPEERINDEX},.1.3.6.1.4.1.2636.5.1.1.2.1.1.1.14,{#BGPPEERREMOTEADDRESS},1.3.6.1.4.1.2636.5.1.1.2.1.1.1.11, {#BGPEERREMOTEAS},.1.3.6.1.4.1.2636.5.1.1.2.1.1.1.13]'
          key: net.bgp.peer.discovery
          delay: 10m
          item_prototypes:
            -
              uuid: a766c6f92cc244a880a74fa6ae9b80d2
              name: 'Last received error ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.2.1.1.5.{#SNMPINDEX}'
              key: 'net.bgp.peer.error.received[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 5m
              trends: '0'
              value_type: TEXT
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: dfdbb82398dd4c0bb05423985a24f557
              name: 'Last sent error ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.2.1.1.6.{#SNMPINDEX}'
              key: 'net.bgp.peer.error.sent[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 5m
              trends: '0'
              value_type: TEXT
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 2bc4aa8de2204f9aa4c80201db2d94f9
              name: 'IPv4 prefixes accepted ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.5.1.1.2.6.2.1.8.{#BGPPEERINDEX}.1.1'
              key: 'net.bgp.peer.prefixes.ipv4.accepted[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 65cde758edb5421fbbd0c168d88ae3eb
              name: 'IPv4 prefixes advertised ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.6.2.1.10.{#BGPPEERINDEX}.1.1'
              key: 'net.bgp.peer.prefixes.ipv4.advertised[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 6826e562e7a04411823c8a612411226f
              name: 'IPv4 prefixes received ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.5.1.1.2.6.2.1.7.{#BGPPEERINDEX}.1.1'
              key: 'net.bgp.peer.prefixes.ipv4.received[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 70c57744790445a2839ac1f4d73f954d
              name: 'IPv4 prefixes rejected ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.5.1.1.2.6.2.1.9.{#BGPPEERINDEX}.1.1'
              key: 'net.bgp.peer.prefixes.ipv4.rejected[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 601b4f1c84e541bdaf95dc80f11f67bd
              name: 'IPv6 prefixes accepted ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.5.1.1.2.6.2.1.8.{#BGPPEERINDEX}.2.1'
              key: 'net.bgp.peer.prefixes.ipv6.accepted[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 0acccd8ce3a8440a8dec7019945b4ca4
              name: 'IPv6 prefixes advertised ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.6.2.1.10.{#BGPPEERINDEX}.2.1'
              key: 'net.bgp.peer.prefixes.ipv6.advertised[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 375e23b7b83c4d5e828020ad4857db06
              name: 'IPv6 prefixes received ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.5.1.1.2.6.2.1.7.{#BGPPEERINDEX}.2.1'
              key: 'net.bgp.peer.prefixes.ipv6.received[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: a782813befc44d2e8f51ca50e4b2ab2b
              name: 'IPv6 prefixes rejected ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.2636.5.1.1.2.6.2.1.9.{#BGPPEERINDEX}.2.1'
              key: 'net.bgp.peer.prefixes.ipv6.rejected[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 2m
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: 40526998798e43faa9cf97ac19458cbe
              name: 'Peer state ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.1.1.1.2.{#SNMPINDEX}'
              key: 'net.bgp.peer.state[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              valuemap:
                name: BgpPeerState
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: dde936ddff4940f8a322e3c8d2952c7e
              name: 'Administrative status ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.1.1.1.3.{#SNMPINDEX}'
              key: 'net.bgp.peer.status[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 5m
              valuemap:
                name: BgpPeerAdminStatus
              tags:
                -
                  tag: Application
                  value: BGP
            -
              uuid: f85bd0819afc469395de7d69f4243b81
              name: 'Established time ({#BGPPEERREMOTEADDRESS})'
              type: SNMP_AGENT
              snmp_oid: '.1.3.6.1.4.1.2636.5.1.1.2.4.1.1.1.{#SNMPINDEX}'
              key: 'net.bgp.peer.uptime[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}]'
              delay: 5m
              units: seconds
              tags:
                -
                  tag: Application
                  value: BGP
          trigger_prototypes:
            -
              uuid: 0cb7f53a146f4a499ec6b4fa5e549d3c
              expression: 'last(/Juniper BGP/net.bgp.peer.state[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}])=6 and last(/Juniper BGP/net.bgp.peer.prefixes.ipv4.received[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}])<0.8*avg(/Juniper BGP/net.bgp.peer.prefixes.ipv4.received[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}],1d)'
              name: '{HOST.HOST} BGP peer {#BGPPEERREMOTEADDRESS} (AS{#BGPEERREMOTEAS}) has lost more than 20% of received prefixes'
              priority: WARNING
            -
              uuid: a0249b31a07c492191c5198d62aa47f2
              expression: 'last(/Juniper BGP/net.bgp.peer.state[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}],#3)<>6 and last(/Juniper BGP/net.bgp.peer.status[{#BGPEERREMOTEAS}, {#BGPPEERREMOTEADDRESS}])=2'
              name: '{HOST.HOST} BGP peer {#BGPPEERREMOTEADDRESS} (AS{#BGPEERREMOTEAS}) is DOWN'
              priority: HIGH
          preprocessing:
            -
              type: JAVASCRIPT
              parameters:
                - |
                  json = JSON.parse(value);
                  
                  json.forEach(function (item, index, array) {
                      var ip = item["{#BGPPEERREMOTEADDRESS}"];
                  
                      parts = ip.trim().split(' ');
                  
                      if (parts.length === 4) {
                          for (var i = 0; i < parts.length; ++i) {
                              parts[i] = parseInt(parts[i], 16);
                          }
                  
                          ip = parts.join('.');
                      } else {
                          var str = parts.join('');
                          var parts = str.match(/.{1,4}/g);
                          ip = parts.join(":");
                          ip = ip.replace(/\b(?:0+:){2,}/, ':')
                                 .split(':')
                  	       .map(function(octet) {
                                     return  octet.replace(/\b0+/g, '');
                                 })
                                 .join(':')
                                 .toLowerCase();
                      }
                  
                      array[index]["{#BGPPEERREMOTEADDRESS}"] = ip;
                  });
                  
                  return JSON.stringify(json);
      valuemaps:
        -
          uuid: 231f045ed42e423292ed58e0da97e2f0
          name: BgpPeerAdminStatus
          mappings:
            -
              value: '1'
              newvalue: stop
            -
              value: '2'
              newvalue: start
        -
          uuid: 2026d1a39e474ceda6bf1ee973e7b761
          name: BgpPeerState
          mappings:
            -
              value: '1'
              newvalue: idle
            -
              value: '2'
              newvalue: connect
            -
              value: '3'
              newvalue: active
            -
              value: '4'
              newvalue: opensent
            -
              value: '5'
              newvalue: openconfirm
            -
              value: '6'
              newvalue: established
