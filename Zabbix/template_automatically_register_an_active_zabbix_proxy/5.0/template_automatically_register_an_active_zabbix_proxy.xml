<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-11-21T21:55:12Z</date><groups><group><name>Templates/Modules</name></group></groups><templates><template><template>Auto register an active Zabbix proxy</template><name>Auto register an active Zabbix proxy</name><description>## Description

prxid=$(/usr/bin/curl -sk {$Z_API_PHP} -X POST -H &quot;Content-Type: application/json&quot; -d ' { &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;proxy.create&quot;, &quot;params&quot;: { &quot;host&quot;: &quot;{EVENT.TAGS}&quot;, &quot;status&quot;: &quot;5&quot; }, &quot;auth&quot;: &quot;{$Z_API_SESSIONID}&quot;, &quot;id&quot;: 1 } ' | grep -o -E &quot;[0-9]+{3,}&quot;) &amp;&amp; /usr/bin/curl -sk {$Z_API_PHP} -X POST -H &quot;Content-Type: application/json&quot; -d &quot; { &quot;jsonrpc &quot;: &quot;2.0 &quot;, &quot;method &quot;: &quot;host.create &quot;, &quot;params &quot;: { &quot;host &quot;: &quot;{EVENT.TAGS} &quot;, &quot;interfaces &quot;: [ { &quot;type &quot;: 1, &quot;main &quot;: 1, &quot;useip &quot;: 1, &quot;ip &quot;: &quot;127.0.0.1 &quot;, &quot;dns &quot;: &quot; &quot;, &quot;port &quot;: &quot;10050 &quot; } ], &quot;groups &quot;: [ { &quot;groupid &quot;: &quot;4 &quot; } ], &quot;templates &quot;: [ { &quot;templateid &quot;: &quot;10048 &quot; } ], &quot;proxy_hostid &quot;: &quot;$prxid &quot; }, &quot;auth &quot;: &quot;{$Z_API_SESSIONID} &quot;, &quot;id &quot;: 1 } &quot; &amp;&amp; /usr/sbin/zabbix_server -R config_cache_reload &amp;&amp; /usr/bin/sleep 20 &amp;&amp; /usr/bin/curl -sk {$Z_API_PHP} -X POST -H &quot;Content-Type: application/json&quot; -d ' { &quot;jsonrpc&quot;: &quot;2.0&quot;, &quot;method&quot;: &quot;event.acknowledge&quot;, &quot;params&quot;: { &quot;eventids&quot;: &quot;{EVENT.ID}&quot;, &quot;action&quot;: 1, &quot;message&quot;: &quot;Problem resolved.&quot; }, &quot;auth&quot;: &quot;{$Z_API_SESSIONID}&quot;, &quot;id&quot;: 1 } '

## Overview

The solution is based on log file monitoring and the functionality of the Zabbix API.


&lt;https://youtu.be/XET-138UvpY&gt;


 


In order to use this template, it's required to run and maintain an active session-id at a global level:


[https://share.zabbix.com/zabbix-tools-and-utilities/maintain-zabbix-api-session-id-in-a-global-level](zabbix-tools-and-utilities/maintain-zabbix-api-session-id-in-a-global-level)


&lt;https://youtu.be/MjQJ0g0AaYI&gt;


 



</description><groups><group><name>Templates/Modules</name></group></groups><applications><application><name>Log</name></application></applications><items><item><name>zabbix_server.log proxy not found</name><type>ZABBIX_ACTIVE</type><key>log[/var/log/zabbix/zabbix_server.log,&quot;cannot parse proxy data from active proxy at.*proxy.*not found&quot;,,,skip,,]</key><delay>1s</delay><trends>0</trends><value_type>LOG</value_type><applications><application><name>Log</name></application></applications><triggers><trigger><expression>{regexp(proxy.*not found)}=1</expression><name>{{ITEM.VALUE}.regsub(&quot;(proxy \&quot;.*\&quot; not found)&quot;,\1)}</name><priority>AVERAGE</priority><manual_close>YES</manual_close><tags><tag><tag>{{ITEM.VALUE}.regsub(&quot;proxy \&quot;(.*)\&quot; not found&quot;,\1)}</tag></tag></tags></trigger></triggers></item></items></template></templates></zabbix_export>
