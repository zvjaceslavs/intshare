<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-11-09T04:59:39Z</date>
  <groups>
    <group>
      <name>Templates</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Windows Defender WMI</template>
      <name>Windows Defender WMI</name>
      <description>## Overview Template utilizes **MSFT\_MpComputerStatus** class in Windows WMI to collect information about Windows Defender, such as: * Antivirus Enabled/Disabled * RealTimeProtection Enabled/Disabled * BehaviorMonitor Enabled/Disabled * OnAccessProtection Enabled/Disabled * IoavProtection Enabled/Disabled * Antispyware Enabled/Disabled * RealTimeProtection Enabled/Disabled * NIS Enabled/Disabled * Age of last Full/Quick scans * Last Date of scans * Computer State * Age of Signatures All WMI information is gathered from official Microsoft documentation. Keep in mind, that his might not work with Older Windows versions. I checked the Min. Zabbix version 3.4, because some items have Regular expression pre-processing. However that could be removed, and template adapted to older Zabbix versions. ## Author Zabbix CookBook</description>
      <groups>
        <group>
          <name>Templates</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>Computer State</name>
        </application>
        <application>
          <name>Features</name>
        </application>
        <application>
          <name>Scan Ages</name>
        </application>
      </applications>
      <items>
        <item>
          <name>Anti Spyware Protection Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select AntispywareEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
        </item>
        <item>
          <name>AntiSpyware Signature age in days</name>
          <key>wmi.get["root\microsoft\windows\defender","select AntispywareSignatureAge from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <units>days</units>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>5</expression>
              <name>Anti Spyware Signature was not updated for more then 5 days on {HOST.HOST}</name>
              <priority>HIGH</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>AntiSpyware Signature Last updated</name>
          <key>wmi.get["root\microsoft\windows\defender","select AntispywareSignatureLastUpdated from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>REGEX</type>
              <params>([0-9]+) \1</params>
            </step>
          </preprocessing>
        </item>
        <item>
          <name>Anti Virus Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select AntivirusEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(True)}&lt;>1</expression>
              <name>Anti Virus Disabled on {HOST.HOST}</name>
              <priority>WARNING</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>AntiVirus Signature Age</name>
          <key>wmi.get["root\microsoft\windows\defender","select AntivirusSignatureAge from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <units>days</units>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>5</expression>
              <name>Anti Virus Signature was not updated for more then 5 days on {HOST.HOST}</name>
              <priority>HIGH</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>AntiVirus Signature Last updated</name>
          <key>wmi.get["root\microsoft\windows\defender","select AntivirusSignatureLastUpdated from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>REGEX</type>
              <params>([0-9]+) \1</params>
            </step>
          </preprocessing>
        </item>
        <item>
          <name>Behavior Monitor Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select BehaviorMonitorEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(True)}&lt;>1</expression>
              <name>Behavior Monitor Disabled on {HOST.HOST}</name>
              <priority>WARNING</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Current computer state</name>
          <key>wmi.get["root\microsoft\windows\defender","select ComputerState from MSFT_MpComputerStatus"]</key>
          <delay>10m</delay>
          <applications>
            <application>
              <name>Computer State</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}=16</expression>
              <name>Windows Defender has failed critically on {HOST.HOST}</name>
              <priority>HIGH</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Full Scan Age</name>
          <key>wmi.get["root\microsoft\windows\defender","select FullScanAge from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <units>!days</units>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>5</expression>
              <name>Full Scan was not performed for more then 5 days on {HOST.HOST}</name>
              <priority>AVERAGE</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Ioav Protection Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select IoavProtectionEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(True)}&lt;>1</expression>
              <name>Ioav Protection Disabled on {HOST.HOST}</name>
              <priority>WARNING</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NIS Protection Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select NISEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(True)}&lt;>1</expression>
              <name>NIS Protection Disabled on {HOST.HOST}</name>
              <priority>WARNING</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NIIS Signature age in days</name>
          <key>wmi.get["root\microsoft\windows\defender","select NISSignatureAge from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <units>days</units>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>5</expression>
              <name>NIIS Signature was not updated for more then 5 days on {HOST.HOST}</name>
              <priority>HIGH</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NIS Signature Last updated</name>
          <key>wmi.get["root\microsoft\windows\defender","select NISSignatureLastUpdated from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>REGEX</type>
              <params>([0-9]+) \1</params>
            </step>
          </preprocessing>
        </item>
        <item>
          <name>OnAccess Protection Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select OnAccessProtectionEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(True)}&lt;>1</expression>
              <name>OnAccess Protection Disabled on {HOST.HOST}</name>
              <priority>WARNING</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Quick Scan Age</name>
          <key>wmi.get["root\microsoft\windows\defender","select QuickScanAge from MSFT_MpComputerStatus"]</key>
          <delay>3h</delay>
          <units>days</units>
          <applications>
            <application>
              <name>Scan Ages</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>3</expression>
              <name>Quick Scan was not performed for more then 3 days on {HOST.HOST}</name>
              <priority>AVERAGE</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Real Time Protection Enabled</name>
          <key>wmi.get["root\microsoft\windows\defender","select RealTimeProtectionEnabled from MSFT_MpComputerStatus"]</key>
          <delay>1h</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>Features</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(True)}&lt;>1</expression>
              <name>Real Time Protection Disabled on {HOST.HOST}</name>
              <priority>WARNING</priority>
            </trigger>
          </triggers>
        </item>
      </items>
    </template>
  </templates>
</zabbix_export>