<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-22T10:07:18Z</date>
  <groups>
    <group>
      <name>A-OVR_TPLGPR</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Windows Physical Disk IOPS</template>
      <name>Windows Physical Disk IOPS</name>
      <groups>
        <group>
          <name>A-OVR_TPLGPR</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>PhysicalDisk</name>
        </application>
      </applications>
      <discovery_rules>
        <discovery_rule>
          <name>Discover PhysicalDisk</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[%SystemRoot%\system32\WindowsPowerShell\v1.0\powershell.exe -executionpolicy ByPass -nologo -EncodedCommand {$DISCOVERDISK1}{$DISCOVERDISK2}{$DISCOVERDISK3}{$DISCOVERDISK4}{$DISCOVERDISK5}]</key>
          <delay>1d</delay>
          <lifetime>7d</lifetime>
          <description>Encoded command splitted in 5 macro: $drives = Get-WmiObject win32_PerfFormattedData_PerfDisk_PhysicalDisk | ?{$_.name -ne "_Total"} | Select Name;$idx = 1;write-host "{";write-host " `"data`":[`n";foreach ($perfDrives in $drives){if ($idx -lt $drives.Count){ $line= "{ `"{#DISKNUMLET}`" : `"" + $perfDrives.Name + "`" },";write-host $line;}elseif ($idx -ge $drives.Count){$line= "{ `"{#DISKNUMLET}`" : `"" + $perfDrives.Name + "`" }";write-host $line;}$idx++;};write-host;write-host " ]";write-host "}";</description>
          <item_prototypes>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Average Disk Bytes Total</name>
              <type>CALCULATED</type>
              <key>AvgDiskBytesTotal[({#DISKNUMLET})]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <units>B</units>
              <params>last("perf_counter[\"\234({#DISKNUMLET})\226\"]",0)+last("perf_counter[\"\234({#DISKNUMLET})\228\"]",0)</params>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - % Disk saturation</name>
              <type>CALCULATED</type>
              <key>DiskSaturation[({#DISKNUMLET})]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <params>100-last("perf_counter[\"\234({#DISKNUMLET})\1482\"]",0)</params>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Current Disk Queue Length</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\198"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Avg. Disk sec/Read (Latency)</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\208"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <units>s</units>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Avg. Disk sec/Write (Latency)</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\210"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <units>s</units>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Avg. Disk sec/Transfer (Latency)</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\212"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <units>s</units>
              <description>Avg. Disk sec/Transfer (Avg. Disk sec/Read, Avg. Disk sec/Write) Displays the average time the disk transfers took to complete, in seconds. Although the scale is seconds, the counter has millisecond precision, meaning a value of 0.004 indicates the average time for disk transfers to complete was 4 milliseconds. This is the counter in Perfmon used to measure IO latency.</description>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>0.001</params>
                </step>
              </preprocessing>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{avg(1m)}>=20</expression>
                  <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
                  <recovery_expression>{avg(1m)}&lt;20</recovery_expression>
                  <name>Disk ({#DISKNUMLET}) - Disk high latency (>20ms) since 1 minute</name>
                  <priority>WARNING</priority>
                  <description>Should not be higher than ~20ms</description>
                  <manual_close>YES</manual_close>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Average Disk Bytes Read</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\226"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <units>B</units>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Average Disk Bytes Write</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\228"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <units>B</units>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - Avg. Disk Queue Length</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\1400"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Disk ({#DISKNUMLET}) - % Idle Time</name>
              <type>ZABBIX_ACTIVE</type>
              <key>perf_counter["\234({#DISKNUMLET})\1482"]</key>
              <delay>15s</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <applications>
                <application>
                  <name>PhysicalDisk</name>
                </application>
              </applications>
            </item_prototype>
          </item_prototypes>
          <trigger_prototypes>
            <trigger_prototype>
              <expression>{Windows Physical Disk IOPS:DiskSaturation[({#DISKNUMLET})].avg(5m)}>=99 or {Windows Physical Disk IOPS:perf_counter["\234({#DISKNUMLET})\1400"].avg(1m)}>=20</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{Windows Physical Disk IOPS:DiskSaturation[({#DISKNUMLET})].avg(5m)}&lt;99 or {Windows Physical Disk IOPS:perf_counter["\234({#DISKNUMLET})\1400"].avg(1m)}&lt;20</recovery_expression>
              <name>Disk ({#DISKNUMLET}) - Disk activity saturation for 5 minutes</name>
              <priority>WARNING</priority>
              <description>% Idle Time This counter provides a very precise measurement of how much time the disk remained in idle state, meaning all the requests from the operating system to the disk have been completed and there is zero pending requests. This is how itâ€™s calculated, the system timestamps an event when the disk goes idle, then timestamps another event when the disk receives a new request. At the end of the capture interval, we calculate the percentage of the time spent in idle. This counter ranges from 100 (meaning always Idle) to 0 (meaning always busy).</description>
              <manual_close>YES</manual_close>
            </trigger_prototype>
          </trigger_prototypes>
          <graph_prototypes>
            <graph_prototype>
              <name>Disk ({#DISKNUMLET}) - Data Rate</name>
              <ymin_type_1>FIXED</ymin_type_1>
              <graph_items>
                <graph_item>
                  <drawtype>GRADIENT_LINE</drawtype>
                  <color>1A7C11</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>perf_counter["\234({#DISKNUMLET})\226"]</key>
                  </item>
                </graph_item>
                <graph_item>
                  <sortorder>1</sortorder>
                  <drawtype>GRADIENT_LINE</drawtype>
                  <color>F63100</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>perf_counter["\234({#DISKNUMLET})\228"]</key>
                  </item>
                </graph_item>
                <graph_item>
                  <sortorder>2</sortorder>
                  <drawtype>BOLD_LINE</drawtype>
                  <color>2774A4</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>AvgDiskBytesTotal[({#DISKNUMLET})]</key>
                  </item>
                </graph_item>
              </graph_items>
            </graph_prototype>
            <graph_prototype>
              <name>Disk ({#DISKNUMLET}) - Latency</name>
              <ymin_type_1>FIXED</ymin_type_1>
              <graph_items>
                <graph_item>
                  <drawtype>GRADIENT_LINE</drawtype>
                  <color>1A7C11</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>perf_counter["\234({#DISKNUMLET})\208"]</key>
                  </item>
                </graph_item>
                <graph_item>
                  <sortorder>1</sortorder>
                  <drawtype>BOLD_LINE</drawtype>
                  <color>F63100</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>perf_counter["\234({#DISKNUMLET})\212"]</key>
                  </item>
                </graph_item>
                <graph_item>
                  <sortorder>2</sortorder>
                  <drawtype>GRADIENT_LINE</drawtype>
                  <color>2774A4</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>perf_counter["\234({#DISKNUMLET})\210"]</key>
                  </item>
                </graph_item>
              </graph_items>
            </graph_prototype>
            <graph_prototype>
              <name>Disk ({#DISKNUMLET}) - Saturation and Queue</name>
              <ymin_type_1>FIXED</ymin_type_1>
              <ymax_type_1>FIXED</ymax_type_1>
              <graph_items>
                <graph_item>
                  <drawtype>GRADIENT_LINE</drawtype>
                  <color>1A7C11</color>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>DiskSaturation[({#DISKNUMLET})]</key>
                  </item>
                </graph_item>
                <graph_item>
                  <sortorder>1</sortorder>
                  <drawtype>BOLD_LINE</drawtype>
                  <color>F63100</color>
                  <yaxisside>RIGHT</yaxisside>
                  <item>
                    <host>Windows Physical Disk IOPS</host>
                    <key>perf_counter["\234({#DISKNUMLET})\198"]</key>
                  </item>
                </graph_item>
              </graph_items>
            </graph_prototype>
          </graph_prototypes>
        </discovery_rule>
      </discovery_rules>
      <macros>
        <macro>
          <macro>{$DISCOVERDISK1}</macro>
          <value>JABkAHIAaQB2AGUAcwAgAD0AIABHAGUAdAAtAFcAbQBpAE8AYgBqAGUAYwB0ACAAdwBpAG4AMwAyAF8AUABlAHIAZgBGAG8AcgBtAGEAdAB0AGUAZABEAGEAdABhAF8AUABlAHIAZgBEAGkAcwBrAF8AUABoAHkAcwBpAGMAYQBsAEQAaQBzAGsAIAB8ACAAPwB7ACQAXwAuAG4AYQBtAGUAIAAtAG4AZQAgACIAXwBUAG8AdABhAGwAIgB9ACA</value>
        </macro>
        <macro>
          <macro>{$DISCOVERDISK2}</macro>
          <value>AfAAgAFMAZQBsAGUAYwB0ACAATgBhAG0AZQA7ACQAaQBkAHgAIAA9ACAAMQA7AHcAcgBpAHQAZQAtAGgAbwBzAHQAIAAiAHsAIgA7AHcAcgBpAHQAZQAtAGgAbwBzAHQAIAAiACAAYAAiAGQAYQB0AGEAYAAiADoAWwBgAG4AIgA7AGYAbwByAGUAYQBjAGgAIAAoACQAcABlAHIAZgBEAHIAaQB2AGUAcwAgAGkAbgAgACQAZAByAGkAdgBlAH</value>
        </macro>
        <macro>
          <macro>{$DISCOVERDISK3}</macro>
          <value>MAKQB7AGkAZgAgACgAJABpAGQAeAAgAC0AbAB0ACAAJABkAHIAaQB2AGUAcwAuAEMAbwB1AG4AdAApAHsAIAAgACAAIAAgACAAIAAkAGwAaQBuAGUAPQAgACIAewAgAGAAIgB7ACMARABJAFMASwBOAFUATQBMAEUAVAB9AGAAIgAgADoAIABgACIAIgAgACsAIAAkAHAAZQByAGYARAByAGkAdgBlAHMALgBOAGEAbQBlACAAKwAgACIAYAAiA</value>
        </macro>
        <macro>
          <macro>{$DISCOVERDISK4}</macro>
          <value>CAAfQAsACIAOwB3AHIAaQB0AGUALQBoAG8AcwB0ACAAJABsAGkAbgBlADsAfQBlAGwAcwBlAGkAZgAgACgAJABpAGQAeAAgAC0AZwBlACAAJABkAHIAaQB2AGUAcwAuAEMAbwB1AG4AdAApAHsAJABsAGkAbgBlAD0AIAAiAHsAIABgACIAewAjAEQASQBTAEsATgBVAE0ATABFAFQAfQBgACIAIAA6ACAAYAAiACIAIAArACAAJABwAGUAcgBm</value>
        </macro>
        <macro>
          <macro>{$DISCOVERDISK5}</macro>
          <value>AEQAcgBpAHYAZQBzAC4ATgBhAG0AZQAgACsAIAAiAGAAIgAgAH0AIgA7AHcAcgBpAHQAZQAtAGgAbwBzAHQAIAAkAGwAaQBuAGUAOwB9ACQAaQBkAHgAKwArADsAfQA7AHcAcgBpAHQAZQAtAGgAbwBzAHQAOwB3AHIAaQB0AGUALQBoAG8AcwB0ACAAIgAgAF0AIgA7AHcAcgBpAHQAZQAtAGgAbwBzAHQAIAAiAH0AIgA7AA0ACgA=</value>
        </macro>
      </macros>
    </template>
  </templates>
</zabbix_export>