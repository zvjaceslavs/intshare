<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-22T10:09:34Z</date>
  <groups>
    <group>
      <name>UM_DOIT_Metrics/Templates</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Metrics Windows Defender</template>
      <name>Metrics Windows Defender</name>
      <description>Uses macro {$AV_EVENTLOG} for the eventlog, Windows defender uses "Microsoft-Windows-Windows Defender/Operational". Windows Antimalware uses "System", but also needs {$AV_SOURCE} set to "Microsoft Antimalware", default value in the template is an empty string.</description>
      <groups>
        <group>
          <name>UM_DOIT_Metrics/Templates</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>Platform Antimalware</name>
        </application>
      </applications>
      <items>
        <item>
          <name>Windows defender scan started</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1000,,skip]</key>
          <delay>43s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Windows defender scan completed</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1001,,skip]</key>
          <delay>43s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Windows defender scan cancelled</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1002,,skip]</key>
          <delay>43s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender scan cancelled by user</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender scan failed</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1005,,skip]</key>
          <delay>43s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Antimalware scan failed</name>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender malware detected</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1006|1116,,skip]</key>
          <delay>37s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender malware detected</name>
              <priority>WARNING</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender malware action taken</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1007|1117,,skip]</key>
          <delay>41s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender malware action taken</name>
              <priority>INFO</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender malware action failed</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1008|1118,,skip]</key>
          <delay>30s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender malware action failed</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender history delete</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1013,,skip]</key>
          <delay>30s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Antimalware history deleted</name>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender suspicious behavior detected</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1015,,skip]</key>
          <delay>30s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender suspicious behaviour detected</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender malware action critically failed</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1119,,skip]</key>
          <delay>30s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender malware action critically failed</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender healthy</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1150,,skip]</key>
          <delay>47s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Windows defender signature update failed</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},2001,,skip]</key>
          <delay>59s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Windows defender platform almost out of date</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},2007,,skip]</key>
          <delay>59s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender platform almost out of date</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender RTP failure</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},3002,,skip]</key>
          <delay>53s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender RTP failure</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
              <dependencies>
                <dependency>
                  <name>Windows Defender engine failure</name>
                  <expression>{Metrics Windows Defender:eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},5008,,skip].nodata(24h)}=0</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender RTP disabled</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},5001,,skip]</key>
          <delay>53s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Antimalware RTP disabled</name>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender engine failure</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},5008,,skip]</key>
          <delay>53s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Defender engine failure</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows defender antispyware disabled</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},5010,,skip]</key>
          <delay>53s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Windows defender antivirus disabled</name>
          <type>ZABBIX_ACTIVE</type>
          <key>eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},5012,,skip]</key>
          <delay>53s</delay>
          <trends>0</trends>
          <value_type>LOG</value_type>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Antimalware antispyware disabled</name>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{nodata(24h)}=0</expression>
              <name>Windows Antimalware antivirus disabled</name>
              <tags>
                <tag>
                  <tag>ISAM</tag>
                  <value>SCEP</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Windows antimalware service state</name>
          <type>ZABBIX_ACTIVE</type>
          <key>service.info[MsMpSvc]</key>
          <delay>120s</delay>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <valuemap>
            <name>Windows service state</name>
          </valuemap>
        </item>
        <item>
          <name>Windows defender service state</name>
          <type>ZABBIX_ACTIVE</type>
          <key>service.info[WinDefend]</key>
          <delay>120s</delay>
          <applications>
            <application>
              <name>Platform Antimalware</name>
            </application>
          </applications>
          <valuemap>
            <name>Windows service state</name>
          </valuemap>
        </item>
      </items>
      <macros>
        <macro>
          <macro>{$AV_EVENTLOG}</macro>
          <value>Microsoft-Windows-Windows Defender/Operational</value>
        </macro>
        <macro>
          <macro>{$AV_SOURCE}</macro>
        </macro>
      </macros>
    </template>
  </templates>
  <triggers>
    <trigger>
      <expression>{Metrics Windows Defender:service.info[MsMpSvc].last()}&lt;>0 and {Metrics Windows Defender:service.info[WinDefend].last()}&lt;>0</expression>
      <name>No malware scan service running</name>
      <priority>AVERAGE</priority>
      <manual_close>YES</manual_close>
    </trigger>
    <trigger>
      <expression>{Metrics Windows Defender:service.info[MsMpSvc].last()}=0 and {Metrics Windows Defender:eventlog[{$AV_EVENTLOG},,,{$AV_SOURCE},1150,,skip].nodata(8h)}=1</expression>
      <name>Windows Antimalware set macro $AV_EVENTLOG = System</name>
      <manual_close>YES</manual_close>
    </trigger>
  </triggers>
  <value_maps>
    <value_map>
      <name>Windows service state</name>
      <mappings>
        <mapping>
          <value>0</value>
          <newvalue>Running</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>Paused</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>Start pending</newvalue>
        </mapping>
        <mapping>
          <value>3</value>
          <newvalue>Pause pending</newvalue>
        </mapping>
        <mapping>
          <value>4</value>
          <newvalue>Continue pending</newvalue>
        </mapping>
        <mapping>
          <value>5</value>
          <newvalue>Stop pending</newvalue>
        </mapping>
        <mapping>
          <value>6</value>
          <newvalue>Stopped</newvalue>
        </mapping>
        <mapping>
          <value>7</value>
          <newvalue>Unknown</newvalue>
        </mapping>
        <mapping>
          <value>255</value>
          <newvalue>No such service</newvalue>
        </mapping>
      </mappings>
    </value_map>
  </value_maps>
</zabbix_export>