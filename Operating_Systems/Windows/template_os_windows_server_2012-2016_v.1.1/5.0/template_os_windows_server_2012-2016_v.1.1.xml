<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-22T10:08:51Z</date>
  <groups>
    <group>
      <name>Templates</name>
    </group>
    <group>
      <name>Templates/Operating systems</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Template OS Windows Server 2012-2016</template>
      <name>Template OS Windows Server 2012-2016</name>
      <description>Шаблон подходит для ОС Windows Server 2012, 2016. Посетите. Группа ВК:https://vk.com/simplezabbix Видео про шаблон:https://youtu.be/FWqFyRu8hmQ</description>
      <groups>
        <group>
          <name>Templates</name>
        </group>
        <group>
          <name>Templates/Operating systems</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>Диск</name>
        </application>
        <application>
          <name>Память</name>
        </application>
        <application>
          <name>Процессор</name>
        </application>
        <application>
          <name>Сеть</name>
        </application>
        <application>
          <name>Система</name>
        </application>
        <application>
          <name>Службы</name>
        </application>
      </applications>
      <items>
        <item>
          <name>Проверка статуса Firewall</name>
          <key>CheckFirewall</key>
          <delay>4h</delay>
          <history>7d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>Для работы нужно добавить в файл конфигурации zabbix агента #CheckFirewall UserParameter=CheckFirewall, PowerShell.exe "(Get-NetFirewallProfile -Profile Domain,Public,Private).enabled"</description>
          <applications>
            <application>
              <name>Система</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{str(False)}=1</expression>
              <name>Отключен firewall Windows</name>
              <priority>WARNING</priority>
              <description>{ITEM.LASTVALUE}</description>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Безопасность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Проверка по ICMP (ping)</name>
          <type>SIMPLE</type>
          <key>icmpping</key>
          <delay>30s</delay>
          <history>1d</history>
          <trends>7d</trends>
          <applications>
            <application>
              <name>Сеть</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}=0</expression>
              <name>Интерфейс узла сети не доступен (no ping)</name>
              <priority>HIGH</priority>
              <description>{HOST.IP}</description>
              <tags>
                <tag>
                  <tag>Доступность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Memory Available (Physical) %</name>
          <type>CALCULATED</type>
          <key>MemoryAvailablePhysicalProc</key>
          <history>7d</history>
          <trends>180d</trends>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>100*last("perf_counter[\"\4\24\",60]")/last("system.run[Powershell.exe \"((Get-WmiObject Win32_PhysicalMemory).Capacity | Measure-Object -Sum).Sum\"]")</params>
          <description>Процент используемой физической памяти</description>
          <applications>
            <application>
              <name>Память</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{avg(5m)}&lt;8</expression>
              <name>Memory Available (Physical) > 92% (5 min)</name>
              <priority>WARNING</priority>
              <description>ОС использует > 92% от физической памяти более 5 минут</description>
              <dependencies>
                <dependency>
                  <name>Memory Available (Physical) > 96% (5 min)</name>
                  <expression>{Template OS Windows Server 2012-2016:MemoryAvailablePhysicalProc.avg(5m)}&lt;4</expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(5m)}&lt;4</expression>
              <name>Memory Available (Physical) > 96% (5 min)</name>
              <priority>HIGH</priority>
              <description>ОС использует > 96% от физической памяти более 5 минут Если объем доступной памяти слишком мал, есть вероятность, что система начнет использовать для активных процессов файл подкачки. Если системе не хватает физической памяти, то результатом этого могут быть значительные задержки и/или полное зависание системы</description>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Processor Queue Length</name>
          <key>perf_counter["\2\44",60]</key>
          <history>7d</history>
          <trends>90d</trends>
          <value_type>FLOAT</value_type>
          <description>Показания счетчика действительно очень важны для поиска проблем с производительностью процессора. Постоянное наличие большой очереди запросов к ЦП явно свидетельствует о том, что процессор не справляется с обработкой данных и является узким местом.</description>
          <applications>
            <application>
              <name>Процессор</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{avg(5m)}>4</expression>
              <name>Processor Queue Length > 4 (5 min)</name>
              <priority>AVERAGE</priority>
              <description>Обратите внимание на Processor Queue Length > 4 в течение 5 минут. Этот счетчик показывает, сколько запросов стоит в очереди на обработку центральным процессором. Значение этого счетчика не должно в течение продолжительного времени превышать количество процессоров в системе, умноженное на 2 (например, если на сервере 4 процессора, то это значение не должно быть больше 8); Получите обратную связь от пользователей приложения. Если приложение работает нормально и пользователи не испытывают проблем при работе с ПО, нужно повысить пороговое значение. Но стоит подключиться к более глубокому анализу производительности ЦП как слабого места, разобраться в причине или увеличить ресурсы серверу.</description>
              <dependencies>
                <dependency>
                  <name>Processor Queue Length > 10 (3 min)</name>
                  <expression>{Template OS Windows Server 2012-2016:perf_counter["\2\44",60].avg(3m)}>10</expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(3m)}>10</expression>
              <name>Processor Queue Length > 10 (3 min)</name>
              <priority>HIGH</priority>
              <description>Критическое значение очереди > 10 в течение 3 минут. Нужно разобраться в причине или увеличить ресурсы серверу.</description>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Processor Context Switches</name>
          <key>perf_counter["\2\146",60]</key>
          <history>7d</history>
          <trends>90d</trends>
          <value_type>FLOAT</value_type>
          <description>в многозадачных ОС и средах - процесс прекращения выполнения процессором одной задачи (процесса, потока, нити) с сохранением всей необходимой информации и состояния, необходимых для последующего продолжения с прерванного места, и восстановления и загрузки состояния задачи, к выполнению которой переходит процессор.</description>
          <applications>
            <application>
              <name>Процессор</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Memory Available Bytes</name>
          <key>perf_counter["\4\24",60]</key>
          <history>7d</history>
          <trends>90d</trends>
          <value_type>FLOAT</value_type>
          <units>B</units>
          <applications>
            <application>
              <name>Память</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Memory Commit Limit</name>
          <key>perf_counter["\4\30",300]</key>
          <delay>5m</delay>
          <history>7d</history>
          <trends>90d</trends>
          <value_type>FLOAT</value_type>
          <units>B</units>
          <description>показывает максимальный объем памяти, который может быть выделен системой. Обычно это фиксированная величина, которая определяется операционной системой</description>
          <applications>
            <application>
              <name>Память</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Memory Committed Bytes In Use %</name>
          <key>perf_counter["\4\1406",300]</key>
          <delay>5m</delay>
          <history>7d</history>
          <trends>90d</trends>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <description>Соотношение величин счетчиков Commited Bytes и Commit Limit. Следя за счетчиком %Committed Bytes In Use, можно увидеть, что при достижении им величины 100% система начнет увеличивать размеры файла подкачки, пытаясь удовлетворить растущие запросы на память.</description>
          <applications>
            <application>
              <name>Память</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{last()}>85</expression>
              <name>Committed Bytes In Use > 85%</name>
              <priority>AVERAGE</priority>
              <description>Предел выделенной памяти будет расти, если общий объем выделенной памяти приблизится к 90% от предельного значения — если же значение достигнет 95%, то предел вероятно перестанет расти, и появится вероятность возникновения ошибки OutOfMemory. Как только объем выделенной памяти достигнет предела, то система больше не сможет выделять память для процессов. Большинство процессов не справится с данным поведением системы и прекратят свое выполнение. Поэтому очень важно следить за этим счетчиком.</description>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Process Total Private Bytes</name>
          <key>perf_counter["\230(_Total)\186",300]</key>
          <delay>5m</delay>
          <history>7d</history>
          <trends>90d</trends>
          <value_type>FLOAT</value_type>
          <units>B</units>
          <description>показывает объем выделенной памяти для процесса. Если сумма всех private bytes для всех процессов превысит предел памяти, описанный выше, это значит, что в системе образовалась нехватка памяти и приложения будут отказывать</description>
          <applications>
            <application>
              <name>Память</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Processor Time</name>
          <key>perf_counter["\238(_Total)\6",60]</key>
          <history>7d</history>
          <trends>180d</trends>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <description>Загруженность процессора в % (среднее значение за 1 минуту)</description>
          <applications>
            <application>
              <name>Процессор</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{avg(5m)}>85</expression>
              <name>Processor Time > 85% (5 min)</name>
              <priority>AVERAGE</priority>
              <description>Нужно выяснить почему загружен процессор, если высокая загрузка связанна не с проблемами в работе приложений необходимо добавить ресурсов серверу.</description>
              <dependencies>
                <dependency>
                  <name>Processor Time > 85% (15 min)</name>
                  <expression>{Template OS Windows Server 2012-2016:perf_counter["\238(_Total)\6",60].avg(15m)}>85</expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(15m)}>85</expression>
              <name>Processor Time > 85% (15 min)</name>
              <priority>HIGH</priority>
              <description>Нужно выяснить почему загружен процессор, если высокая загрузка связанна не с проблемами в работе приложений необходимо добавить ресурсов серверу.</description>
              <tags>
                <tag>
                  <tag>Производительность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Системное время UTC</name>
          <key>system.localtime[utc]</key>
          <history>1d</history>
          <trends>30d</trends>
          <applications>
            <application>
              <name>Система</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{fuzzytime(1)}=0</expression>
              <name>Fuzzytime > 1s</name>
              <priority>HIGH</priority>
              <description>Разница в системном времени между хостом и сервером Zabbix больше 1 сек Проверьте состояние службы времени в ОС Полезные команды: w32tm /resync - выполнение синхронизации времени w32tm /resync /rediscover - Принудительная синхронизация от источника w32tm /query /peers - Отображение текущих источников синхронизации и их статуса w32tm /config /update - Применение внесенных в конфигурацию изменений w32tm /monitor - Отображение состояния синхронизации контроллеров домена в домене net stop w32time - остановка службы net start w32time - запуск службы</description>
              <dependencies>
                <dependency>
                  <name>Fuzzytime > 5s</name>
                  <expression>{Template OS Windows Server 2012-2016:system.localtime[utc].fuzzytime(5)}=0</expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Доступность</tag>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{fuzzytime(5)}=0</expression>
              <name>Fuzzytime > 5s</name>
              <priority>DISASTER</priority>
              <description>Разница в системном времени между хостом и сервером Zabbix больше 5 сек Проверьте состояние службы времени в ОС Полезные команды: w32tm /resync - выполнение синхронизации времени w32tm /resync /rediscover - Принудительная синхронизация от источника w32tm /query /peers - Отображение текущих источников синхронизации и их статуса w32tm /config /update - Применение внесенных в конфигурацию изменений w32tm /monitor - Отображение состояния синхронизации контроллеров домена в домене net stop w32time - остановка службы net start w32time - запуск службы</description>
              <tags>
                <tag>
                  <tag>Доступность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Проверка Обновлений</name>
          <key>system.run["PowerShell.exe Get-Date -Date \"((get-wmiobject -class win32_quickfixengineering).installedon | sort -Descending)[0] -Uformat %s\""]</key>
          <delay>4h</delay>
          <history>7d</history>
          <trends>7d</trends>
          <description>Если в системе нет установленных обновлений, то элемент данных станет не поддерживаемый. Так как скрипт выдает ошибку.</description>
          <applications>
            <application>
              <name>Система</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>RTRIM</type>
              <params><![CDATA[ ]]></params>
            </step>
          </preprocessing>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{nodata(8h)}=1</expression>
              <name>Zabbix не смог получить данных о обновления в системе</name>
              <priority>INFO</priority>
              <description>Проверите работу zabbix agenta</description>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Безопасность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Проверка Cертификата</name>
          <key>system.run[Powershell.exe "&amp; {(Get-ChildItem -Path cert: -Recurse -ExpiringInDays 45 | where {$_.PSPath -notmatch 'Remote Desktop' -and $_.PSPath -notmatch 'Operations Manager'}).subject}"]</key>
          <delay>4h</delay>
          <history>7d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <applications>
            <application>
              <name>Система</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{nodata(8h)}=1</expression>
              <name>Zabbix не смог получить данных о сертификатах</name>
              <status>DISABLED</status>
              <priority>INFO</priority>
              <description>Проверите работу элемента данных.</description>
              <tags>
                <tag>
                  <tag>Безопасность</tag>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{strlen()}>1</expression>
              <name>Проблема с сертификатом</name>
              <status>DISABLED</status>
              <priority>WARNING</priority>
              <description>В системе есть сертификат срок действия которого истекает через 45 дней {ITEM.LASTVALUE} Проверьте сертификаты в системе. Имя сертификата можно узнать в меню Мониторинг > Последние данные.</description>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Безопасность</tag>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Memory Capacity (Physical) Bytes</name>
          <key>system.run[Powershell.exe "((Get-WmiObject Win32_PhysicalMemory).Capacity | Measure-Object -Sum).Sum"]</key>
          <delay>24h</delay>
          <history>7d</history>
          <trends>90d</trends>
          <units>B</units>
          <description>Размер физической памяти</description>
          <applications>
            <application>
              <name>Память</name>
            </application>
          </applications>
        </item>
      </items>
      <discovery_rules>
        <discovery_rule>
          <name>discovery Interface</name>
          <key>net.if.discovery</key>
          <delay>24h</delay>
          <filter>
            <evaltype>AND</evaltype>
            <conditions>
              <condition>
                <macro>{#IFNAME}</macro>
                <value>@Network interfaces for discovery</value>
                <formulaid>A</formulaid>
              </condition>
              <condition>
                <macro>{#IFNAME}</macro>
                <value>@Microsoft Network Adapter</value>
                <formulaid>B</formulaid>
              </condition>
            </conditions>
          </filter>
          <lifetime>7d</lifetime>
          <description>Обнаружение сетевых интрефейсов</description>
          <item_prototypes>
            <item_prototype>
              <name>Interface:{#IFNAME}, Sent Bytes/sec</name>
              <key>perf_counter["\510({#IFNAME})\506",60]</key>
              <history>30d</history>
              <trends>30d</trends>
              <value_type>FLOAT</value_type>
              <units>bps</units>
              <applications>
                <application>
                  <name>Сеть</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Interface:{#IFNAME}, Current Bandwidth</name>
              <key>perf_counter["\510({#IFNAME})\520",]</key>
              <delay>24h</delay>
              <history>1d</history>
              <trends>7d</trends>
              <units>bps</units>
              <applications>
                <application>
                  <name>Сеть</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Interface:{#IFNAME}, Output Queue Length</name>
              <key>perf_counter["\510({#IFNAME})\544",300]</key>
              <delay>5m</delay>
              <history>7d</history>
              <trends>30d</trends>
              <description>Счетчик фиксирует длину очереди исходящих пакетов адаптера. Приемлемыми считаются значения 1 и 2. Но если этот показатель часто достигает уровня 3, 4 или более высоких отметок, это значит, что сетевой адаптер ввода/вывода не справляется с запросами сервера на передачу данных в сеть.</description>
              <applications>
                <application>
                  <name>Сеть</name>
                </application>
              </applications>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}>3</expression>
                  <name>Interface:{#IFNAME}, Output Queue Length > 3</name>
                  <priority>WARNING</priority>
                  <description>Счетчик фиксирует длину очереди исходящих пакетов адаптера. Приемлемыми считаются значения 1 и 2. Но если этот показатель часто достигает уровня 3, 4 или более высоких отметок, это значит, что сетевой адаптер ввода/вывода не справляется с запросами сервера на передачу данных в сеть.</description>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Interface:{#IFNAME}, Received Bytes/sec</name>
              <key>perf_counter["\510({#IFNAME})\898",60]</key>
              <history>30d</history>
              <trends>30d</trends>
              <value_type>FLOAT</value_type>
              <units>bps</units>
              <applications>
                <application>
                  <name>Сеть</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>Interface:{#IFNAME}, Utilization Received</name>
              <type>CALCULATED</type>
              <key>UtilizationReceived.[{#IFNAME}]</key>
              <history>1d</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <params>100*last("perf_counter[\"\510({#IFNAME})\898\",60]")/last("perf_counter[\"\510({#IFNAME})\520\",]")</params>
              <applications>
                <application>
                  <name>Сеть</name>
                </application>
              </applications>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}>50</expression>
                  <name>Interface:{#IFNAME}, Utilization Received > 50%</name>
                  <priority>INFO</priority>
                  <description>Utilization Received = {ITEM.LASTVALUE}</description>
                  <dependencies>
                    <dependency>
                      <name>Interface:{#IFNAME}, Utilization Received > 90%</name>
                      <expression>{Template OS Windows Server 2012-2016:UtilizationReceived.[{#IFNAME}].last()}>90</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()}>90</expression>
                  <name>Interface:{#IFNAME}, Utilization Received > 90%</name>
                  <priority>HIGH</priority>
                  <description>Utilization Received = {ITEM.LASTVALUE}</description>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Interface:{#IFNAME}, Utilization Sent</name>
              <type>CALCULATED</type>
              <key>UtilizationSent.[{#IFNAME}]</key>
              <history>1d</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <params>100*last("perf_counter[\"\510({#IFNAME})\898\",60]")/last("perf_counter[\"\510({#IFNAME})\520\",]")</params>
              <applications>
                <application>
                  <name>Сеть</name>
                </application>
              </applications>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}>50</expression>
                  <name>Interface:{#IFNAME}, Utilization Sent > 50%</name>
                  <priority>INFO</priority>
                  <description>Utilization Sent = {ITEM.LASTVALUE}</description>
                  <dependencies>
                    <dependency>
                      <name>Interface:{#IFNAME}, Utilization Sent > 90%</name>
                      <expression>{Template OS Windows Server 2012-2016:UtilizationSent.[{#IFNAME}].last()}>90</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()}>90</expression>
                  <name>Interface:{#IFNAME}, Utilization Sent > 90%</name>
                  <priority>HIGH</priority>
                  <description>Utilization Sent = {ITEM.LASTVALUE}</description>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
          <graph_prototypes>
            <graph_prototype>
              <name>Interface:{#IFNAME}, Utilization</name>
              <width>1400</width>
              <height>500</height>
              <ymin_type_1>FIXED</ymin_type_1>
              <ymax_type_1>FIXED</ymax_type_1>
              <graph_items>
                <graph_item>
                  <color>1A7C11</color>
                  <item>
                    <host>Template OS Windows Server 2012-2016</host>
                    <key>UtilizationReceived.[{#IFNAME}]</key>
                  </item>
                </graph_item>
                <graph_item>
                  <sortorder>1</sortorder>
                  <color>F63100</color>
                  <item>
                    <host>Template OS Windows Server 2012-2016</host>
                    <key>UtilizationSent.[{#IFNAME}]</key>
                  </item>
                </graph_item>
              </graph_items>
            </graph_prototype>
          </graph_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>discovery service</name>
          <key>service.discovery</key>
          <delay>24h</delay>
          <filter>
            <evaltype>OR</evaltype>
            <conditions>
              <condition>
                <macro>{#SERVICE.NAME}</macro>
                <value>W32Time</value>
                <formulaid>A</formulaid>
              </condition>
              <condition>
                <macro>{#SERVICE.NAME}</macro>
                <value>MpsSvc</value>
                <formulaid>B</formulaid>
              </condition>
              <condition>
                <macro>{#SERVICE.NAME}</macro>
                <value>Dnscache</value>
                <formulaid>C</formulaid>
              </condition>
              <condition>
                <macro>{#SERVICE.NAME}</macro>
                <value>gpsvc</value>
                <formulaid>D</formulaid>
              </condition>
              <condition>
                <macro>{#SERVICE.NAME}</macro>
                <value>EventLog</value>
                <formulaid>E</formulaid>
              </condition>
              <condition>
                <macro>{#SERVICE.NAME}</macro>
                <value>Schedule</value>
                <formulaid>F</formulaid>
              </condition>
            </conditions>
          </filter>
          <lifetime>7d</lifetime>
          <description>Обнаружение служб Windows</description>
          <item_prototypes>
            <item_prototype>
              <name>Состояние службы {#SERVICE.DISPLAYNAME}</name>
              <key>service.info[{#SERVICE.NAME}]</key>
              <delay>3m</delay>
              <history>7d</history>
              <trends>30d</trends>
              <description>Описание: {#SERVICE.DESCRIPTION}</description>
              <applications>
                <application>
                  <name>Службы</name>
                </application>
              </applications>
              <valuemap>
                <name>Состояние службы</name>
              </valuemap>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}&lt;>0</expression>
                  <name>Состояние службы {#SERVICE.DISPLAYNAME} = {ITEM.LASTVALUE}</name>
                  <priority>HIGH</priority>
                  <description>Состояние службы {#SERVICE.DISPLAYNAME} = {ITEM.LASTVALUE} Если отслеживать состояние службы не нужно, просто отключите триггер</description>
                  <tags>
                    <tag>
                      <tag>Доступность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>discovery local disk</name>
          <key>vfs.fs.discovery</key>
          <delay>24h</delay>
          <filter>
            <evaltype>AND</evaltype>
            <conditions>
              <condition>
                <macro>{#FSTYPE}</macro>
                <value>@File systems for discovery</value>
                <formulaid>A</formulaid>
              </condition>
              <condition>
                <macro>{#FSTYPE}</macro>
                <value>^NTFS|^ReFS</value>
                <formulaid>B</formulaid>
              </condition>
            </conditions>
          </filter>
          <lifetime>7d</lifetime>
          <description>Обнаружение дисков</description>
          <item_prototypes>
            <item_prototype>
              <name>LogicalDisk {#FSNAME} Disk Time %</name>
              <key>perf_counter["\236({#FSNAME})\200",300]</key>
              <delay>5m</delay>
              <history>7d</history>
              <trends>90d</trends>
              <value_type>FLOAT</value_type>
              <description>Тип файловой системы:{#FSTYPE} Тип диска:{#FSDRIVETYPE} Счетчик отображает, какую часть времени диск расходует на обслуживание запросов на чтение и запись. Если его значения стабильно сохраняются на уровне вблизи отметки 100%, система работает с диском весьма интенсивно. Если же идет постоянный активный обмен данными и при этом создаются большие очереди, возможно, что дисковая подсистема не справляется с нагрузкой. В типичных условиях эксплуатации значение этого счетчика не должно превышать 50.</description>
              <applications>
                <application>
                  <name>Диск</name>
                </application>
              </applications>
            </item_prototype>
            <item_prototype>
              <name>LogicalDisk {#FSNAME} Free Space</name>
              <key>perf_counter["\236({#FSNAME})\408",300]</key>
              <delay>5m</delay>
              <history>30d</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <description>Тип файловой системы:{#FSTYPE} Тип диска:{#FSDRIVETYPE}</description>
              <applications>
                <application>
                  <name>Диск</name>
                </application>
              </applications>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}&lt;4</expression>
                  <name>LogicalDisk {#FSNAME} Free Space &lt; 4%</name>
                  <priority>HIGH</priority>
                  <tags>
                    <tag>
                      <tag>Доступность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()}&lt;8</expression>
                  <name>LogicalDisk {#FSNAME} Free Space &lt; 8%</name>
                  <priority>AVERAGE</priority>
                  <dependencies>
                    <dependency>
                      <name>LogicalDisk {#FSNAME} Free Space &lt; 4%</name>
                      <expression>{Template OS Windows Server 2012-2016:perf_counter["\236({#FSNAME})\408",300].last()}&lt;4</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Доступность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>LogicalDisk {#FSNAME} Avg. Disk Queue Length</name>
              <key>perf_counter["\236({#FSNAME})\1400",60]</key>
              <history>7d</history>
              <trends>90d</trends>
              <value_type>FLOAT</value_type>
              <description>Тип файловой системы:{#FSTYPE} Тип диска:{#FSDRIVETYPE} Показатель этого счетчика отражает среднее число ожидающих обработки запросов к диску на ввод и вывод данных. Если он стабильно выше 2, значит, в диске образовался «затор».</description>
              <applications>
                <application>
                  <name>Диск</name>
                </application>
              </applications>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{avg(15m)}>2</expression>
                  <name>LogicalDisk {#FSNAME} Avg. Disk Queue Length > 2 (15 min)</name>
                  <priority>WARNING</priority>
                  <description>Среднее значение за 15 минут > 2 Показатель этого счетчика отражает среднее число ожидающих обработки запросов к диску на ввод и вывод данных. Если он стабильно выше 2, значит, в диске образовался «затор».</description>
                  <dependencies>
                    <dependency>
                      <name>LogicalDisk {#FSNAME} Avg. Disk Queue Length > 10 (3 min)</name>
                      <expression>{Template OS Windows Server 2012-2016:perf_counter["\236({#FSNAME})\1400",60].avg(3m)}>10</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{avg(3m)}>10</expression>
                  <name>LogicalDisk {#FSNAME} Avg. Disk Queue Length > 10 (3 min)</name>
                  <priority>HIGH</priority>
                  <description>Среднее значение за 3 минут > 10 Показатель этого счетчика отражает среднее число ожидающих обработки запросов к диску на ввод и вывод данных. Если он стабильно выше 10, значит, у системы серьезные проблема с производительностью диска.</description>
                  <tags>
                    <tag>
                      <tag>Производительность</tag>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
      </discovery_rules>
    </template>
  </templates>
  <triggers>
    <trigger>
      <expression>{Template OS Windows Server 2012-2016:perf_counter["\230(_Total)\186",300].last()}>={Template OS Windows Server 2012-2016:perf_counter["\4\30",300].last()}</expression>
      <name>Process Total Private Bytes > Memory Commit Limit</name>
      <priority>HIGH</priority>
      <description>Process\Private Bytes показывает объем выделенной памяти для процесса. Если сумма всех private bytes для всех процессов превысит предел памяти(Memory Commit Limit), это значит, что в системе образовалась нехватка памяти и приложения будут отказывать.</description>
      <tags>
        <tag>
          <tag>Доступность</tag>
        </tag>
      </tags>
    </trigger>
    <trigger>
      <expression>({Template OS Windows Server 2012-2016:system.localtime[utc].now()}-{Template OS Windows Server 2012-2016:system.run["PowerShell.exe Get-Date -Date \"((get-wmiobject -class win32_quickfixengineering).installedon | sort -Descending)[0] -Uformat %s\""].last()})>7889229</expression>
      <name>Обновления Windows не устанавливались > 3м</name>
      <priority>INFO</priority>
      <description>Нужно согласовать установку обновлений на сервере. И провести установку обновлений. Обновления Windows не устанавливались более 3 месяцев</description>
      <tags>
        <tag>
          <tag>Безопасность</tag>
        </tag>
      </tags>
    </trigger>
  </triggers>
  <value_maps>
    <value_map>
      <name>Состояние службы</name>
      <mappings>
        <mapping>
          <value>0</value>
          <newvalue>запущена</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>пауза</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>ожидание старта</newvalue>
        </mapping>
        <mapping>
          <value>3</value>
          <newvalue>ожидание паузы</newvalue>
        </mapping>
        <mapping>
          <value>4</value>
          <newvalue>ожидание продолжения</newvalue>
        </mapping>
        <mapping>
          <value>5</value>
          <newvalue>ожидание остановки</newvalue>
        </mapping>
        <mapping>
          <value>6</value>
          <newvalue>остановлена</newvalue>
        </mapping>
        <mapping>
          <value>7</value>
          <newvalue>неизвестно</newvalue>
        </mapping>
        <mapping>
          <value>255</value>
          <newvalue>такой службы не существует</newvalue>
        </mapping>
      </mappings>
    </value_map>
  </value_maps>
</zabbix_export>