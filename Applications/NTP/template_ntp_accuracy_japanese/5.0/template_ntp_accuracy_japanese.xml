<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-19T20:34:48Z</date>
  <groups>
    <group>
      <name>自宅ラックテンプレート</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>NTP-remote-Japanese</template>
      <name>NTPテンプレート（リモート）</name>
      <groups>
        <group>
          <name>自宅ラックテンプレート</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>NTP(リモート)</name>
        </application>
      </applications>
      <items>
        <item>
          <name>ntpq({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}]</key>
          <delay>3600</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>"*" 参照同期中のサーバーを表している "+" クロック誤り検査に合格したサーバー "#" 参照同期中ではあるが、距離が遠いサーバー " " 左に何も表示されない場合（空欄）、サーバーを参照していない "x" クロック誤り検査に不合格となったサーバー ". " 参照リストから除外されたサーバー refid NTPサーバーが参照している上位ホスト名 or IPアドレス st NTPサーバーの階層 t 階層のタイプ l:local、u:unicast、m:multicast、b:broadcast when 最後のパケットを受け取ってからの時間（秒） poll 問い合わせを行う間隔（秒） reach 到達可能性に関するレジスタ・データ（8進数） delay 推定遅延（ミリ秒） offset 偏差補償（ミリ秒） jitter RMS Jitterの平均値（ミリ秒）</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP同期サーバ({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$1}'|sed s/*//]</key>
          <delay>1800</delay>
          <history>60d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>同期しているNTPサーバー名</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{diff(0)}=1</expression>
              <name>同期しているNTPサーバが変更されました。({$NTP_IP})</name>
              <status>DISABLED</status>
              <priority>INFO</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP上位サーバ({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$2}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>同期しているNTPサーバーの上位NTPサーバ</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP階層({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$3}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <description>同期しているNTPサーバーのstratum</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTPポーリング間隔({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$6}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <units>s</units>
          <description>NTPサーバとの同期間隔</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP推定遅延({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$8}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>NTPパケットの推定遅延時間</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTPオフセット({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>NTPサーバとの時刻ズレ</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>5000 or {last()}&lt;-5000</expression>
              <name>上位NTPとのずれが5sを超えました({$NTP_IP})</name>
              <priority>AVERAGE</priority>
            </trigger>
            <trigger>
              <expression>{last()}>50 or {last()}&lt;-50</expression>
              <name>上位NTPとのずれが50msを超えました({$NTP_IP})</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>上位NTPとのずれが5sを超えました({$NTP_IP})</name>
                  <expression>{NTP-remote-Japanese:system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}'].last()}>5000 or {NTP-remote-Japanese:system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}'].last()}&lt;-5000</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP分散({$NTP_IP})</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$10}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>NTPオフセットの過去8回の分散平均値</description>
          <applications>
            <application>
              <name>NTP(リモート)</name>
            </application>
          </applications>
        </item>
      </items>
      <macros>
        <macro>
          <macro>{$NTP_IP}</macro>
          <value>127.0.0.1</value>
        </macro>
      </macros>
    </template>
    <template>
      <template>NTP_Monitoring-Japanese</template>
      <name>NTPテンプレート</name>
      <groups>
        <group>
          <name>自宅ラックテンプレート</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>NTP</name>
        </application>
      </applications>
      <items>
        <item>
          <name>NTPプロセス</name>
          <key>proc.num[ntpd]</key>
          <delay>60</delay>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTPDバージョン</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -c version]</key>
          <delay>3600</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>ntpq</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p]</key>
          <delay>3600</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>"*" 参照同期中のサーバーを表している "+" クロック誤り検査に合格したサーバー "#" 参照同期中ではあるが、距離が遠いサーバー " " 左に何も表示されない場合（空欄）、サーバーを参照していない "x" クロック誤り検査に不合格となったサーバー ". " 参照リストから除外されたサーバー refid NTPサーバーが参照している上位ホスト名 or IPアドレス st NTPサーバーの階層 t 階層のタイプ l:local、u:unicast、m:multicast、b:broadcast when 最後のパケットを受け取ってからの時間（秒） poll 問い合わせを行う間隔（秒） reach 到達可能性に関するレジスタ・データ（8進数） delay 推定遅延（ミリ秒） offset 偏差補償（ミリ秒） jitter RMS Jitterの平均値（ミリ秒）</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP同期サーバ</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$1}'|sed s/*//]</key>
          <delay>1800</delay>
          <history>60d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>同期しているNTPサーバー名</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{diff(0)}=1</expression>
              <name>同期しているNTPサーバが変更されました。</name>
              <status>DISABLED</status>
              <priority>INFO</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP上位サーバ</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$2}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>同期しているNTPサーバーの上位NTPサーバ</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP階層</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$3}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <description>同期しているNTPサーバーのstratum</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTPポーリング間隔</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$6}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <units>s</units>
          <description>NTPサーバとの同期間隔</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP推定遅延</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$8}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>NTPパケットの推定遅延時間</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTPオフセット</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$9}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>NTPサーバとの時刻ズレ</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last(0)}>5000 or {last(0)}&lt;-5000</expression>
              <name>上位NTPとのずれが5sを超えました</name>
              <priority>AVERAGE</priority>
            </trigger>
            <trigger>
              <expression>{last(0)}>50 or {last(0)}&lt;-50</expression>
              <name>上位NTPとのずれが50msを超えました</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>上位NTPとのずれが5sを超えました</name>
                  <expression>{NTP_Monitoring-Japanese:system.run[ntpq -p|grep \* |awk '{print$9}'].last(0)}>5000 or {NTP_Monitoring-Japanese:system.run[ntpq -p|grep \* |awk '{print$9}'].last(0)}&lt;-5000</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP分散</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$10}']</key>
          <delay>1800</delay>
          <history>60d</history>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>NTPオフセットの過去8回の分散平均値</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
      </items>
    </template>
  </templates>
  <graphs>
    <graph>
      <name>NTP精度情報</name>
      <graph_items>
        <graph_item>
          <color>C80000</color>
          <item>
            <host>NTP_Monitoring-Japanese</host>
            <key>system.run[ntpq -p|grep \* |awk '{print$9}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>1</sortorder>
          <color>00C800</color>
          <item>
            <host>NTP_Monitoring-Japanese</host>
            <key>system.run[ntpq -p|grep \* |awk '{print$10}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>2</sortorder>
          <color>0000C8</color>
          <yaxisside>RIGHT</yaxisside>
          <item>
            <host>NTP_Monitoring-Japanese</host>
            <key>system.run[ntpq -p|grep \* |awk '{print$8}']</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
    <graph>
      <name>NTP精度情報({$NTP_IP})</name>
      <graph_items>
        <graph_item>
          <color>C80000</color>
          <item>
            <host>NTP-remote-Japanese</host>
            <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>1</sortorder>
          <color>00C800</color>
          <item>
            <host>NTP-remote-Japanese</host>
            <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$10}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>2</sortorder>
          <color>0000C8</color>
          <yaxisside>RIGHT</yaxisside>
          <item>
            <host>NTP-remote-Japanese</host>
            <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$8}']</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
  </graphs>
</zabbix_export>