<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-19T20:34:47Z</date>
  <groups>
    <group>
      <name>HomeRackUserGroupTemplates</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>NTP-remote</template>
      <name>NTP[Remote]</name>
      <groups>
        <group>
          <name>HomeRackUserGroupTemplates</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>NTP[Remote]</name>
        </application>
      </applications>
      <items>
        <item>
          <name>ntp[{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}]</key>
          <delay>3600</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>"*" It represents the server in the reference synchronization "+" Server that pass the clock error check "#" It is in the in the reference synchronization , but distance is distant server " " Blank , does not refer to a server "x" Server that fail to clock error check ". " Server that are excluded from the reference list refid Host name or IP address of the high-stratum NTP server NTP server is referencing st NTP Server stratum t stratum type l:local,u:unicast,m:multicast,b:broadcast when The number of seconds after receiving the last packet poll Interval number of seconds to query reach Register data for reachability *octal delay [milliseconds] offset [milliseconds] jitter [milliseconds]</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP synchronized server [{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$1}'|sed s/*//]</key>
          <delay>1800</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>NTP server name that is synchronized</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{diff(0)}=1</expression>
              <name>NTP servers are synchronized has been changed . [{$NTP_IP}]</name>
              <status>DISABLED</status>
              <priority>INFO</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP refid [{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$2}']</key>
          <delay>1800</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>The upper NTP server of the NTP server that is synchronized</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP stratum [{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$3}']</key>
          <delay>1800</delay>
          <description>Stratum of the NTP server that is synchronized</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP polling [{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$6}']</key>
          <delay>1800</delay>
          <units>s</units>
          <description>Synchronization period with the NTP server</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP delay [{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$8}']</key>
          <delay>1800</delay>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>Estimated delay time of the NTP packet</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP offset [{$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}']</key>
          <delay>1800</delay>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>Time deviation between the NTP server</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last()}>5000 or {last()}&lt;-5000</expression>
              <name>Misalignment of the upper NTP has exceeded the 5s [{$NTP_IP}]</name>
              <priority>AVERAGE</priority>
            </trigger>
            <trigger>
              <expression>{last()}>50 or {last()}&lt;-50</expression>
              <name>Misalignment of the upper NTP has exceeded the 50ms [{$NTP_IP}]</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>Misalignment of the upper NTP has exceeded the 5s [{$NTP_IP}]</name>
                  <expression>{NTP-remote:system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}'].last()}>5000 or {NTP-remote:system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}'].last()}&lt;-5000</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP jitter[({$NTP_IP}]</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$10}']</key>
          <delay>1800</delay>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>Past 8 dispersion average value of NTP offset</description>
          <applications>
            <application>
              <name>NTP[Remote]</name>
            </application>
          </applications>
        </item>
      </items>
      <macros>
        <macro>
          <macro>{$NTP_IP}</macro>
          <value>127.0.0.1</value>
        </macro>
      </macros>
    </template>
    <template>
      <template>NTP_Monitoring</template>
      <name>NTP</name>
      <groups>
        <group>
          <name>HomeRackUserGroupTemplates</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>NTP</name>
        </application>
      </applications>
      <items>
        <item>
          <name>proc num NTP</name>
          <key>proc.num[ntpd]</key>
          <delay>60</delay>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>ntpd Version</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -c version]</key>
          <delay>3600</delay>
          <trends>0</trends>
          <value_type>CHAR</value_type>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>ntpq</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p]</key>
          <delay>3600</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>"*" It represents the server in the reference synchronization "+" Server that pass the clock error check "#" It is in the in the reference synchronization , but distance is distant server " " Blank , does not refer to a server "x" Server that fail to clock error check ". " Server that are excluded from the reference list refid Host name or IP address of the high-stratum NTP server NTP server is referencing st NTP Server stratum t stratum type l:local,u:unicast,m:multicast,b:broadcast when The number of seconds after receiving the last packet poll Interval number of seconds to query reach Register data for reachability *octal delay [milliseconds] offset [milliseconds] jitter [milliseconds]</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP synchronized server</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$1}'|sed s/*//]</key>
          <delay>1800</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>NTP server name that is synchronized</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{diff(0)}=1</expression>
              <name>NTP servers are synchronized has been changed .</name>
              <status>DISABLED</status>
              <priority>INFO</priority>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP refid</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$2}']</key>
          <delay>1800</delay>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <description>The upper NTP server of the NTP server that is synchronized</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP stratum</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$3}']</key>
          <delay>1800</delay>
          <description>Stratum of the NTP server that is synchronized</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP polling</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$6}']</key>
          <delay>1800</delay>
          <units>s</units>
          <description>Synchronization period with the NTP server</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP delay</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$8}']</key>
          <delay>1800</delay>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>Estimated delay time of the NTP packet</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
        <item>
          <name>NTP offset</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$9}']</key>
          <delay>1800</delay>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>Time deviation between the NTP server</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{last(0)}>5000 or {last(0)}&lt;-5000</expression>
              <name>Misalignment of the upper NTP has exceeded the 5s</name>
              <priority>AVERAGE</priority>
            </trigger>
            <trigger>
              <expression>{last(0)}>50 or {last(0)}&lt;-50</expression>
              <name>Misalignment of the upper NTP has exceeded the 50ms</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>Misalignment of the upper NTP has exceeded the 5s</name>
                  <expression>{NTP_Monitoring:system.run[ntpq -p|grep \* |awk '{print$9}'].last(0)}>5000 or {NTP_Monitoring:system.run[ntpq -p|grep \* |awk '{print$9}'].last(0)}&lt;-5000</expression>
                </dependency>
              </dependencies>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>NTP jitter</name>
          <type>ZABBIX_ACTIVE</type>
          <key>system.run[ntpq -p|grep \* |awk '{print$10}']</key>
          <delay>1800</delay>
          <value_type>FLOAT</value_type>
          <units>ms</units>
          <description>Past 8 dispersion average value of NTP offset</description>
          <applications>
            <application>
              <name>NTP</name>
            </application>
          </applications>
        </item>
      </items>
    </template>
  </templates>
  <graphs>
    <graph>
      <name>NTP accuracy information</name>
      <graph_items>
        <graph_item>
          <color>C80000</color>
          <item>
            <host>NTP_Monitoring</host>
            <key>system.run[ntpq -p|grep \* |awk '{print$9}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>1</sortorder>
          <color>00C800</color>
          <item>
            <host>NTP_Monitoring</host>
            <key>system.run[ntpq -p|grep \* |awk '{print$10}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>2</sortorder>
          <color>0000C8</color>
          <yaxisside>RIGHT</yaxisside>
          <item>
            <host>NTP_Monitoring</host>
            <key>system.run[ntpq -p|grep \* |awk '{print$8}']</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
    <graph>
      <name>NTP accuracy information [{$NTP_IP}]</name>
      <graph_items>
        <graph_item>
          <color>C80000</color>
          <item>
            <host>NTP-remote</host>
            <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$9}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>1</sortorder>
          <color>00C800</color>
          <item>
            <host>NTP-remote</host>
            <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$10}']</key>
          </item>
        </graph_item>
        <graph_item>
          <sortorder>2</sortorder>
          <color>0000C8</color>
          <yaxisside>RIGHT</yaxisside>
          <item>
            <host>NTP-remote</host>
            <key>system.run[ntpq -p {$NTP_IP}|grep \* |awk '{print$8}']</key>
          </item>
        </graph_item>
      </graph_items>
    </graph>
  </graphs>
</zabbix_export>