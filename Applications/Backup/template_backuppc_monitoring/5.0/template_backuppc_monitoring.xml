<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export><version>5.0</version><date>2021-11-21T22:03:44Z</date><groups><group><name>Templates/Applications</name></group></groups><templates><template><template>App BackupPC by Zabbix agent</template><name>App BackupPC by Zabbix agent</name><description>## Description

The template to monitor BackupPC metrics API by Zabbix agent without need for extra scripts on server. Template Version v0.0.1 - Evren Yurtesen Tested on Zabbix5 and BackupPC 4.4.1 (needs updated metrics)

## Overview

Please see the GitHub repository for newest version and reporting issues.


&lt;https://github.com/yurtesen/zabbix_backuppc&gt;


 


This template requires no external scripts. 


 


It is tested with latest BackupPC which has updated metrics. It may function partially in older BackupPC versions.


https://github.com/backuppc/backuppc/pull/391



## Author

Evren Yurtesen

</description><groups><group><name>Templates/Applications</name></group></groups><applications><application><name>BackupPC</name></application><application><name>Zabbix raw items</name></application></applications><items><item><name>Disk usage</name><type>DEPENDENT</type><key>backuppc.disk.usage</key><delay>0</delay><units>%</units><applications><application><name>BackupPC</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$.disk.usage</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1d</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item><item><name>Inode usage</name><type>DEPENDENT</type><key>backuppc.inode.usage</key><delay>0</delay><units>%</units><applications><application><name>BackupPC</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$.inode.usage</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1d</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item><item><name>Determine last backup data</name><type>DEPENDENT</type><key>backuppc.metrics.last</key><delay>0</delay><history>0</history><trends>0</trends><value_type>TEXT</value_type><applications><application><name>Zabbix raw items</name></application></applications><preprocessing><step><type>JAVASCRIPT</type><params>var obj = JSON.parse(value);
for (var key in obj['hosts']) {
    Object.assign(obj['hosts'][key], getLastBackupData(obj['hosts'][key]));
}
return JSON.stringify(obj);

function getLastBackupData(hostArray) {
    var lastBackup = {};
    var lastBackupType;
    if (hostArray['full_age'] &gt; hostArray['incr_age']) {
        lastBackupType = 'full';
    } else {
        lastBackupType = 'incr';
    }
    for (var key in hostArray) {
        if (key.startsWith(lastBackupType)) {
            var subKey = key.substring(lastBackupType.length);
            lastBackup['last' + subKey] = hostArray[key];
        }
    }
    return lastBackup;
}</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item><item><name>Start time</name><type>DEPENDENT</type><key>backuppc.server.start_time</key><delay>0</delay><trends>0</trends><units>unixtime</units><applications><application><name>BackupPC</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$.server.start_time</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1d</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item><item><name>Version</name><type>DEPENDENT</type><key>backuppc.server.version</key><delay>0</delay><trends>0</trends><value_type>CHAR</value_type><applications><application><name>BackupPC</name></application></applications><preprocessing><step><type>JSONPATH</type><params>$.server.version</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1d</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item><item><name>BackupPC get metrics</name><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key><delay>5m</delay><history>0</history><trends>0</trends><value_type>TEXT</value_type><description>Fetches BackupPC server metrics</description><applications><application><name>Zabbix raw items</name></application></applications><preprocessing><step><type>REGEX</type><params>\n\s?\n(.*)
\1</params></step></preprocessing></item></items><discovery_rules><discovery_rule><name>Discover backed up hosts</name><type>DEPENDENT</type><key>backuppc.hosts.discovery</key><delay>0</delay><item_prototypes><item_prototype><name>[{#HOST}] Disabled</name><type>DEPENDENT</type><key>backuppc.disabled.[{#HOST}]</key><delay>0</delay><history>7d</history><trends>0</trends><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].disabled</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Error</name><type>DEPENDENT</type><key>backuppc.error.[{#HOST}]</key><delay>0</delay><trends>0</trends><value_type>CHAR</value_type><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].error</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Full count</name><type>DEPENDENT</type><key>backuppc.full_count.[{#HOST}]</key><delay>0</delay><history>7d</history><trends>0</trends><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].full_count</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Full duration</name><type>DEPENDENT</type><key>backuppc.full_duration.[{#HOST}]</key><delay>0</delay><units>s</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].full_duration</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Full keep count</name><type>DEPENDENT</type><key>backuppc.full_keep_count.[{#HOST}]</key><delay>0</delay><history>7d</history><trends>0</trends><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].full_keep_count</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step><step><type>JAVASCRIPT</type><params>if (isNaN(value)) {
    myValue = JSON.parse(value);
} else {
    return value;
}
var sum = 0;
for (var i = 0; i &lt; myValue.length; i += 1) {
    sum += myValue[i];
}
return sum;</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Full rate</name><type>DEPENDENT</type><key>backuppc.full_rate.[{#HOST}]</key><delay>0</delay><units>Bps</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].full_rate</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Full size</name><type>DEPENDENT</type><key>backuppc.full_size.[{#HOST}]</key><delay>0</delay><units>B</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].full_size</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Full start time</name><type>DEPENDENT</type><key>backuppc.full_start_time.[{#HOST}]</key><delay>0</delay><units>unixtime</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].full_start_time</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Incr count</name><type>DEPENDENT</type><key>backuppc.incr_count.[{#HOST}]</key><delay>0</delay><history>7d</history><trends>0</trends><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].incr_count</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Incr duration</name><type>DEPENDENT</type><key>backuppc.incr_duration.[{#HOST}]</key><delay>0</delay><units>s</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].incr_duration</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Incr keep count</name><type>DEPENDENT</type><key>backuppc.incr_keep_count.[{#HOST}]</key><delay>0</delay><history>7d</history><trends>0</trends><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].incr_keep_count</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Incr rate</name><type>DEPENDENT</type><key>backuppc.incr_rate.[{#HOST}]</key><delay>0</delay><units>Bps</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].incr_rate</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Incr size</name><type>DEPENDENT</type><key>backuppc.incr_size.[{#HOST}]</key><delay>0</delay><units>B</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].incr_size</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Incr start time</name><type>DEPENDENT</type><key>backuppc.incr_start_time.[{#HOST}]</key><delay>0</delay><units>unixtime</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].incr_start_time</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Last # of new files</name><type>DEPENDENT</type><key>backuppc.last_nfiles_new.[{#HOST}]</key><delay>0</delay><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].last_nfiles_new</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>backuppc.metrics.last</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Last size</name><type>DEPENDENT</type><key>backuppc.last_size.[{#HOST}]</key><delay>0</delay><units>B</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].last_size</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>backuppc.metrics.last</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Last new files size</name><type>DEPENDENT</type><key>backuppc.last_size_new.[{#HOST}]</key><delay>0</delay><units>B</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].last_size_new</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>backuppc.metrics.last</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Last start time</name><type>DEPENDENT</type><key>backuppc.last_start_time.[{#HOST}]</key><delay>0</delay><units>unixtime</units><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].last_start_time</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>backuppc.metrics.last</key></master_item></item_prototype><item_prototype><name>[{#HOST}] Reason</name><type>DEPENDENT</type><key>backuppc.reason.[{#HOST}]</key><delay>0</delay><trends>0</trends><value_type>CHAR</value_type><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].reason</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype><item_prototype><name>[{#HOST}] State</name><type>DEPENDENT</type><key>backuppc.state.[{#HOST}]</key><delay>0</delay><trends>0</trends><value_type>CHAR</value_type><application_prototypes><application_prototype><name>BackupPC {#HOST}</name></application_prototype></application_prototypes><preprocessing><step><type>JSONPATH</type><params>$.hosts.['{#HOST}'].state</params></step><step><type>DISCARD_UNCHANGED_HEARTBEAT</type><params>1h</params></step></preprocessing><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item></item_prototype></item_prototypes><trigger_prototypes><trigger_prototype><expression>{App BackupPC by Zabbix agent:backuppc.error.[{#HOST}].strlen()}&lt;&gt;0 and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression><name>{#HOST}: Backup error</name><priority>INFO</priority><description>{ITEM.LASTVALUE1}</description><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>{App BackupPC by Zabbix agent:backuppc.last_start_time.[{#HOST}].fuzzytime({$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;})}=0 and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression><name>{#HOST}: No new backups for {$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;}</name><priority>AVERAGE</priority><description>No backups were taken for {$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;}&#13;
&#13;
Critical period per backup server or per backup host can be adjusted.</description><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>{App BackupPC by Zabbix agent:backuppc.last_start_time.[{#HOST}].fuzzytime({$BACKUPPC.OLDBACKUP.WARN:&quot;{#HOST}&quot;})}=0 and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression><name>{#HOST}: No new backups for {$BACKUPPC.OLDBACKUP.WARN:&quot;{#HOST}&quot;}</name><priority>WARNING</priority><description>No backups were taken for {$BACKUPPC.OLDBACKUP.WARN:&quot;{#HOST}&quot;}&#13;
&#13;
Warning period per backup server or per backup host can be adjusted.</description><manual_close>YES</manual_close><dependencies><dependency><name>{#HOST}: No new backups for {$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;}</name><expression>{App BackupPC by Zabbix agent:backuppc.last_start_time.[{#HOST}].fuzzytime({$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;})}=0 and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression></dependency></dependencies></trigger_prototype><trigger_prototype><expression>({App BackupPC by Zabbix agent:backuppc.full_count.[{#HOST}].last()}&lt;{App BackupPC by Zabbix agent:backuppc.full_keep_count.[{#HOST}].last()}) and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression><name>{#HOST}: Not enough full backups</name><priority>INFO</priority><description>{ITEM.LASTVALUE1} full backup(s) exist which is less than configured {ITEM.LASTVALUE2} full backup(s) value for this host&#13;
&#13;
A newly added most may not have enough full backups</description><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>({App BackupPC by Zabbix agent:backuppc.incr_count.[{#HOST}].last()}&lt;{App BackupPC by Zabbix agent:backuppc.incr_keep_count.[{#HOST}].last()}) and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression><name>{#HOST}: Not enough incr backups</name><priority>INFO</priority><description>{ITEM.LASTVALUE1} incr backup(s) exist which is less than configured {ITEM.LASTVALUE2} incr backup(s) value for this host&#13;
&#13;
A newly added most may not have enough incremental backups</description><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>{App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0 and ({App BackupPC by Zabbix agent:backuppc.last_size_new.[{#HOST}].last()}&gt;{$BACKUPPC.SIZECHANGE.CRIT} or {App BackupPC by Zabbix agent:backuppc.last_size.[{#HOST}].abschange()}&gt;{$BACKUPPC.SIZECHANGE.CRIT})</expression><name>{#HOST}: Size difference larger than {$BACKUPPC.SIZECHANGE.CRIT:&quot;{#HOST}&quot;}</name><priority>AVERAGE</priority><description>There are new files larger than or size difference larger than {$BACKUPPC.SIZECHANGE.CRIT:&quot;{#HOST}&quot;} between last backup and previus backup.&#13;
&#13;
Critical size per backup server or per backup host can be adjusted.</description><manual_close>YES</manual_close></trigger_prototype><trigger_prototype><expression>{App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0 and ({App BackupPC by Zabbix agent:backuppc.last_size_new.[{#HOST}].last()}&gt;{$BACKUPPC.SIZECHANGE.WARN} or {App BackupPC by Zabbix agent:backuppc.last_size.[{#HOST}].abschange()}&gt;{$BACKUPPC.SIZECHANGE.WARN})</expression><name>{#HOST}: Size difference larger than {$BACKUPPC.SIZECHANGE.WARN:&quot;{#HOST}&quot;}</name><priority>WARNING</priority><description>There are new files larger than or size difference larger than {$BACKUPPC.SIZECHANGE.WARN:&quot;{#HOST}&quot;} between last backup and previus backup.&#13;
&#13;
Warning size per backup server or per backup host can be adjusted.</description><manual_close>YES</manual_close><dependencies><dependency><name>{#HOST}: No new backups for {$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;}</name><expression>{App BackupPC by Zabbix agent:backuppc.last_start_time.[{#HOST}].fuzzytime({$BACKUPPC.OLDBACKUP.CRIT:&quot;{#HOST}&quot;})}=0 and {App BackupPC by Zabbix agent:backuppc.disabled.[{#HOST}].last()}=0</expression></dependency></dependencies></trigger_prototype></trigger_prototypes><master_item><key>web.page.get[{$BACKUPPC.SCHEME}://{$BACKUPPC.USERNAME}:{$BACKUPPC.PASSWORD}@{$BACKUPPC.HOST}:{$BACKUPPC.PORT}/{$BACKUPPC.PATH}?action=metrics]</key></master_item><preprocessing><step><type>JAVASCRIPT</type><params>var obj = JSON.parse(value);
return JSON.stringify(Object.keys(obj['hosts']).map(lldFunction));

function lldFunction(hostname) {
    return { '{#HOST}': hostname };
}</params></step></preprocessing></discovery_rule></discovery_rules><macros><macro><macro>{$BACKUPPC.HOST}</macro><value>127.0.0.1</value><description>Hostname or IP of the BackupPC server.</description></macro><macro><macro>{$BACKUPPC.OLDBACKUP.CRIT}</macro><value>7d</value><description>Days before critical old backups</description></macro><macro><macro>{$BACKUPPC.OLDBACKUP.WARN}</macro><value>3d</value><description>Days before warning old backups</description></macro><macro><macro>{$BACKUPPC.PASSWORD}</macro><value>backuppc</value><description>Password of username which can access metrics of the BackupPC server.</description></macro><macro><macro>{$BACKUPPC.PATH}</macro><value>/backuppc</value><description>Path to BackupPC web interface</description></macro><macro><macro>{$BACKUPPC.PORT}</macro><value>443</value><description>HTTP/HTTPS port</description></macro><macro><macro>{$BACKUPPC.SCHEME}</macro><value>https</value><description>Metrics access scheme (http/https).</description></macro><macro><macro>{$BACKUPPC.SIZECHANGE.CRIT}</macro><value>5G</value><description>Crit backup `size` or `new files size` difference</description></macro><macro><macro>{$BACKUPPC.SIZECHANGE.WARN}</macro><value>1G</value><description>Warn backup `size` or `new files size` difference</description></macro><macro><macro>{$BACKUPPC.USERNAME}</macro><value>backuppc</value><description>Metrics access username.</description></macro></macros></template></templates></zabbix_export>
