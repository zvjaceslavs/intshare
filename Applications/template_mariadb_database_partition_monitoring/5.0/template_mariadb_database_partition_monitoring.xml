<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-22T08:00:12Z</date>
  <groups>
    <group>
      <name>Zabbix servers</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Template Zabbix DB Partitions</template>
      <name>Template Zabbix DB Partitions</name>
      <groups>
        <group>
          <name>Zabbix servers</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>DB Partitions</name>
        </application>
      </applications>
      <items>
        <item>
          <name>Current Daily Partition count</name>
          <type>SSH</type>
          <key>ssh.run[dpc,{HOST.HOST},22,]</key>
          <delay>30s</delay>
          <params>ls /var/lib/mysql/zabbixdb | grep -c $(date +%F | sed s/-//g)</params>
          <username>root</username>
          <password>{$PASSWORD}</password>
          <description>Gets the current count of the number of daily partitions in the /var/lib/mysql/zabbixdb, this will need to be adjusted to fit your environment.</description>
          <applications>
            <application>
              <name>DB Partitions</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Tomorrow Daily Partition Count</name>
          <type>SSH</type>
          <key>ssh.run[dpc1,{HOST.HOST},22,]</key>
          <delay>30s</delay>
          <params>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+1days "+%Y%m%d")</params>
          <username>root</username>
          <password>{$PASSWORD}</password>
          <description>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+Xdays "+%Y%m%d") Workflow 1. List the content of the /var/lib/mysql/zabbixdb folder 2. Print the grep count of current date, + X days ahead, printing the format like the partition file name.</description>
          <applications>
            <application>
              <name>DB Partitions</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Third Daily Partition Count</name>
          <type>SSH</type>
          <key>ssh.run[dpc3,{HOST.HOST},22,]</key>
          <delay>30s</delay>
          <params>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+2days "+%Y%m%d")</params>
          <username>root</username>
          <password>{$PASSWORD}</password>
          <description>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+Xdays "+%Y%m%d") Workflow 1. List the content of the /var/lib/mysql/zabbixdb folder 2. Print the grep count of current date, + X days ahead, printing the format like the partition file name.</description>
          <applications>
            <application>
              <name>DB Partitions</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Fourth Daily Partition Count</name>
          <type>SSH</type>
          <key>ssh.run[dpc4,{HOST.HOST},22,]</key>
          <delay>30s</delay>
          <params>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+3days "+%Y%m%d")</params>
          <username>root</username>
          <password>{$PASSWORD}</password>
          <description>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+Xdays "+%Y%m%d") Workflow 1. List the content of the /var/lib/mysql/zabbixdb folder 2. Print the grep count of current date, + X days ahead, printing the format like the partition file name.</description>
          <applications>
            <application>
              <name>DB Partitions</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Fifth Daily Partition Count</name>
          <type>SSH</type>
          <key>ssh.run[dpc5,{HOST.HOST},22,]</key>
          <delay>30s</delay>
          <params>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+4days "+%Y%m%d")</params>
          <username>root</username>
          <password>{$PASSWORD}</password>
          <description>ls /var/lib/mysql/zabbixdb | grep -c $(date -d "$(date +%F)"+Xdays "+%Y%m%d") Workflow 1. List the content of the /var/lib/mysql/zabbixdb folder 2. Print the grep count of current date, + X days ahead, printing the format like the partition file name.</description>
          <applications>
            <application>
              <name>DB Partitions</name>
            </application>
          </applications>
        </item>
      </items>
      <macros>
        <macro>
          <macro>{$PASSWORD}</macro>
        </macro>
      </macros>
    </template>
  </templates>
  <triggers>
    <trigger>
      <expression>{Template Zabbix DB Partitions:ssh.run[dpc1,{HOST.HOST},22,].prev()}&lt;>7 or {Template Zabbix DB Partitions:ssh.run[dpc3,{HOST.HOST},22,].prev()}&lt;>7 or {Template Zabbix DB Partitions:ssh.run[dpc4,{HOST.HOST},22,].prev()}&lt;>7 or {Template Zabbix DB Partitions:ssh.run[dpc5,{HOST.HOST},22,].prev()}&lt;>7</expression>
      <name>Future Partition missing</name>
      <priority>DISASTER</priority>
    </trigger>
  </triggers>
</zabbix_export>