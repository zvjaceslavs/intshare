zabbix_export:
  version: '5.4'
  date: '2021-11-09T08:54:34Z'
  groups:
    -
      uuid: e960332b3f6c46a1956486d4f3f99fce
      name: 'Templates/Server hardware'
  templates:
    -
      uuid: a4164611a76b496bab5805faa9c085b4
      template: monitor_FabricInterconnect_Cisco_UCS
      name: 思科UCS交换矩阵监控模板
      description: |
        ## Overview
        
        思科UCS交换矩阵监控模板 
        
        
        包括CPU、Raid卡、内存、刀片、电源、硬盘、风扇、端口状态
        
        
        将宏{$CLOUD\_SNMP\_COMMUNITY}替换为实际团体字即可
        
        
        某些情况下监控是浮动地址无效，需要监控实际地址
        
        
        
        ## Author
        
        zhangzhefeng
        
        
      groups:
        -
          name: 'Templates/Server hardware'
      items:
        -
          uuid: 12f87158fd2b44c08053b60134ed27db
          name: ping丢包率
          type: SIMPLE
          key: 'icmppingloss[,10,,,]'
          delay: 5m
          history: 7d
          trends: 0d
          value_type: FLOAT
          units: '%'
          tags:
            -
              tag: Application
              value: ping检测
          triggers:
            -
              uuid: 6a5ec892cc04466fa484dc4c0929774d
              expression: 'avg(/monitor_FabricInterconnect_Cisco_UCS/icmppingloss[,10,,,],10m)>{$ICMP_LOSS_WARN}'
              name: 'ICMP ping 丢包'
              priority: HIGH
              description: 'Last value: {ITEM.LASTVALUE1}.'
              type: MULTIPLE
              manual_close: 'YES'
              dependencies:
                -
                  name: 'ICMP ping不可达'
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/icmpping[,5,,,],#1)=0'
        -
          uuid: f77e039b049f4ef09c2a587a9685c70e
          name: ping时延
          type: SIMPLE
          key: 'icmppingsec[,10,,,,avg]'
          delay: 5m
          history: 7d
          trends: 0d
          value_type: FLOAT
          units: s
          tags:
            -
              tag: Application
              value: ping检测
          triggers:
            -
              uuid: bcfb06a7097b40ca956508ab846df5d0
              expression: 'min(/monitor_FabricInterconnect_Cisco_UCS/icmppingsec[,10,,,,avg],10m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: 'ICMP ping 时延高'
              priority: HIGH
              description: 'Last value: {ITEM.LASTVALUE1}.'
              type: MULTIPLE
              manual_close: 'YES'
              dependencies:
                -
                  name: 'ICMP ping不可达'
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/icmpping[,5,,,],#1)=0'
        -
          uuid: 5b4501b294464a2fa50b46ff37c5811c
          name: 'ICMP ping'
          type: SIMPLE
          key: 'icmpping[,5,,,]'
          history: 7d
          trends: 0d
          tags:
            -
              tag: Application
              value: ping检测
          triggers:
            -
              uuid: 8c7106a495fe43e7845ec50c2b0a6d68
              expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/icmpping[,5,,,],#1)=0'
              name: 'ICMP ping不可达'
              priority: HIGH
              description: |
                Last value: {ITEM.LASTVALUE1}.
                Last 2 attempts returned timeout.  Please check device connectivity.
              type: MULTIPLE
              manual_close: 'YES'
            -
              uuid: ef9c9bdf9d174ac5b897b35b7c3ab92f
              expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/icmpping[,5,,,],#1)=0'
              name: 监控失效（ping不通）
              priority: INFO
              manual_close: 'YES'
              tags:
                -
                  tag: 监控失效原因
                  value: ping不通
        -
          uuid: bc1011010fc34163a58918da415f3a0c
          name: 系统信息
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: SystemDescription
          delay: 1h
          history: 3d
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: 系统信息
          triggers:
            -
              uuid: cfa04a5ff7624c6b80903a1242b7e026
              expression: 'nodata(/monitor_FabricInterconnect_Cisco_UCS/SystemDescription,12h)=1'
              name: 监控失效（snmp不通）
              priority: INFO
              manual_close: 'YES'
              tags:
                -
                  tag: 监控失效原因
                  value: snmp不通
        -
          uuid: 4c4c1aefb2bf46b197ba5be05bb3498a
          name: 运行时间
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: SystemUpTime
          delay: 1h
          history: 3d
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: 系统信息
      discovery_rules:
        -
          uuid: 15cfc0ffcae74de3a9e3882131370901
          name: 刀片发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.719.1.9.2.1.2]'
          key: BladeDiscovery
          delay: 1d
          lifetime: 0d
          item_prototypes:
            -
              uuid: f52a0d2ed8e24c5fbd4b0a2b2e999ad8
              name: '刀片运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.9.2.1.43.{#SNMPINDEX}'
              key: 'BladeOperationStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: 刀片情况
              trigger_prototypes:
                -
                  uuid: 6a96b2bb688940348521df85ed72c87e
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/BladeOperationStatus.[{#SNMPINDEX}],#1)>1'
                  name: 刀片异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: 984739864b0b4f718e00947e1ddf95b0
          name: CPU发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},  1.3.6.1.4.1.9.9.719.1.41.9.1.2,{#PRESENSE}, 1.3.6.1.4.1.9.9.719.1.41.9.1.13]'
          key: CPUDiscovery
          delay: 1d
          filter:
            conditions:
              -
                macro: '{#PRESENSE}'
                value: '10'
                formulaid: A
          lifetime: 0d
          item_prototypes:
            -
              uuid: dc1b1f24c2ff46caa8b659cdd17ad983
              name: 'CPU运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.41.9.1.9.{#SNMPINDEX}'
              key: 'CPUStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: CPU情况
              trigger_prototypes:
                -
                  uuid: 0ea1ccc96ec34cfd88fc83ad5728656f
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/CPUStatus.[{#SNMPINDEX}],#1)>1'
                  name: CPU状态异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: c089ebd3e00a41f2ba915d3cf4f6b8ac
          name: 硬盘发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.719.1.45.4.1.2]'
          key: DiskDiscovery
          delay: 1d
          lifetime: 0d
          item_prototypes:
            -
              uuid: cc752c44e63d40bb85b11772aab30ee1
              name: '硬盘运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.45.4.1.9.{#SNMPINDEX}'
              key: 'DiskStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: 硬盘情况
              trigger_prototypes:
                -
                  uuid: 812fb18e2fc74ec0a7bf8a35f31ce36d
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/DiskStatus.[{#SNMPINDEX}],#1)>1'
                  name: 硬盘状态异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: ae6b5d230a2d4b58a9f6195eac554557
          name: 风扇发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.719.1.15.12.1.2]'
          key: FanDiscovery
          delay: 1d
          lifetime: 0d
          item_prototypes:
            -
              uuid: 6a8bf50326854e03b61a78bc34031964
              name: '风扇运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.15.12.1.9.{#SNMPINDEX}'
              key: 'FanOperationStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: 风扇情况
              trigger_prototypes:
                -
                  uuid: d5e0f9704db74f55926bbeae3f6c4693
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/FanOperationStatus.[{#SNMPINDEX}],#1)>1'
                  name: 风扇异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: b73dcc68ba2c4b2d89660acb0095a792
          name: 端口发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFDESCR},IF-MIB::ifDescr,{#IFALIAS},IF-MIB::ifAlias]'
          key: InterfaceDiscovery_status
          delay: 1d
          filter:
            conditions:
              -
                macro: '{#IFDESCR}'
                value: '.*Vlan.*'
                operator: NOT_MATCHES_REGEX
                formulaid: A
          lifetime: 0d
          item_prototypes:
            -
              uuid: dad69be157fe47c4a2affd7d47ba82f1
              name: '端口:{#IFDESCR}({#IFALIAS})状态'
              type: SNMP_AGENT
              snmp_oid: 'IF-MIB::ifOperStatus.{#SNMPINDEX}'
              key: 'InterfaceOperationStatus.[{#SNMPINDEX}]'
              delay: 5m
              history: 3d
              trends: 0d
              description: 'The current operational state of the interface.'
              tags:
                -
                  tag: Application
                  value: 端口状态
              trigger_prototypes:
                -
                  uuid: ad97dcf053024fa3b83efa6286fca7f6
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#2)=1 and  last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#1)<>1 and last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#1)<>2'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#2)=1 and  last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#1)=1'
                  name: '{#IFDESCR} 端口状态异常'
                  priority: AVERAGE
                  description: 因2019年10月1日二长7楼163方向防火墙出现状态7的告警，特增加此触发器
                  type: MULTIPLE
                  manual_close: 'YES'
                -
                  uuid: 1a15427d7d3a402f81e7f64b91c8f7bb
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#2)=1 and  last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#1)=2'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#2)=1 and  last(/monitor_FabricInterconnect_Cisco_UCS/InterfaceOperationStatus.[{#SNMPINDEX}],#1)=1'
                  name: '端口:{#IFDESCR} down'
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
                  tags:
                    -
                      tag: 端口描述
                      value: '{#IFALIAS}'
        -
          uuid: c9bde84eb67848aba3b3d52654ea5a1d
          name: 内存发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.719.1.30.11.1.2,{#PRESENSE},1.3.6.1.4.1.9.9.719.1.30.11.1.17]'
          key: MemoryDiscovery
          delay: 1d
          filter:
            conditions:
              -
                macro: '{#PRESENSE}'
                value: '10'
                formulaid: A
          lifetime: 0d
          item_prototypes:
            -
              uuid: 227445ee10ed4a97b903412edb5e752e
              name: '内存运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.30.11.1.13.{#SNMPINDEX}'
              key: 'MemoryStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: 内存情况
              trigger_prototypes:
                -
                  uuid: dc45620baba84e779699b9438a5cf6bf
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/MemoryStatus.[{#SNMPINDEX}],#1)>1'
                  name: 内存状态异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: fe634f47ecf74e2b86aadb36b4d582e7
          name: 电源发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.719.1.15.56.1.2]'
          key: PowerSupplyDiscovery
          delay: 1d
          lifetime: 0d
          item_prototypes:
            -
              uuid: dc312f465c494b8bb08c812b667877d7
              name: '电源运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.15.56.1.7.{#SNMPINDEX}'
              key: 'PowerSupplyOperationStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: 电源情况
              trigger_prototypes:
                -
                  uuid: 4a0759a3ff5b40958630abc5335b1e0a
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/PowerSupplyOperationStatus.[{#SNMPINDEX}],#1)>1'
                  name: 电源异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: b5d781e68bb44eb5af4a7f9bb8247d42
          name: RAID电池发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.9.9.719.1.45.11.1.2,{#PRESENSE},1.3.6.1.4.1.9.9.719.1.45.11.1.10]'
          key: RaidBatteryDiscovery
          delay: 1d
          filter:
            conditions:
              -
                macro: '{#PRESENSE}'
                value: '10'
                formulaid: A
          lifetime: 0d
          item_prototypes:
            -
              uuid: 054d059106da48cbb65b7b8dc6b815e2
              name: 'Raid电池运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.45.11.1.9.{#SNMPINDEX}'
              key: 'RaidBatteryStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: Raid卡情况
              trigger_prototypes:
                -
                  uuid: 31799bf32e4243cdbe6e0a7f969b7b94
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/RaidBatteryStatus.[{#SNMPINDEX}],#1)>1'
                  name: Raid电池状态异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: 3e2b11d66e99466b9f9a2b4716e7f689
          name: RAID控制器发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE}, .1.3.6.1.4.1.9.9.719.1.45.1.1.2,{#PRESENSE}, .1.3.6.1.4.1.9.9.719.1.45.1.1.12]'
          key: RaidControllerDiscovery
          delay: 1d
          filter:
            conditions:
              -
                macro: '{#PRESENSE}'
                value: '10'
                formulaid: A
          lifetime: 0d
          item_prototypes:
            -
              uuid: b0bd9735867342459e0cd17e98d174b9
              name: 'Raid控制器运行状态 {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.9.9.719.1.45.1.1.6.{#SNMPINDEX}'
              key: 'RaidControllerStatus.[{#SNMPINDEX}]'
              delay: 30m
              history: 3d
              trends: 0d
              tags:
                -
                  tag: Application
                  value: Raid卡情况
              trigger_prototypes:
                -
                  uuid: 45f847beb19c41938a2599e90d4c3155
                  expression: 'last(/monitor_FabricInterconnect_Cisco_UCS/RaidControllerStatus.[{#SNMPINDEX}],#1)>1'
                  name: Raid控制器状态异常
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
      macros:
        -
          macro: '{$CLOUD_SNMP_COMMUNITY}'
          value: public
        -
          macro: '{$ICMP_LOSS_WARN}'
          value: '30'
        -
          macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.1'
