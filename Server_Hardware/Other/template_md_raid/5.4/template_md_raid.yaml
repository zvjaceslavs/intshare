zabbix_export:
  version: '5.4'
  date: '2021-11-09T04:34:40Z'
  groups:
    -
      uuid: 7df96b18c230490a9a0a9e2307226338
      name: Templates
  templates:
    -
      uuid: a8d9676aaeae4719867f3127b90c1497
      template: 'MD Soft RAID'
      name: 'MD Soft RAID'
      description: |
        ## Description
        
        Monitoring of MD Soft RAID
        
        ## Overview
        
        **MD Soft RAID monitoring template for Zabbix**
        -----------------------------------------------
        
        
        Using sysfs for monitoring of Linux Soft RAID aka MD
        
        
        Tested on Zabbix Version 3.0
        
        
        See more at [GitHub](https://github.com/krom/zabbix_template_md)
        
        
        FEATURES
        --------
        
        
        * LLD for auto detecting RAID
        * Monitoring of total number of disks, number of degraded disks, sync\_status
        * Graph for degraded disks
        * Triggers for degrading and raid recovering
        
        
        
        REQUIREMENTS
        ------------
        
        
        * Zabbix server version 3.0
        * SYSFS at agents's server, **/sys/block/md*** available
        
        
        INSTALLATION
        ------------
        
        
        * Agent (host with RAID)
        	+ Copy **userparameter\_md.conf** to **/etc/zabbix/zabbix\_agentd.d/userparameter\_md.conf**
        		- For example `curl -Ls https://git.io/fN9H5 | sudo tee /etc/zabbix/zabbix_agentd.d/userparameter_md.conf`
        	+ Restart zabbix\_agent
        		- UBUNTU/DEBIAN: `sudo service zabbix-agent restart`
        * Server
        	+ Import template **template\_md\_x.x.xml** file via web admin (**x.x** this is your version of Zabbix)
        		- Save the XML template file to a convenient location
        		- Open the Zabbix console
        		- Navigate to **Configuration** > **Templates**
        		- Click the **Import** button
        		- Select the downloaded **template\_md.xml** file
        		- Click **Import**
        
        
         
        
        
        ITEMS
        -----
        
        
        * **md.discover** - LLD data (MD RAIDs and disks)
        * **md.degraded[*]** - number of degraded disks for specific RAID
        * **md.sync\_action[*]** - current sync status for specific RAID
        * **md.raid\_disks[*]** - number of all disks for specific RAID
        
        
         
        
        
        ### How to add new Item
        
        
        1. Add new **UserParameter** to **/etc/zabbix/zabbix\_agentd.d/userparameter\_md.conf** For example `UserParameter=md.sync_speed[*],cat /sys/block/$1/md/sync_speed`
        2. Create a new Item by [instruction](https://www.zabbix.com/documentation/3.4/manual/config/items/item)
        
        
        AUTHOR
        ------
        
        
        Roman Kudlay [roman@kudlay.pro](mailto:roman@kudlay.pro)
        
        
         
        
        
        LICENSE
        -------
        
        
        GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007
        
        
        
        ## Author
        
        Roman Kudlay
        
        
      groups:
        -
          name: Templates
      discovery_rules:
        -
          uuid: bd8ea661ae4b4eff9e93c830771f5b19
          name: 'MD Discovery'
          key: md.discover
          delay: '3600'
          item_prototypes:
            -
              uuid: 61bdf950e6c9471c919a9f549b02fa20
              name: 'MD $1 degraded'
              key: 'md.degraded[{#MDNAME}]'
              delay: 5m
              history: '3600'
              trends: '86400'
              description: 'Get number of degraded disks'
              tags:
                -
                  tag: Application
                  value: MD
              trigger_prototypes:
                -
                  uuid: dcec7b366a6b4af9ae54e1d2dd36cf2e
                  expression: 'last(/MD Soft RAID/md.degraded[{#MDNAME}])>0'
                  name: 'MD {#MDNAME} is degraded on {HOST.NAME}'
                  priority: HIGH
            -
              uuid: 34537ac721304c0ea4192777528fba95
              name: 'MD $1 raid disks'
              key: 'md.raid_disks[{#MDNAME}]'
              delay: '3600'
              history: '3600'
              trends: '86400'
              description: 'Get number of all disks'
              tags:
                -
                  tag: Application
                  value: MD
              trigger_prototypes:
                -
                  uuid: 3fc59fa9c7634edda3a0dccc5c972224
                  expression: '(last(/MD Soft RAID/md.raid_disks[{#MDNAME}],#1)<>last(/MD Soft RAID/md.raid_disks[{#MDNAME}],#2))>0'
                  name: 'MD {#MDNAME} number of disks changed on {HOST.NAME}'
                  priority: WARNING
            -
              uuid: b34710292d384172a02c977d76d00c63
              name: 'MD $1 sync action'
              key: 'md.sync_action[{#MDNAME}]'
              delay: '300'
              history: '3600'
              trends: '0'
              value_type: TEXT
              description: 'Get current sync action'
              tags:
                -
                  tag: Application
                  value: MD
              trigger_prototypes:
                -
                  uuid: 09ec79b6b5624ddb8f85ac209a672e5a
                  expression: 'find(/MD Soft RAID/md.sync_action[{#MDNAME}],,"like","recover")=1'
                  name: 'MD {#MDNAME} in recovery mode on {HOST.NAME}'
                  priority: INFO
          graph_prototypes:
            -
              uuid: cbda8d3f566a4c9494e8e5284e69b469
              name: 'MD {#MDNAME} degration'
              graph_items:
                -
                  color: 1A7C11
                  item:
                    host: 'MD Soft RAID'
                    key: 'md.degraded[{#MDNAME}]'
