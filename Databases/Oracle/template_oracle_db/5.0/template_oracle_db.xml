<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-19T21:22:33Z</date>
  <groups>
    <group>
      <name>Templates</name>
    </group>
    <group>
      <name>Templates/Databases</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Template Oracle DB</template>
      <name>Template Oracle DB</name>
      <groups>
        <group>
          <name>Templates</name>
        </group>
        <group>
          <name>Templates/Databases</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>Archival Destination</name>
        </application>
        <application>
          <name>Database</name>
        </application>
        <application>
          <name>IO</name>
        </application>
        <application>
          <name>Locks</name>
        </application>
        <application>
          <name>Sessions</name>
        </application>
        <application>
          <name>SQL</name>
        </application>
      </applications>
      <items>
        <item>
          <name>Archived log Primary-Standby gap</name>
          <type>ODBC</type>
          <key>db.odbc.select[archive log gap,{$DSN}]</key>
          <delay>10m</delay>
          <history>7d</history>
          <params>select (select max(sequence#) from v$archived_log) - (select max(sequence#) from v$archived_log where applied = 'YES') from dual;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{last()}>=5</expression>
              <name>DB - DG archive gap detected => {ITEM.VALUE1}</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>DB - DG massive archive gap detected => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.odbc.select[archive log gap,{$DSN}].last()}>=10</expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{last()}>=10</expression>
              <name>DB - DG massive archive gap detected => {ITEM.VALUE1}</name>
              <priority>HIGH</priority>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Last 24h backup details</name>
          <type>ODBC</type>
          <key>db.odbc.select[backup status,{$BACKUP_DSN}]</key>
          <delay>1h</delay>
          <history>1d</history>
          <value_type>FLOAT</value_type>
          <params>select * from ( select case when status = 'COMPLETED' then 1 when status = 'FAILED' then -1 when status like 'WITH WARNINGS' then 2 when status like 'WITH ERRORS' then 3 else 0 end from v$rman_status where trunc(start_time) = trunc(sysdate-{$ORACLE_BACKUP_HOUR}/24) and operation = 'BACKUP' and (object_type='DB INCR' or object_type='DB FULL') order by start_time asc) where rownum=1;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <description>when status = 'COMPLETED' then 1 when status = 'FAILED' then -1 when status like 'WITH WARNINGS' then 2 when status like 'WITH ERRORS' then 3 else 0</description>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <valuemap>
            <name>Oracle backup status</name>
          </valuemap>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{last()}=-1 or {nodata(24h)}=1</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{last()}>=0</recovery_expression>
              <name>Database has no backup last 24hrs</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{last()}=3</expression>
              <name>Last DB backup contains errors</name>
              <priority>HIGH</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{last()}=2</expression>
              <name>Last DB backup contains warnings</name>
              <priority>WARNING</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{last()}=-1</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{last()}>=0</recovery_expression>
              <name>Last DB backup is failed</name>
              <priority>HIGH</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Blocked sessions count</name>
          <type>ODBC</type>
          <key>db.odbc.select[Blocked sessions count,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select count(distinct sid) from v$session_blockers;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>Locks</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Buffer Cache Hit Ratio</name>
          <type>ODBC</type>
          <key>db.odbc.select[Buffer Cache Hit Ratio,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Buffer Cache Hit Ratio' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Cursor Cache Hit Ratio</name>
          <type>ODBC</type>
          <key>db.odbc.select[Cursor Cache Hit Ratio,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Cursor Cache Hit Ratio' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Database CPU Time Ratio</name>
          <type>ODBC</type>
          <key>db.odbc.select[Database CPU Time Ratio,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Database CPU Time Ratio' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Database lock count</name>
          <type>ODBC</type>
          <key>db.odbc.select[Database lock count,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select count(1) from v$lock;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>Locks</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Database session count</name>
          <type>ODBC</type>
          <key>db.odbc.select[db session count,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select count(1) from v$session;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Global DB name</name>
          <type>ODBC</type>
          <key>db.odbc.select[global_db_name,{$DSN}]</key>
          <delay>1d</delay>
          <history>30d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <params>select property_value from database_properties where property_name='GLOBAL_DB_NAME';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Host CPU Utilization %</name>
          <type>ODBC</type>
          <key>db.odbc.select[Host CPU Utilization,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Host CPU Utilization (%)' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Instance CPU count</name>
          <type>ODBC</type>
          <key>db.odbc.select[Instance CPU count,{$DSN}]</key>
          <delay>1h</delay>
          <history>7d</history>
          <params>select value from v$system_parameter2 where name='cpu_count';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Instance status</name>
          <type>ODBC</type>
          <key>db.odbc.select[Instance Status,{$DSN}]</key>
          <delay>60</delay>
          <history>7d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <params>select status from v$instance</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{count(#1,OPEN,eq)}=0 or {nodata(150)}=1</expression>
              <name>Database Is Down</name>
              <priority>DISASTER</priority>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Instance name</name>
          <type>ODBC</type>
          <key>db.odbc.select[instance_name,{$DSN}]</key>
          <delay>1d</delay>
          <history>30d</history>
          <trends>0</trends>
          <value_type>TEXT</value_type>
          <params>select instance_name from v$instance;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>DISCARD_UNCHANGED</type>
              <params></params>
            </step>
          </preprocessing>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Long table scans per sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Long Table Scans Per Sec,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <params>select value from v$sysmetric where metric_name='Long Table Scans Per Sec' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Max applied archived log</name>
          <type>ODBC</type>
          <key>db.odbc.select[max applied archived log,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select max(sequence#) from v$archived_log where applied = 'YES';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Max archived log</name>
          <type>ODBC</type>
          <key>db.odbc.select[max archived log,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select case when max(sequence#) is null then 0 else max(sequence#) end from v$archived_log;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
          <triggers>
            <trigger>
              <expression>{last()}=0</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{last()}>0</recovery_expression>
              <name>Database is not in archive mode</name>
              <priority>WARNING</priority>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Maximum processes</name>
          <type>ODBC</type>
          <key>db.odbc.select[max number of processes,{$DSN}]</key>
          <delay>1h</delay>
          <history>7d</history>
          <params>select value from v$system_parameter where name ='processes';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Maximum sessions</name>
          <type>ODBC</type>
          <key>db.odbc.select[max number of sessions,{$DSN}]</key>
          <delay>1h</delay>
          <history>7d</history>
          <params>select value from v$system_parameter where name ='sessions';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>PGA Cache Hit %</name>
          <type>ODBC</type>
          <key>db.odbc.select[PGA Cache Hit Percentage,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='PGA Cache Hit %' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Physical Read Bytes Per Sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Physical Read Bytes Per Sec,{$DSN}]</key>
          <delay>2m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>Bps</units>
          <params>select value from v$sysmetric where metric_name='Physical Read Bytes Per Sec' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{avg(15m)} / ({avg(1w)} + {$MIN_READ_BPS}) >=1.75</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{avg(#3)} / ({avg(1w)} + {$MIN_READ_BPS}) &lt;1.75</recovery_expression>
              <name>Database Read Bps is abnormal => {ITEM.VALUE1}</name>
              <priority>WARNING</priority>
              <manual_close>YES</manual_close>
              <dependencies>
                <dependency>
                  <name>Database Read Bps is high => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(10m)} / ({Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_READ_BPS}) >=2</expression>
                  <recovery_expression>{Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(#2)} / ({Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_READ_BPS}) &lt;2</recovery_expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(10m)} / ({avg(1w)} + {$MIN_READ_BPS}) >=2</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{avg(#2)} / ({avg(1w)} + {$MIN_READ_BPS}) &lt;2</recovery_expression>
              <name>Database Read Bps is high => {ITEM.VALUE1}</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
              <dependencies>
                <dependency>
                  <name>Database Read Bps is very high => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(5m)} / ({Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_READ_BPS}) >=2.25</expression>
                  <recovery_expression>{Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].last()} / ({Template Oracle DB:db.odbc.select[Physical Read Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_READ_BPS}) &lt;2.25</recovery_expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(5m)} / ({avg(1w)} + {$MIN_READ_BPS}) >=2.25</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{last()} / ({avg(1w)} + {$MIN_READ_BPS}) &lt;2.25</recovery_expression>
              <name>Database Read Bps is very high => {ITEM.VALUE1}</name>
              <priority>HIGH</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Physical reads direct per sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Physical reads direct per sec,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <params>select value from v$sysstat where name='physical reads direct';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>CHANGE_PER_SECOND</type>
              <params></params>
            </step>
          </preprocessing>
        </item>
        <item>
          <name>Physical reads direct temporary tablespace per sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[physical reads direct temporary tablespace per sec,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <params>select value from v$sysstat where name='physical reads direct temporary tablespace';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>CHANGE_PER_SECOND</type>
              <params></params>
            </step>
          </preprocessing>
        </item>
        <item>
          <name>Physical Reads Per Sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Physical Reads Per Sec,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <params>select value from v$sysmetric where metric_name='Physical Reads Per Sec' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Physical Write Bytes Per Sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Physical Write Bytes Per Sec,{$DSN}]</key>
          <delay>2m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>Bps</units>
          <params>select value from v$sysmetric where metric_name='Physical Write Bytes Per Sec' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
          <triggers>
            <trigger>
              <expression>{avg(15m)} / ({avg(1w)} + {$MIN_WRITE_BPS}) >=1.75</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{avg(#3)} / ({avg(1w)} + {$MIN_WRITE_BPS}) &lt;1.75</recovery_expression>
              <name>Database Write Bps is abnormal => {ITEM.VALUE1}</name>
              <priority>WARNING</priority>
              <manual_close>YES</manual_close>
              <dependencies>
                <dependency>
                  <name>Database Write Bps is high => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(10m)} / ({Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_WRITE_BPS}) >=2</expression>
                  <recovery_expression>{Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(#2)} / ({Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_WRITE_BPS}) &lt;2</recovery_expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(10m)} / ({avg(1w)} + {$MIN_WRITE_BPS}) >=2</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{avg(#2)} / ({avg(1w)} + {$MIN_WRITE_BPS}) &lt;2</recovery_expression>
              <name>Database Write Bps is high => {ITEM.VALUE1}</name>
              <priority>AVERAGE</priority>
              <manual_close>YES</manual_close>
              <dependencies>
                <dependency>
                  <name>Database Write Bps is very high => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(5m)} / ({Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_WRITE_BPS}) >=2.25</expression>
                  <recovery_expression>{Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].last()} / ({Template Oracle DB:db.odbc.select[Physical Write Bytes Per Sec,{$DSN}].avg(1w)} + {$MIN_WRITE_BPS}) &lt;2.25</recovery_expression>
                </dependency>
              </dependencies>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
            <trigger>
              <expression>{avg(5m)} / ({avg(1w)} + {$MIN_WRITE_BPS}) >=2.25</expression>
              <recovery_mode>RECOVERY_EXPRESSION</recovery_mode>
              <recovery_expression>{last()} / ({avg(1w)} + {$MIN_WRITE_BPS}) &lt;2.25</recovery_expression>
              <name>Database Write Bps is very high => {ITEM.VALUE1}</name>
              <priority>HIGH</priority>
              <manual_close>YES</manual_close>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger>
          </triggers>
        </item>
        <item>
          <name>Physical writes direct per sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Physical writes direct per sec,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <params>select value from v$sysstat where name='physical writes direct';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
          <preprocessing>
            <step>
              <type>CHANGE_PER_SECOND</type>
              <params></params>
            </step>
          </preprocessing>
        </item>
        <item>
          <name>Physical Writes Per Sec</name>
          <type>ODBC</type>
          <key>db.odbc.select[Physical Writes Per Sec,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <params>select value from v$sysmetric where metric_name='Physical Writes Per Sec' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>IO</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Redo Allocation Hit Ratio</name>
          <type>ODBC</type>
          <key>db.odbc.select[Redo Allocation Hit Ratio,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Redo Allocation Hit Ratio' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Session blockers count</name>
          <type>ODBC</type>
          <key>db.odbc.select[session blockers count,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select count(distinct blocker_sid) from v$session_blockers;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>Locks</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Shared Pool Free %</name>
          <type>ODBC</type>
          <key>db.odbc.select[Shared Pool Free %,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Shared Pool Free %' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
        </item>
        <item>
          <name>Soft Parse Ratio</name>
          <type>ODBC</type>
          <key>db.odbc.select[Soft Parse Ratio,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <value_type>FLOAT</value_type>
          <units>%</units>
          <params>select value from v$sysmetric where metric_name='Soft Parse Ratio' and group_id=2;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
          </applications>
          <request_method>POST</request_method>
        </item>
        <item>
          <name>Waiting sessions count</name>
          <type>ODBC</type>
          <key>db.odbc.select[Waiting sessions count,{$DSN}]</key>
          <delay>5m</delay>
          <history>7d</history>
          <params>select count(1) from v$session where username is not null and wait_time = 0 and wait_class# != 6;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <applications>
            <application>
              <name>Database</name>
            </application>
            <application>
              <name>Locks</name>
            </application>
          </applications>
        </item>
      </items>
      <discovery_rules>
        <discovery_rule>
          <name>Active session discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[active session discovery,{$DSN}]</key>
          <delay>5m</delay>
          <params>select distinct sid from v$session where username is not null and wait_class#!=6;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>0</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>Session {#SID} CPU used in seconds</name>
              <type>ODBC</type>
              <key>db.odbc.select[session {#SID} CPU time,{$DSN}]</key>
              <delay>2m</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <params>select value/100 from v$sesstat join v$statname using (statistic#) where name = 'CPU used by this session' and sid={#SID};</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <applications>
                <application>
                  <name>Database</name>
                </application>
                <application>
                  <name>Sessions</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Session {#SID}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Session {#SID} SQL ID</name>
              <type>ODBC</type>
              <key>db.odbc.select[session {#SID} SQL ID,{$DSN}]</key>
              <delay>5m</delay>
              <history>1d</history>
              <trends>0</trends>
              <value_type>TEXT</value_type>
              <params>select sql_id from v$session where sid={#SID};</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <applications>
                <application>
                  <name>Database</name>
                </application>
                <application>
                  <name>Sessions</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Session {#SID}</name>
                </application_prototype>
                <application_prototype>
                  <name>SQL</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                  <params>86400</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Session {#SID} username</name>
              <type>ODBC</type>
              <key>db.odbc.select[session {#SID} username,{$DSN}]</key>
              <delay>5m</delay>
              <history>1d</history>
              <trends>0</trends>
              <value_type>TEXT</value_type>
              <params>select username from v$session where sid={#SID};</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <applications>
                <application>
                  <name>Database</name>
                </application>
                <application>
                  <name>Sessions</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Session {#SID}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                  <params>86400</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Session {#SID} change in CPU time per sec</name>
              <type>DEPENDENT</type>
              <key>oracle.db.session.cpu_time_change[{#SID}]</key>
              <delay>0</delay>
              <history>7d</history>
              <value_type>FLOAT</value_type>
              <applications>
                <application>
                  <name>Database</name>
                </application>
                <application>
                  <name>Sessions</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Session {#SID}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>CHANGE_PER_SECOND</type>
                  <params></params>
                </step>
              </preprocessing>
              <master_item>
                <key>db.odbc.select[session {#SID} CPU time,{$DSN}]</key>
              </master_item>
            </item_prototype>
          </item_prototypes>
          <trigger_prototypes>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.odbc.select[Host CPU Utilization,{$DSN}].last()}>=60 and {Template Oracle DB:db.odbc.select[session {#SID} CPU time,{$DSN}].last()}>=0.7</expression>
              <name>Session {#SID} is devouring CPU!</name>
              <priority>HIGH</priority>
              <tags>
                <tag>
                  <tag>Application</tag>
                  <value>Oracle</value>
                </tag>
                <tag>
                  <tag>Field</tag>
                  <value>Database</value>
                </tag>
                <tag>
                  <tag>Scope</tag>
                  <value>Infrastructure</value>
                </tag>
                <tag>
                  <tag>Type</tag>
                  <value>Technical</value>
                </tag>
              </tags>
            </trigger_prototype>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.odbc.select[Host CPU Utilization,{$DSN}].last()}>=60 and {Template Oracle DB:db.odbc.select[session {#SID} CPU time,{$DSN}].last()}>=0.6</expression>
              <name>Session {#SID} is eating CPU!</name>
              <priority>AVERAGE</priority>
            </trigger_prototype>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.odbc.select[Host CPU Utilization,{$DSN}].last()}>=50 and {Template Oracle DB:db.odbc.select[session {#SID} CPU time,{$DSN}].last()}>=0.5</expression>
              <name>Session {#SID} is hogging CPU!</name>
              <priority>WARNING</priority>
            </trigger_prototype>
          </trigger_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>Archive destination discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[Archive destination discovery,{$DSN}]</key>
          <delay>1h</delay>
          <params>select DEST_ID from v$archive_DEST_STATUS where status='VALID' and TYPE != 'LOCAL';</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>0</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>Destination {#DEST_ID} status</name>
              <type>ODBC</type>
              <key>db.odbc.select[Dest {#DEST_ID} status. {#DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <params>select STATUS from v$archive_dest_status where dest_id={#DEST_ID};</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <description>'VALID' 1 'INACTIVE' 2 'DEFERRED' 3 'ERROR' 4 'DISABLED' 5 'BAD PARAM' 6 'ALTERNATE' 7 'FULL' 8 else -1</description>
              <applications>
                <application>
                  <name>Archival Destination</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Archival Destination {#DEST_ID}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>JAVASCRIPT</type>
                  <params>if (value == 'VALID') return 1; if (value == 'INACTIVE') return 2; if (value == 'DEFERRED') return 3; if (value == 'ERROR') return 4; if (value == 'DISABLED') return 5; if (value == 'BAD PARAM') return 6; if (value == 'ALTERNATE') return 7; if (value == 'FULL') return 8; return -1;</params>
                </step>
              </preprocessing>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>ASM disk discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[ASM Disk Discovery,{$DSN}]</key>
          <params>select name as disk_name, case mount_status when 'MISSING' then -3 when 'CLOSED' then -2 when 'CLOSING' then -1 when 'IGNORED' then 0 when 'OPENED' then 1 when 'CACHED' then 2 end as mount_status, case mode_status when 'OFFLINE' then 0 when 'ONLINE' then 1 end as mode_status, case state when 'NORMAL' then 1 when 'UNKNOWN' then 0 when 'ADDING' then 2 when 'DROPPING' then 3 when 'HUNG' then -1 when 'FORCING' then -2 end as state, os_mb, total_mb, free_mb from v$asm_disk_stat;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>7d</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>ASM disk: {#DISK_NAME}: mode status</name>
              <type>CALCULATED</type>
              <key>oracle.asm.disk.mode_status[{#DISK_NAME}]</key>
              <delay>5m</delay>
              <params>{#MODE_STATUS}</params>
              <description>when 'OFFLINE' then 0 when 'ONLINE' then 1</description>
              <application_prototypes>
                <application_prototype>
                  <name>ASM</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>Oracle ASM disk mount status</name>
              </valuemap>
            </item_prototype>
            <item_prototype>
              <name>ASM disk: {#DISK_NAME}: mount status</name>
              <type>CALCULATED</type>
              <key>oracle.asm.disk.mount_status[{#DISK_NAME}]</key>
              <delay>5m</delay>
              <params>{#MOUNT_STATUS}</params>
              <description>when 'MISSING' then -3 when 'CLOSED' then -2 when 'CLOSING' then -1 when 'IGNORED' then 0 when 'OPENED' then 1 when 'CACHED' then 2</description>
              <application_prototypes>
                <application_prototype>
                  <name>ASM</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>Oracle ASM disk mount status</name>
              </valuemap>
            </item_prototype>
            <item_prototype>
              <name>ASM disk: {#DISK_NAME}: state</name>
              <type>CALCULATED</type>
              <key>oracle.asm.disk.state[{#DISK_NAME}]</key>
              <params>{#STATE}</params>
              <description>when 'NORMAL' then 1 when 'UNKNOWN' then 0 when 'ADDING' then 2 when 'DROPPING' then 3 when 'HUNG' then -1 when 'FORCING' then -2</description>
              <application_prototypes>
                <application_prototype>
                  <name>ASM</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>Oracle ASM disk state</name>
              </valuemap>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}&lt;>1</expression>
                  <name>ASM disk {#DISK_NAME} is => {ITEM.VALUE1}</name>
                  <priority>DISASTER</priority>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>ASM disk: {#DISK_NAME}: total space</name>
              <type>CALCULATED</type>
              <key>oracle.asm.disk.total_space[{#DISK_NAME}]</key>
              <delay>5m</delay>
              <history>1d</history>
              <units>B</units>
              <params>{#TOTAL_MB}</params>
              <application_prototypes>
                <application_prototype>
                  <name>ASM</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>1048576</params>
                </step>
              </preprocessing>
              <request_method>POST</request_method>
            </item_prototype>
            <item_prototype>
              <name>ASM disk: {#DISK_NAME}: free space</name>
              <type>CALCULATED</type>
              <key>oracle.db.disk.free_space[{#DISK_NAME}]</key>
              <delay>5m</delay>
              <history>1d</history>
              <units>B</units>
              <params>{#FREE_MB}</params>
              <application_prototypes>
                <application_prototype>
                  <name>ASM</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>1048576</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>ASM disk: {#DISK_NAME}: pct free</name>
              <type>CALCULATED</type>
              <key>oracle.db.disk.pct_free[{#DISK_NAME}]</key>
              <delay>5m</delay>
              <history>1d</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <params>{#FREE_MB} / {#TOTAL_MB} * 100</params>
              <application_prototypes>
                <application_prototype>
                  <name>ASM</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>1048576</params>
                </step>
              </preprocessing>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()} * {$ASM_USAGE_THRESHOLD} &lt;=5</expression>
                  <name>ASM disk {#DISK_NAME} extremely low free space => {ITEM.VALUE1}</name>
                  <priority>HIGH</priority>
                  <dependencies>
                    <dependency>
                      <name>ASM disk {#DISK_NAME} zero free space</name>
                      <expression>{Template Oracle DB:oracle.db.disk.pct_free[{#DISK_NAME}].last()} &lt;=0.01</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Storage</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()} * {$ASM_USAGE_THRESHOLD} &lt;=15</expression>
                  <name>ASM disk {#DISK_NAME} low free space => {ITEM.VALUE1}</name>
                  <priority>WARNING</priority>
                  <dependencies>
                    <dependency>
                      <name>ASM disk {#DISK_NAME} very low free space => {ITEM.VALUE1}</name>
                      <expression>{Template Oracle DB:oracle.db.disk.pct_free[{#DISK_NAME}].last()} * {$ASM_USAGE_THRESHOLD} &lt;=10</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Storage</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()} * {$ASM_USAGE_THRESHOLD} &lt;=10</expression>
                  <name>ASM disk {#DISK_NAME} very low free space => {ITEM.VALUE1}</name>
                  <priority>AVERAGE</priority>
                  <dependencies>
                    <dependency>
                      <name>ASM disk {#DISK_NAME} extremely low free space => {ITEM.VALUE1}</name>
                      <expression>{Template Oracle DB:oracle.db.disk.pct_free[{#DISK_NAME}].last()} * {$ASM_USAGE_THRESHOLD} &lt;=5</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Storage</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()} &lt;=0.01</expression>
                  <name>ASM disk {#DISK_NAME} zero free space</name>
                  <priority>DISASTER</priority>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Storage</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
          <request_method>POST</request_method>
        </discovery_rule>
        <discovery_rule>
          <name>Blocking session discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[blocking sessions discovery,{$DSN}]</key>
          <delay>5m</delay>
          <params>select distinct blocking_session as SID from v$session where blocking_session is not NULL;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>0</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>Total wait time on Blocking session: {#SID}</name>
              <type>ODBC</type>
              <key>db.odbc.select[waiting time - {#SID},{$DSN}]</key>
              <delay>5m</delay>
              <params>select sum(seconds_in_wait) "SECONDS_IN_WAIT" from v$session where blocking_session= {#SID} and seconds_in_wait is not null;</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <request_method>POST</request_method>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}>{$BLOCK_THRESHOLD}</expression>
                  <name>Session {#SID} is an intensive blocker</name>
                  <priority>WARNING</priority>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
          <request_method>POST</request_method>
        </discovery_rule>
        <discovery_rule>
          <name>Flash Recovery Area Discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[Flash Recovery Area Discovery,{$DSN}]</key>
          <delay>5m</delay>
          <params>select name, space_limit, space_used from v$recovery_file_dest;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <item_prototypes>
            <item_prototype>
              <name>FRA: {#NAME}: pct_used</name>
              <type>CALCULATED</type>
              <key>db.oracle.fra.pct_used[{#NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <params>{#SPACE_USED}/{#SPACE_LIMIT}*100</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>FRA</name>
                </application_prototype>
              </application_prototypes>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()} * {$FRA_USAGE_THRESHOLD} >= 95</expression>
                  <name>FRA is almost full => {ITEM.VALUE1}</name>
                  <priority>HIGH</priority>
                  <dependencies>
                    <dependency>
                      <name>FRA is full => {ITEM.VALUE1}</name>
                      <expression>{Template Oracle DB:db.oracle.fra.pct_used[{#NAME}].last()}=100</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastracture</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()}=100</expression>
                  <name>FRA is full => {ITEM.VALUE1}</name>
                  <priority>DISASTER</priority>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()} * {$FRA_USAGE_THRESHOLD} >=85</expression>
                  <name>FRA space usage is high => {ITEM.VALUE1}</name>
                  <priority>WARNING</priority>
                  <dependencies>
                    <dependency>
                      <name>FRA space usage is very high => {ITEM.VALUE1}</name>
                      <expression>{Template Oracle DB:db.oracle.fra.pct_used[{#NAME}].last()} * {$FRA_USAGE_THRESHOLD} >=90</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
                <trigger_prototype>
                  <expression>{last()} * {$FRA_USAGE_THRESHOLD} >=90</expression>
                  <name>FRA space usage is very high => {ITEM.VALUE1}</name>
                  <priority>AVERAGE</priority>
                  <dependencies>
                    <dependency>
                      <name>FRA is almost full => {ITEM.VALUE1}</name>
                      <expression>{Template Oracle DB:db.oracle.fra.pct_used[{#NAME}].last()} * {$FRA_USAGE_THRESHOLD} >= 95</expression>
                    </dependency>
                  </dependencies>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>FRA: {#NAME}: size</name>
              <type>CALCULATED</type>
              <key>db.oracle.fra.size[{#NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <units>B</units>
              <params>{#SPACE_LIMIT}</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>FRA</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>FRA: {#NAME}: space_used</name>
              <type>CALCULATED</type>
              <key>db.oracle.fra.space_used[{#NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <units>B</units>
              <params>{#SPACE_USED}</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>FRA</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>Scheduler jobs discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[job discovery,{$DSN}]</key>
          <delay>5m</delay>
          <params>select job_name, owner, round(cast(req_start_date as date) - date '1970-01-01') * 24 *3600 as req_start_date, round(cast(actual_start_date as date) - date '1970-01-01') * 24 *3600 as actual_start_date, error#, run_duration from user_scheduler_job_run_details where rownum=1 order by req_start_date desc;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>7d</lifetime>
        </discovery_rule>
        <discovery_rule>
          <name>Schema discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[Schema Discovery,{$DSN}]</key>
          <delay>6h</delay>
          <params>select distinct owner from dba_segments;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>7d</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>Schema {#OWNER}: size</name>
              <type>ODBC</type>
              <key>db.odbc.select[Schema {#OWNER} size,{$DSN}]</key>
              <delay>1h</delay>
              <history>7d</history>
              <units>B</units>
              <params>select sum(bytes) from dba_segments where owner='{#OWNER}'</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <description>SIze of the schema.</description>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Schemas</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>Tablespace discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[Tablespace Discovery,{$DSN}]</key>
          <delay>1h</delay>
          <params>select tablespace_name, case when contents in ('PERMANENT', 'UNDO') then (select sum(bytes) from dba_data_files where tablespace_name=t.tablespace_name) when contents='TEMPORARY' then (select sum(bytes) from dba_temp_files where tablespace_name=t.tablespace_name) end as "SIZE", case when contents in ('PERMANENT', 'UNDO') then (select sum( case when autoextensible = 'YES' then maxbytes else bytes end) from dba_data_files where tablespace_name=t.tablespace_name) when contents='TEMPORARY' then (select sum( case when autoextensible = 'YES' then maxbytes else bytes end) from dba_temp_files where tablespace_name=t.tablespace_name) end as "MAX_SIZE", case bigfile when 'YES' then 1 when 'NO' then 0 end "BIGFILE", case contents when 'PERMANENT' then 1 when 'TEMPORARY' then 2 when 'UNDO' then 3 end "CONTENTS" from dba_tablespaces t group by tablespace_name, bigfile, contents;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <item_prototypes>
            <item_prototype>
              <name>Tablespace: {#TABLESPACE_NAME}: bigfile</name>
              <type>CALCULATED</type>
              <key>db.oracle.tablespace.bigfile[{#TABLESPACE_NAME}]</key>
              <delay>1h</delay>
              <history>1d</history>
              <params>{#BIGFILE}</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Tablespaces</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>TruthValue</name>
              </valuemap>
            </item_prototype>
            <item_prototype>
              <name>Tablespace: {#TABLESPACE_NAME}: contents</name>
              <type>CALCULATED</type>
              <key>db.oracle.tablespace.contents[{#TABLESPACE_NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <params>{#CONTENTS}</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Tablespaces</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>Oracle tablespace contents</name>
              </valuemap>
            </item_prototype>
            <item_prototype>
              <name>Tablespace: {#TABLESPACE_NAME}: max_size</name>
              <type>CALCULATED</type>
              <key>db.oracle.tablespace.max_size[{#TABLESPACE_NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <units>B</units>
              <params>{#MAX_SIZE}</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Tablespaces</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Tablespace: {#TABLESPACE_NAME}: pct_used</name>
              <type>CALCULATED</type>
              <key>db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <value_type>FLOAT</value_type>
              <units>%</units>
              <params>{#SIZE}/{#MAX_SIZE}*100</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Tablespaces</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Tablespace: {#TABLESPACE_NAME}: size</name>
              <type>CALCULATED</type>
              <key>db.oracle.tablespace.size[{#TABLESPACE_NAME}]</key>
              <delay>4m</delay>
              <history>1d</history>
              <units>B</units>
              <params>{#SIZE}</params>
              <applications>
                <application>
                  <name>Database</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Tablespaces</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
          </item_prototypes>
          <trigger_prototypes>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()} >= 95 * {$TB_USAGE_THRESHOLD} and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
              <name>Tablespace {#TABLESPACE_NAME} almost full => {ITEM.VALUE1}</name>
              <priority>HIGH</priority>
              <dependencies>
                <dependency>
                  <name>Tablespace {#TABLESPACE_NAME} full => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()}=100 and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
                </dependency>
              </dependencies>
            </trigger_prototype>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()}=100 and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
              <name>Tablespace {#TABLESPACE_NAME} full => {ITEM.VALUE1}</name>
              <priority>DISASTER</priority>
            </trigger_prototype>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()} >= 85 * {$TB_USAGE_THRESHOLD} and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
              <name>Tablespace {#TABLESPACE_NAME} space usage is high => {ITEM.VALUE1}</name>
              <priority>WARNING</priority>
              <dependencies>
                <dependency>
                  <name>Tablespace {#TABLESPACE_NAME} space usage is very high => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()} >= 90 * {$TB_USAGE_THRESHOLD} and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
                </dependency>
              </dependencies>
            </trigger_prototype>
            <trigger_prototype>
              <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()} >= 90 * {$TB_USAGE_THRESHOLD} and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
              <name>Tablespace {#TABLESPACE_NAME} space usage is very high => {ITEM.VALUE1}</name>
              <priority>AVERAGE</priority>
              <dependencies>
                <dependency>
                  <name>Tablespace {#TABLESPACE_NAME} almost full => {ITEM.VALUE1}</name>
                  <expression>{Template Oracle DB:db.oracle.tablespace.pct_used[{#TABLESPACE_NAME}].last()} >= 95 * {$TB_USAGE_THRESHOLD} and {Template Oracle DB:db.oracle.tablespace.contents[{#TABLESPACE_NAME}].last()}=1</expression>
                </dependency>
              </dependencies>
            </trigger_prototype>
          </trigger_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>Top lasting SQLs discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[Top lasting SQLs discovery,{$DSN}]</key>
          <delay>5m</delay>
          <params>select * from ( select SQL_ID, CHILD_ADDRESS from v$sql where last_active_time > systimestamp - 1/24 order by elapsed_time desc) where rownum &lt; 11;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>12h</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} bind variables</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} bind variables,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <trends>0</trends>
              <value_type>TEXT</value_type>
              <params>with temp as ( select NAME, DATATYPE_STRING, POSITION, case datatype when 180 then to_char(anydata.accesstimestamp(value_anydata), 'DD-MM-YYYY HH24:MI:SS.FF9') when 181 then to_char(anydata.accesstimestamptz(value_anydata), 'DD-MM-YYYY HH24:MI:SS.FF9 TZR') when 183 then to_char(anydata.accessintervalYM(value_anydata) || ' ' || anydata.accessintervalDS(value_anydata)) when 12 then to_char(anydata.accessdate(value_anydata), 'DD-MM-YYYY HH24:MI:SS') else nvl(value_string, 'Null') end data_value FROM V$SQL_BIND_CAPTURE where sql_id = '{#SQL_ID}' and child_address = q'[{#CHILD_ADDRESS}]' ) SELECT listagg(NAME || ' := (' || DATATYPE_STRING || ') ' || data_value, chr(10)) within group ( order by position asc) from temp START WITH POSITION = 1 CONNECT BY POSITION = PRIOR POSITION + 1;</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                  <params>86400</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} CPU time</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} CPU time,{$DSN}]</key>
              <delay>2m</delay>
              <history>7d</history>
              <units>S</units>
              <params>select CPU_TIME from v$sql where sql_id='{#SQL_ID}' and child_address=q'[{#CHILD_ADDRESS}]';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>0.000001</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} parsing schema</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} parsing schema,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <trends>0</trends>
              <value_type>TEXT</value_type>
              <params>select parsing_schema_name from v$sql where sql_id='{#SQL_ID}' and child_address=q'[{#CHILD_ADDRESS}]';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                  <params>86400</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} physical read bytes</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} physical read bytes,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <units>B</units>
              <params>select PHYSICAL_READ_BYTES from v$sql where sql_id='{#SQL_ID}' and child_address=q'[{#CHILD_ADDRESS}]';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} physical write bytes</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} physical write bytes,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <units>B</units>
              <params>select PHYSICAL_WRITE_BYTES from v$sql where sql_id='{#SQL_ID}' and child_address=q'[{#CHILD_ADDRESS}]';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} plan</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} plan,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <trends>0</trends>
              <value_type>TEXT</value_type>
              <params>with temp as ( select * FROM V$SQL_PLAN where sql_id = '{#SQL_ID}' and child_address = q'[{#CHILD_ADDRESS}]' ) SELECT listagg( ID || '|' || lpad(' ', level - 1) || operation || ' ' || options || ' ' || case when object_name is not null then chr(9) || object_owner || '.' || object_name || '(' || object_type || ')|' else '' end || case when partition_start is not null then chr(9) || 'PARTITION START: ' || partition_start || '|' else '' end || case when partition_stop is not null then chr(9) || 'PARTITION STOP: ' || partition_stop || '|' else '' end || case when optimizer is not null then chr(9) || optimizer || '|' else '' end || case when cardinality is not null then chr(9) || cardinality || ' DISTINCT ROWS|' else '' end || case when bytes is not null then chr(9) || bytes || ' BYTES|' else '' end || case when cpu_cost is not null then chr(9) || 'CPU COST: ' || CPU_COST || '|' else '' end || case when temp_space is not null then chr(9) || 'TEMP SPACE: ' || TEMP_SPACE || '|' else '' end || case when ACCESS_PREDICATES is not null then chr(9) || 'ACCESS PREDICATES: ' || ACCESS_PREDICATES || '|' else '' end || case when FILTER_PREDICATES is not null then chr(9) || 'FILTER PREDICATES: ' || FILTER_PREDICATES || ' |' else '' end, chr(10)) within group ( order by id desc) from temp START WITH id = 0 CONNECT BY prior id = parent_id;</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                  <params>86400</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID}:{#CHILD_ADDRESS} text</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID}:{#CHILD_ADDRESS} text,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <trends>0</trends>
              <value_type>TEXT</value_type>
              <params>select dbms_lob.substr(sql_fulltext,5000,1) from v$sql where sql_id='{#SQL_ID}' and child_address=q'[{#CHILD_ADDRESS}]';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}:{#CHILD_ADDRESS}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>DISCARD_UNCHANGED_HEARTBEAT</type>
                  <params>86400</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID} total CPU time</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID} total CPU time,{$DSN}]</key>
              <delay>30m</delay>
              <history>7d</history>
              <units>S</units>
              <params>select CPU_TIME from v$sqlarea where sql_id='{#SQL_ID}';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>MULTIPLIER</type>
                  <params>0.000001</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID} total physical read bytes</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID} total physical read bytes,{$DSN}]</key>
              <delay>30m</delay>
              <history>7d</history>
              <units>B</units>
              <params>select PHYSICAL_READ_BYTES from v$sqlarea where sql_id='{#SQL_ID}';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Top SQL {#SQL_ID} total physical write bytes</name>
              <type>ODBC</type>
              <key>db.odbc.select[Top SQL {#SQL_ID} total physical write bytes,{$DSN}]</key>
              <delay>30m</delay>
              <history>7d</history>
              <units>B</units>
              <params>select PHYSICAL_WRITE_BYTES from v$sqlarea where sql_id='{#SQL_ID}';</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <application_prototypes>
                <application_prototype>
                  <name>SQL {#SQL_ID}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
        <discovery_rule>
          <name>Waiting session discovery</name>
          <type>ODBC</type>
          <key>db.odbc.discovery[waiting session discovery,{$DSN}]</key>
          <delay>5m</delay>
          <params>select distinct sid from v$session where username is not null and wait_time = 0 and wait_class# != 6;</params>
          <username>{$DB_USERNAME}</username>
          <password>{$DB_PASSWORD}</password>
          <lifetime>0</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>Session {#SID} total wait time in seconds</name>
              <type>ODBC</type>
              <key>db.odbc.select[session {#SID} wait time,{$DSN}]</key>
              <delay>5m</delay>
              <history>7d</history>
              <params>select case when wait_time = 0 and WAIT_CLASS# != 6 then seconds_in_wait else 0 end from v$session where sid={#SID};</params>
              <username>{$DB_USERNAME}</username>
              <password>{$DB_PASSWORD}</password>
              <applications>
                <application>
                  <name>Database</name>
                </application>
                <application>
                  <name>Sessions</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>Session {#SID}</name>
                </application_prototype>
              </application_prototypes>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}>300</expression>
                  <name>Long waiting session: {#SID} => {ITEM.LASTVALUE} seconds</name>
                  <priority>WARNING</priority>
                  <tags>
                    <tag>
                      <tag>Application</tag>
                      <value>Oracle</value>
                    </tag>
                    <tag>
                      <tag>Field</tag>
                      <value>Database</value>
                    </tag>
                    <tag>
                      <tag>Scope</tag>
                      <value>Infrastructure</value>
                    </tag>
                    <tag>
                      <tag>Type</tag>
                      <value>Technical</value>
                    </tag>
                  </tags>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
          </item_prototypes>
        </discovery_rule>
      </discovery_rules>
      <tags>
        <tag>
          <tag>{$BACKUP_DSN}</tag>
          <value>{$DSN}</value>
        </tag>
      </tags>
      <macros>
        <macro>
          <macro>{$ASM_USAGE_THRESHOLD}</macro>
          <value>1.0</value>
        </macro>
        <macro>
          <macro>{$BACKUP_DSN}</macro>
          <value>{$DSN}</value>
        </macro>
        <macro>
          <macro>{$BLOCK_THRESHOLD}</macro>
          <value>20</value>
        </macro>
        <macro>
          <macro>{$DB_PASSWORD}</macro>
          <value>zabbix</value>
        </macro>
        <macro>
          <macro>{$DB_USERNAME}</macro>
          <value>zabbix</value>
        </macro>
        <macro>
          <macro>{$DSN}</macro>
        </macro>
        <macro>
          <macro>{$FRA_USAGE_THRESHOLD}</macro>
          <value>1.0</value>
        </macro>
        <macro>
          <macro>{$MIN_READ_BPS}</macro>
          <value>10485760</value>
        </macro>
        <macro>
          <macro>{$MIN_WRITE_BPS}</macro>
          <value>1048576</value>
        </macro>
        <macro>
          <macro>{$ORACLE_BACKUP_HOUR}</macro>
          <value>0</value>
        </macro>
        <macro>
          <macro>{$TB_USAGE_THRESHOLD}</macro>
          <value>1.0</value>
        </macro>
      </macros>
    </template>
  </templates>
  <triggers>
    <trigger>
      <expression>{Template Oracle DB:db.odbc.select[db session count,{$DSN}].last()}>={Template Oracle DB:db.odbc.select[max number of sessions,{$DSN}].last()} * 0.95</expression>
      <name>Database extreme session count => {ITEM.VALUE1}</name>
      <priority>DISASTER</priority>
      <manual_close>YES</manual_close>
      <tags>
        <tag>
          <tag>Application</tag>
          <value>Oracle</value>
        </tag>
        <tag>
          <tag>Field</tag>
          <value>Database</value>
        </tag>
        <tag>
          <tag>Scope</tag>
          <value>Infrastructure</value>
        </tag>
        <tag>
          <tag>Type</tag>
          <value>Technical</value>
        </tag>
      </tags>
    </trigger>
    <trigger>
      <expression>{Template Oracle DB:db.odbc.select[db session count,{$DSN}].last()}>={Template Oracle DB:db.odbc.select[max number of sessions,{$DSN}].last()} * 0.6</expression>
      <name>Database high session count</name>
      <priority>WARNING</priority>
      <manual_close>YES</manual_close>
      <dependencies>
        <dependency>
          <name>Database very high session count => {ITEM.VALUE1}</name>
          <expression>{Template Oracle DB:db.odbc.select[db session count,{$DSN}].last()}>={Template Oracle DB:db.odbc.select[max number of sessions,{$DSN}].last()} * 0.8</expression>
        </dependency>
      </dependencies>
      <tags>
        <tag>
          <tag>Application</tag>
          <value>Oracle</value>
        </tag>
        <tag>
          <tag>Field</tag>
          <value>Database</value>
        </tag>
        <tag>
          <tag>Scope</tag>
          <value>Infrastructure</value>
        </tag>
        <tag>
          <tag>Type</tag>
          <value>Technical</value>
        </tag>
      </tags>
    </trigger>
    <trigger>
      <expression>{Template Oracle DB:db.odbc.select[db session count,{$DSN}].last()}>={Template Oracle DB:db.odbc.select[max number of sessions,{$DSN}].last()} * 0.8</expression>
      <name>Database very high session count => {ITEM.VALUE1}</name>
      <priority>HIGH</priority>
      <manual_close>YES</manual_close>
      <dependencies>
        <dependency>
          <name>Database extreme session count => {ITEM.VALUE1}</name>
          <expression>{Template Oracle DB:db.odbc.select[db session count,{$DSN}].last()}>={Template Oracle DB:db.odbc.select[max number of sessions,{$DSN}].last()} * 0.95</expression>
        </dependency>
      </dependencies>
      <tags>
        <tag>
          <tag>Application</tag>
          <value>Oracle</value>
        </tag>
        <tag>
          <tag>Field</tag>
          <value>Database</value>
        </tag>
        <tag>
          <tag>Scope</tag>
          <value>Infrastructure</value>
        </tag>
        <tag>
          <tag>Type</tag>
          <value>Technical</value>
        </tag>
      </tags>
    </trigger>
  </triggers>
  <value_maps>
    <value_map>
      <name>Oracle ASM disk mount status</name>
      <mappings>
        <mapping>
          <value>-1</value>
          <newvalue>CLOSING</newvalue>
        </mapping>
        <mapping>
          <value>-2</value>
          <newvalue>CLOSED</newvalue>
        </mapping>
        <mapping>
          <value>-3</value>
          <newvalue>MISSING</newvalue>
        </mapping>
        <mapping>
          <value>0</value>
          <newvalue>IGNORED</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>OPENED</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>CACHED</newvalue>
        </mapping>
      </mappings>
    </value_map>
    <value_map>
      <name>Oracle ASM disk state</name>
      <mappings>
        <mapping>
          <value>-1</value>
          <newvalue>HUNG</newvalue>
        </mapping>
        <mapping>
          <value>-2</value>
          <newvalue>FORCING</newvalue>
        </mapping>
        <mapping>
          <value>0</value>
          <newvalue>UNKNOWN</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>NORMAL</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>ADDING</newvalue>
        </mapping>
        <mapping>
          <value>3</value>
          <newvalue>DROPPING</newvalue>
        </mapping>
      </mappings>
    </value_map>
    <value_map>
      <name>Oracle backup status</name>
      <mappings>
        <mapping>
          <value>-1</value>
          <newvalue>FAILED</newvalue>
        </mapping>
        <mapping>
          <value>0</value>
          <newvalue>UNKNOWN</newvalue>
        </mapping>
        <mapping>
          <value>1</value>
          <newvalue>COMPLETED</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>WITH WARNINGS</newvalue>
        </mapping>
        <mapping>
          <value>4</value>
          <newvalue>WITH ERRORS</newvalue>
        </mapping>
      </mappings>
    </value_map>
    <value_map>
      <name>Oracle tablespace contents</name>
      <mappings>
        <mapping>
          <value>PERMANENT</value>
          <newvalue>1</newvalue>
        </mapping>
        <mapping>
          <value>TEMPORARY</value>
          <newvalue>2</newvalue>
        </mapping>
        <mapping>
          <value>UNDO</value>
          <newvalue>3</newvalue>
        </mapping>
      </mappings>
    </value_map>
    <value_map>
      <name>TruthValue</name>
      <mappings>
        <mapping>
          <value>1</value>
          <newvalue>true</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>false</newvalue>
        </mapping>
      </mappings>
    </value_map>
  </value_maps>
</zabbix_export>