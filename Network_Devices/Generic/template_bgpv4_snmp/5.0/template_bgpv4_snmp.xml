<?xml version="1.0" encoding="UTF-8"?>
<zabbix_export>
  <version>5.0</version>
  <date>2021-10-22T10:57:59Z</date>
  <groups>
    <group>
      <name>Templates_Created</name>
    </group>
  </groups>
  <templates>
    <template>
      <template>Template BGPv4 SNMP</template>
      <name>Template BGPv4 SNMP</name>
      <description>Template BGPv4 Sessions -Admin Status -Established Time -Operation Status -AS Name -BGP last Error By: Flavio Gomes Figueira Camacho Junior Require: ValueMaps .BGP4-MIB::bgpPeerAdminStatus .BGP4-MIB::bgpPeerState ExternalScript .as_name Base: BGP4-MIB.mib https://www.iana.org/assignments/bgp-parameters/bgp-parameters.xhtml</description>
      <groups>
        <group>
          <name>Templates_Created</name>
        </group>
      </groups>
      <applications>
        <application>
          <name>BGPv4</name>
        </application>
      </applications>
      <discovery_rules>
        <discovery_rule>
          <name>BGPv4 Peers Discovery</name>
          <type>SNMP_AGENT</type>
          <snmp_oid>discovery[{#SNMPVALUE},.1.3.6.1.2.1.15.3.1.7,{#SNMPASN},.1.3.6.1.2.1.15.3.1.9]</snmp_oid>
          <key>BgpPeerDiscovery</key>
          <delay>1h</delay>
          <lifetime>7d</lifetime>
          <item_prototypes>
            <item_prototype>
              <name>AS Name for IPv4 peer $1</name>
              <type>EXTERNAL</type>
              <key>as_name["{#SNMPVALUE}","{#SNMPASN}"]</key>
              <delay>1d</delay>
              <history>7d</history>
              <trends>0</trends>
              <value_type>CHAR</value_type>
              <applications>
                <application>
                  <name>BGPv4</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>BGPv4 {#SNMPVALUE}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Administrative status for peer $1</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>1.3.6.1.2.1.15.3.1.3.{#SNMPVALUE}</snmp_oid>
              <key>bgpPeerAdminStatus[{#SNMPVALUE}]</key>
              <delay>10m</delay>
              <history>7d</history>
              <trends>0</trends>
              <applications>
                <application>
                  <name>BGPv4</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>BGPv4 {#SNMPVALUE}</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>BGP4-MIB::bgpPeerAdminStatus</name>
              </valuemap>
            </item_prototype>
            <item_prototype>
              <name>Established time for peer $1</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>1.3.6.1.2.1.15.3.1.16.{#SNMPVALUE}</snmp_oid>
              <key>bgpPeerFsmEstablishedTime[{#SNMPVALUE}]</key>
              <delay>10m</delay>
              <history>30d</history>
              <trends>0</trends>
              <units>uptime</units>
              <applications>
                <application>
                  <name>BGPv4</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>BGPv4 {#SNMPVALUE}</name>
                </application_prototype>
              </application_prototypes>
              <trigger_prototypes>
                <trigger_prototype>
                  <expression>{last()}&lt;{$PEER_LOW_TIME}</expression>
                  <name>BGP peer up time low {#SNMPVALUE} ASN {#SNMPASN}</name>
                  <priority>INFO</priority>
                  <dependencies>
                    <dependency>
                      <name>BGP peer {#SNMPVALUE} ASN {#SNMPASN} is DOWN</name>
                      <expression>{Template BGPv4 SNMP:bgpPeerState[{#SNMPVALUE}].last(#3)}&lt;>6 and {Template BGPv4 SNMP:bgpPeerAdminStatus[{#SNMPVALUE}].last(0)}=2</expression>
                    </dependency>
                  </dependencies>
                </trigger_prototype>
              </trigger_prototypes>
            </item_prototype>
            <item_prototype>
              <name>BGP peer last error {#SNMPVALUE}</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>1.3.6.1.2.1.15.3.1.14.{#SNMPVALUE}</snmp_oid>
              <key>bgpPeerLastError[{#SNMPVALUE}]</key>
              <delay>10m</delay>
              <history>30d</history>
              <trends>0</trends>
              <value_type>CHAR</value_type>
              <applications>
                <application>
                  <name>BGPv4</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>BGPv4 {#SNMPVALUE}</name>
                </application_prototype>
              </application_prototypes>
              <preprocessing>
                <step>
                  <type>JAVASCRIPT</type>
                  <params>value = (value.replace(/\s+/g, '')); if (value === "0000") { return "NO last error" } if (value === "0100") { return "Message Header Error - Unspecific" } if (value === "0101") { return "Message Header Error - Connection Not Synchronized" } if (value === "0102") { return "Message Header Error - Bad Message Length" } if (value === "0103") { return "Message Header Error - Bad Message Type" } if (value === "0200") { return "OPEN Message Error - Unspecific" } if (value === "0201") { return "OPEN Message Error - Unsupported Version Number" } if (value === "0202") { return "OPEN Message Error - Bad Peer AS" } if (value === "0203") { return "OPEN Message Error - Bad BGP Identifier" } if (value === "0204") { return "OPEN Message Error - Unsupported Optional Parameter" } if (value === "0205") { return "OPEN Message Error - [Deprecated]" } if (value === "0206") { return "OPEN Message Error - Unacceptable Hold Time" } if (value === "0207") { return "OPEN Message Error - Unsupported Capability"; } if (value === "0208") { return "OPEN Message Error - Role Mismatch (Expire on 2021-03-29)" } if (value === "0300") { return "UPDATE Message Error - Unspecific" } if (value === "0301") { return "UPDATE Message Error - Malformed Attribute List" } if (value === "0302") { return "UPDATE Message Error - Unrecognized Well-known Attibute" } if (value === "0303") { return "UPDATE Message Error - Missing Well-know Attribute" } if (value === "0304") { return "UPDATE Message Error - Attribute Flags Error" } if (value === "0305") { return "UPDATE Message Error - Attribute Length Error" } if (value === "0306") { return "UPDATE Message Error - Invalid ORIGIN Attribute" } if (value === "0307") { return "UPDATE Message Error - [Deprecated]" } if (value === "0308") { return "UPDATE Message Error - Invalid NEXT_HOP Attribute" } if (value === "0309") { return "UPDATE Message Error - Optional Attribute Error" } if (value === "0310") { return "UPDATE Message Error - Invalid Network Field" } if (value === "0311") { return "UPDATE Message Error - Malformed AS_PATH" } if (value === "0400") { return "Hold Timer Expired" } if (value === "0500") { return "Finite State Machine Error - Unspecified Error" } if (value === "0501") { return "Finite State Machine Error - Receive Unexpected Message in OpenSent State" } if (value === "0502") { return "Finite State Machine Error - Receive Unexpected Message in OpenConfirm State" } if (value === "0503") { return "Finite State Machine Error - Receive Unexpected Message in Established State" } if (value === "0600") { return "Cease NOTIFICATION - Reserved" } if (value === "0601") { return "Cease NOTIFICATION - Maximum Number of Prefixes Reached" } if (value === "0602") { return "Cease NOTIFICATION - Administrative Shutdown" } if (value === "0603") { return "Cease NOTIFICATION - Peer De-configured" } if (value === "0604") { return "Cease NOTIFICATION - Administrative Reset" } if (value === "0605") { return "Cease NOTIFICATION - Connection Rejected" } if (value === "0606") { return "Cease NOTIFICATION - Other Configuration Change" } if (value === "0607") { return "Cease NOTIFICATION - Connection Collision Resolution" } if (value === "0608") { return "Cease NOTIFICATION - Out of Resources" } if (value === "0609") { return "Cease NOTIFICATION - Hard Reset" } if (value === "0700") { return "ROUTE-REFRESH Message Error - Reserded" } if (value === "0701") { return "ROUTE-REFRESH Message Error - Invalid Message Length" } return value</params>
                </step>
              </preprocessing>
            </item_prototype>
            <item_prototype>
              <name>Remote AS for peer $1</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>1.3.6.1.2.1.15.3.1.9.{#SNMPVALUE}</snmp_oid>
              <key>bgpPeerRemoteAs[{#SNMPVALUE}]</key>
              <delay>1d</delay>
              <history>7d</history>
              <trends>0</trends>
              <applications>
                <application>
                  <name>BGPv4</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>BGPv4 {#SNMPVALUE}</name>
                </application_prototype>
              </application_prototypes>
            </item_prototype>
            <item_prototype>
              <name>Operational status for peer $1</name>
              <type>SNMP_AGENT</type>
              <snmp_oid>1.3.6.1.2.1.15.3.1.2.{#SNMPVALUE}</snmp_oid>
              <key>bgpPeerState[{#SNMPVALUE}]</key>
              <history>30d</history>
              <trends>0</trends>
              <applications>
                <application>
                  <name>BGPv4</name>
                </application>
              </applications>
              <application_prototypes>
                <application_prototype>
                  <name>BGPv4 {#SNMPVALUE}</name>
                </application_prototype>
              </application_prototypes>
              <valuemap>
                <name>BGP4-MIB::bgpPeerState</name>
              </valuemap>
            </item_prototype>
          </item_prototypes>
          <trigger_prototypes>
            <trigger_prototype>
              <expression>{Template BGPv4 SNMP:bgpPeerState[{#SNMPVALUE}].last(#3)}&lt;>6 and {Template BGPv4 SNMP:bgpPeerAdminStatus[{#SNMPVALUE}].last(0)}=2</expression>
              <name>BGP peer {#SNMPVALUE} ASN {#SNMPASN} is DOWN</name>
              <priority>HIGH</priority>
              <description>Trigger for peer that has a remote AS matching {$BGP_PEER_AS} macro.</description>
            </trigger_prototype>
          </trigger_prototypes>
        </discovery_rule>
      </discovery_rules>
      <macros>
        <macro>
          <macro>{$PEER_LOW_TIME}</macro>
          <value>14400</value>
          <description>time in sec alarm for low uptime bgp session</description>
        </macro>
      </macros>
    </template>
  </templates>
  <value_maps>
    <value_map>
      <name>BGP4-MIB::bgpPeerAdminStatus</name>
      <mappings>
        <mapping>
          <value>1</value>
          <newvalue>stoped</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>started</newvalue>
        </mapping>
      </mappings>
    </value_map>
    <value_map>
      <name>BGP4-MIB::bgpPeerState</name>
      <mappings>
        <mapping>
          <value>1</value>
          <newvalue>idle</newvalue>
        </mapping>
        <mapping>
          <value>2</value>
          <newvalue>connect</newvalue>
        </mapping>
        <mapping>
          <value>3</value>
          <newvalue>active</newvalue>
        </mapping>
        <mapping>
          <value>4</value>
          <newvalue>opensent</newvalue>
        </mapping>
        <mapping>
          <value>5</value>
          <newvalue>openconfirm</newvalue>
        </mapping>
        <mapping>
          <value>6</value>
          <newvalue>established</newvalue>
        </mapping>
      </mappings>
    </value_map>
  </value_maps>
</zabbix_export>