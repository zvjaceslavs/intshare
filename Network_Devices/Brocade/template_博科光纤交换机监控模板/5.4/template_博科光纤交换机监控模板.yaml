zabbix_export:
  version: '5.4'
  date: '2021-11-09T05:26:11Z'
  groups:
    -
      uuid: 357667219cde4e2fb8d1b215503ece4b
      name: Templates/DiskArray
  templates:
    -
      uuid: 0c99aaea485347c59ed39894d1b8aa77
      template: monitor_SANSwitch_Brocade
      name: 博科光纤交换机监控模板
      description: |
        ## Overview
        
        博科光纤交换机通用监控模板
        
        
        包括CPU利用率、内存利用率（部分型号不支持）、端口状态、电源风扇状态 
        
        
        将宏{$CLOUD\_SNMP\_COMMUNITY}替换为实际团体字即可
        
        
        
        ## Author
        
        zhangzhefeng
        
        
      groups:
        -
          name: Templates/DiskArray
      items:
        -
          uuid: d66ff6fbf58c470ab0348f3aebbc5cdf
          name: CPU利用率
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.1588.2.1.1.1.26.1.0
          key: CPUUsage
          delay: 5m
          history: 30d
          trends: 60d
          value_type: FLOAT
          units: '%'
          description: |
            MIB: SW-MIB
            System's CPU usage.
          tags:
            -
              tag: Application
              value: CPU情况
          triggers:
            -
              uuid: 07ff134984aa4ad3a6c03dc6da8afd34
              expression: 'min(/monitor_SANSwitch_Brocade/CPUUsage,#2)>{$CPU_USAGE_THRESHOLD}'
              name: CPU利用率高
              priority: HIGH
              description: 'Last value: {ITEM.LASTVALUE1}.'
              type: MULTIPLE
              manual_close: 'YES'
        -
          uuid: db4dd80e983c488badd04f3f355741d4
          name: 固件版本
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.1588.2.1.1.1.1.6.0
          key: FirmwareVersion
          delay: 1h
          history: 3d
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: 系统信息
        -
          uuid: 5b4bcf8fe05f4ba7973386a525675a7e
          name: ping丢包率
          type: SIMPLE
          key: 'icmppingloss[,10,,,]'
          delay: 5m
          history: 7d
          trends: 0d
          value_type: FLOAT
          units: '%'
          tags:
            -
              tag: Application
              value: ping检测
          triggers:
            -
              uuid: 7473e101da494ad3903212856c9cf45f
              expression: 'avg(/monitor_SANSwitch_Brocade/icmppingloss[,10,,,],10m)>{$ICMP_LOSS_WARN}'
              name: 'ICMP ping 丢包'
              priority: AVERAGE
              description: 'Last value: {ITEM.LASTVALUE1}.'
              type: MULTIPLE
              manual_close: 'YES'
              dependencies:
                -
                  name: 'ICMP ping不可达'
                  expression: 'last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#1)=0 and last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#2)=1'
        -
          uuid: 3157e85008dc44c8a8027aadec00b73b
          name: ping时延
          type: SIMPLE
          key: 'icmppingsec[,10,,,,avg]'
          delay: 5m
          history: 7d
          trends: 0d
          value_type: FLOAT
          units: s
          tags:
            -
              tag: Application
              value: ping检测
          triggers:
            -
              uuid: 8136167c363f465bb19d8d2dbe5f42e3
              expression: 'min(/monitor_SANSwitch_Brocade/icmppingsec[,10,,,,avg],10m)>{$ICMP_RESPONSE_TIME_WARN}'
              name: 'ICMP ping 时延高'
              priority: AVERAGE
              description: 'Last value: {ITEM.LASTVALUE1}.'
              type: MULTIPLE
              manual_close: 'YES'
              dependencies:
                -
                  name: 'ICMP ping不可达'
                  expression: 'last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#1)=0 and last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#2)=1'
        -
          uuid: b717b56805794e1ab4e717baf34091e8
          name: 'ICMP ping'
          type: SIMPLE
          key: 'icmpping[,5,,,]'
          history: 7d
          trends: 0d
          tags:
            -
              tag: Application
              value: ping检测
          triggers:
            -
              uuid: 69cbad5b9efa475c9a93059f4c37d4f6
              expression: 'last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#1)=0 and last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#2)=1'
              name: 'ICMP ping不可达'
              priority: HIGH
              type: MULTIPLE
              manual_close: 'YES'
            -
              uuid: 4f3683675b9d49ae9404d87bedb587ab
              expression: 'last(/monitor_SANSwitch_Brocade/icmpping[,5,,,],#1)=0'
              name: 监控失效（ping不通）
              priority: INFO
              manual_close: 'YES'
              tags:
                -
                  tag: 监控失效原因
                  value: ping不通
        -
          uuid: a39bb900163c4f4eba5b87f0c853a7c0
          name: 内存利用率
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.4.1.1588.2.1.1.1.26.6.0
          key: MemoryUsage
          delay: 5m
          history: 30d
          trends: 60d
          value_type: FLOAT
          units: '%'
          description: |
            MIB: SW-MIB
            Memory utilization in %
          tags:
            -
              tag: Application
              value: 内存情况
          triggers:
            -
              uuid: f14742784bdc440ca037e1478a871a03
              expression: 'min(/monitor_SANSwitch_Brocade/MemoryUsage,#2)>{$MEMORY_USAGE_THRESHOLD}'
              name: 内存利用率高
              priority: HIGH
              description: 'Last value: {ITEM.LASTVALUE1}.'
              type: MULTIPLE
              manual_close: 'YES'
        -
          uuid: 31c504489d4d4866b2e38e7781660967
          name: 系统信息
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.1.0
          key: SystemDescription
          delay: 1h
          history: 3d
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: 系统信息
          triggers:
            -
              uuid: 7d767c5d9de14fd28dbe5c0a7f0f252f
              expression: 'nodata(/monitor_SANSwitch_Brocade/SystemDescription,12h)=1'
              name: 监控失效（snmp不通）
              priority: INFO
              manual_close: 'YES'
              tags:
                -
                  tag: 监控失效原因
                  value: snmp不通
        -
          uuid: 3b3a165ef4fb413281fa617c5a6c24d6
          name: 运行时间
          type: SNMP_AGENT
          snmp_oid: 1.3.6.1.2.1.1.3.0
          key: SystemUpTime
          delay: 1h
          history: 3d
          trends: '0'
          value_type: TEXT
          tags:
            -
              tag: Application
              value: 系统信息
      discovery_rules:
        -
          uuid: 4071315070c64397a4d7b20fe07ad1d9
          name: 端口发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#IFNAME},1.3.6.1.4.1.1588.2.1.1.1.6.2.1.37,{#IFDESC},1.3.6.1.4.1.1588.2.1.1.1.6.2.1.36,{#IFWWN},1.3.6.1.4.1.1588.2.1.1.1.6.2.1.34]'
          key: BrocadeInterfaceDiscovery_status
          delay: 12h
          lifetime: 0d
          item_prototypes:
            -
              uuid: 925544d5da1e494ca0de4728de9698d2
              name: '端口:{#IFNAME}({#IFDESC},{#IFWWN})状态'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.1588.2.1.1.1.6.2.1.4.{#SNMPINDEX}'
              key: 'BrocadeInterfaceOperationStatus.[{#SNMPINDEX},{#IFNAME}]'
              delay: 5m
              history: 3d
              trends: 0d
              description: 'unknow即没插 (0)，online（1），offline（2），testing（3），fault故障（4）'
              tags:
                -
                  tag: Application
                  value: 端口状态
              trigger_prototypes:
                -
                  uuid: f568906c962c46199baa97043ace4666
                  expression: 'last(/monitor_SANSwitch_Brocade/BrocadeInterfaceOperationStatus.[{#SNMPINDEX},{#IFNAME}],#2)=1 and last(/monitor_SANSwitch_Brocade/BrocadeInterfaceOperationStatus.[{#SNMPINDEX},{#IFNAME}],#1)=2'
                  recovery_mode: RECOVERY_EXPRESSION
                  recovery_expression: 'last(/monitor_SANSwitch_Brocade/BrocadeInterfaceOperationStatus.[{#SNMPINDEX},{#IFNAME}],#2)=1 and  last(/monitor_SANSwitch_Brocade/BrocadeInterfaceOperationStatus.[{#SNMPINDEX},{#IFNAME}],#1)=1'
                  name: '端口:{#IFNAME} down'
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
                  tags:
                    -
                      tag: 端口描述
                      value: '{#IFDESC}'
                -
                  uuid: 96831a274dca49f9a3e0ef19620a7738
                  expression: 'last(/monitor_SANSwitch_Brocade/BrocadeInterfaceOperationStatus.[{#SNMPINDEX},{#IFNAME}],#1)=4'
                  name: '端口:{#IFNAME} faulty'
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
        -
          uuid: a8d6d98ac43e4517ad9452bbd1e5760f
          name: 传感器发现
          type: SNMP_AGENT
          snmp_oid: 'discovery[{#SNMPVALUE},1.3.6.1.4.1.1588.2.1.1.1.1.22.1.5]'
          key: SensorDiscovery
          delay: 12h
          lifetime: 0d
          description: |
            temp（1），fan（2），power（3）
            unknown 1，faulty 2，below-min 3，nominal 4，above-max 5，absent 6
          item_prototypes:
            -
              uuid: 91702cb81b67470584c5f52ff956709e
              name: '传感器状态  {#SNMPVALUE}'
              type: SNMP_AGENT
              snmp_oid: '1.3.6.1.4.1.1588.2.1.1.1.1.22.1.3.{#SNMPINDEX}'
              key: 'SensorStatus.[{#SNMPINDEX}]'
              delay: 10m
              history: 30d
              trends: 0d
              description: 'MIB: SW-MIB'
              valuemap:
                name: 'SW-MIB::swSensorStatus'
              tags:
                -
                  tag: Application
                  value: 传感器情况
              trigger_prototypes:
                -
                  uuid: fc592ab1481b4f5cac071036ce420fae
                  expression: 'last(/monitor_SANSwitch_Brocade/SensorStatus.[{#SNMPINDEX}],#1)=2'
                  name: 传感器故障
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
                -
                  uuid: 15f6cc7ef6264b3e90b4f481cc1e8083
                  expression: 'last(/monitor_SANSwitch_Brocade/SensorStatus.[{#SNMPINDEX}],#1)=3'
                  name: 传感器数值低于下限
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
                -
                  uuid: 7576554764d94d5199ccf5ba294d557c
                  expression: 'last(/monitor_SANSwitch_Brocade/SensorStatus.[{#SNMPINDEX}],#1)=5'
                  name: 传感器数值高于上限
                  priority: HIGH
                  type: MULTIPLE
                  manual_close: 'YES'
      macros:
        -
          macro: '{$CLOUD_SNMP_COMMUNITY}'
          value: public
        -
          macro: '{$CPU_USAGE_THRESHOLD}'
          value: '90'
        -
          macro: '{$ICMP_LOSS_WARN}'
          value: '30'
        -
          macro: '{$ICMP_RESPONSE_TIME_WARN}'
          value: '0.1'
        -
          macro: '{$MEMORY_USAGE_THRESHOLD}'
          value: '90'
      valuemaps:
        -
          uuid: c4332cd788cd40a5889da4ffb4e38d8d
          name: 'SW-MIB::swSensorStatus'
          mappings:
            -
              value: '1'
              newvalue: unknown
            -
              value: '2'
              newvalue: faulty
            -
              value: '3'
              newvalue: below-min
            -
              value: '4'
              newvalue: nominal
            -
              value: '5'
              newvalue: above-max
            -
              value: '6'
              newvalue: absent
